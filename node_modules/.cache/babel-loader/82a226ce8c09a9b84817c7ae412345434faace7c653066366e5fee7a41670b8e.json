{"ast":null,"code":"import React,{useState,useEffect,Fragment}from'react';import{useParams,useNavigate}from'react-router-dom';import{format}from'date-fns';import{MapPin,Clock,Users,ArrowRight,Bus,CreditCard,ArrowLeft,Info,CheckCircle,AlertCircle}from'lucide-react';import{useApp}from'../context/AppContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const TripDetails=()=>{var _selectedTrip$route3,_selectedTrip$route4,_selectedTrip$route5,_selectedTrip$originL3,_selectedTrip$destina3,_selectedTrip$originL4,_selectedTrip$originL5,_selectedTrip$destina4,_selectedTrip$destina5,_selectedTrip$vehicle;const{tripId}=useParams();const navigate=useNavigate();const{selectedTrip,selectedSeat,selectSeat,isAuthenticated,currentUser,addNotification}=useApp();const[selectedSeats,setSelectedSeats]=useState([]);const[seatsLoaded,setSeatsLoaded]=useState(false);const[routeStops,setRouteStops]=useState([]);const[passengerInfo,setPassengerInfo]=useState({name:(currentUser===null||currentUser===void 0?void 0:currentUser.firstName)+' '+(currentUser===null||currentUser===void 0?void 0:currentUser.lastName)||'',email:(currentUser===null||currentUser===void 0?void 0:currentUser.email)||'',phone:(currentUser===null||currentUser===void 0?void 0:currentUser.phone)||''});useEffect(()=>{if(!selectedTrip){navigate('/search');return;}// Load real seats from database if not already present\nif(!selectedTrip.seats){loadTripSeats();}// Load route stops\nloadRouteStops();// Update passenger info when user changes\nif(currentUser){setPassengerInfo({name:currentUser.firstName+' '+currentUser.lastName,email:currentUser.email,phone:currentUser.phone||''});}},[selectedTrip,navigate,currentUser]);const loadTripSeats=async()=>{try{console.log('🪑 Loading seats for trip:',selectedTrip.id);const response=await fetch(\"http://localhost:5001/api/seats/trip/\".concat(selectedTrip.id));if(!response.ok){console.error('Failed to load seats:',response.status,response.statusText);generateFallbackSeats();return;}const data=await response.json();const seats=data.data||[];console.log('✅ Loaded seats:',seats.length);// Add seats to selectedTrip object\nselectedTrip.seats=seats;// Force re-render by updating state\nsetSelectedSeats([]);setSeatsLoaded(true);}catch(error){console.error('Error loading trip seats:',error);// Fallback: generate basic seats if API fails\ngenerateFallbackSeats();}};const loadRouteStops=async()=>{try{console.log('🛣️ Loading route stops for trip:',selectedTrip.id);const response=await fetch(\"http://localhost:5001/api/trips/\".concat(selectedTrip.id));if(!response.ok){console.error('Failed to load trip details:',response.status);return;}const data=await response.json();const tripData=data.data;if(tripData.routeStops&&tripData.routeStops.length>0){console.log('✅ Found route stops:',tripData.routeStops.length);setRouteStops(tripData.routeStops);}else{console.log('ℹ️ No intermediate stops for this route');setRouteStops([]);}}catch(error){console.error('Error loading route stops:',error);setRouteStops([]);}};const generateFallbackSeats=()=>{const capacity=selectedTrip.total_seats||selectedTrip.totalSeats||30;const basePrice=selectedTrip.base_price||selectedTrip.price||45;const availableSeats=selectedTrip.available_seats||selectedTrip.availableSeats||capacity;const seats=[];const seatsPerRow=4;const rows=Math.ceil(capacity/seatsPerRow);// Generate consistent occupied seats based on trip ID\nconst occupiedCount=capacity-availableSeats;const occupiedSeats=new Set();const tripIdHash=selectedTrip.id.split('').reduce((a,b)=>{a=(a<<5)-a+b.charCodeAt(0);return a&a;},0);for(let i=0;i<occupiedCount;i++){let seatIndex=(Math.abs(tripIdHash)+i*7)%capacity+1;while(occupiedSeats.has(seatIndex)){seatIndex=seatIndex%capacity+1;}occupiedSeats.add(seatIndex);}for(let row=1;row<=rows;row++){for(const col of['A','B','C','D']){if(seats.length>=capacity)break;const seatNumber=\"\".concat(row).concat(col);const seatIndex=seats.length+1;const isOccupied=occupiedSeats.has(seatIndex);seats.push({id:\"seat-\".concat(selectedTrip.id,\"-\").concat(seatNumber),seatNumber:seatNumber,isAvailable:!isOccupied,price:basePrice,seatType:{name:'Standard',features:['Air Conditioning','Reclining Seat']}});}}selectedTrip.seats=seats;setSeatsLoaded(true);};if(!selectedTrip){return/*#__PURE__*/_jsx(\"div\",{className:\"min-h-screen flex items-center justify-center\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Loading trip details...\"})]})});}const handleSeatSelect=seat=>{if(!seat.isAvailable)return;if(selectedSeats.find(s=>s.id===seat.id)){// Deselect seat\nsetSelectedSeats(prev=>prev.filter(s=>s.id!==seat.id));}else{// Select seat (limit to 4 seats)\nif(selectedSeats.length<4){setSelectedSeats(prev=>[...prev,seat]);}else{addNotification({type:'warning',message:'Maximum 4 seats can be selected at once'});}}};const handleProceedToBooking=()=>{if(selectedSeats.length===0){addNotification({type:'warning',message:'Please select at least one seat'});return;}if(!isAuthenticated){navigate('/login');return;}// Store selected seats and proceed to booking\nnavigate('/booking',{state:{trip:selectedTrip,seats:selectedSeats,passengerInfo}});};const renderSeatLayout=()=>{if(!selectedTrip.seats||selectedTrip.seats.length===0)return null;// Group seats by row number for real database seats\nconst seatsByRow={};selectedTrip.seats.forEach(seat=>{const rowNum=seat.rowNumber||parseInt(seat.seatNumber);if(!seatsByRow[rowNum]){seatsByRow[rowNum]={};}seatsByRow[rowNum][seat.position||seat.seatNumber.slice(-1)]=seat;});const rowNumbers=Object.keys(seatsByRow).sort((a,b)=>parseInt(a)-parseInt(b));// Use the actual database layout - respect the row structure from database\nconst seatRows=rowNumbers.map(rowNum=>{const row=seatsByRow[rowNum];// Return seats in order: A, B, C, D (filter out undefined)\nreturn[row.A,row.B,row.C,row.D].filter(Boolean);});return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg p-6 border border-gray-200\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4\",children:\"Select Your Seats\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-md mx-auto\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end mb-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-8 bg-gray-300 rounded flex items-center justify-center text-xs text-gray-600\",children:\"Driver\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:seatRows.map((rowSeats,rowIndex)=>{const currentSeatsPerRow=rowSeats.length;const isLuxuryCoach=currentSeatsPerRow===3;// 3 seats = luxury coach (1|2 layout)\nreturn/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center items-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center space-x-1\",children:rowSeats.map((seat,seatIndex)=>{var _seat$seatType,_seat$seatType2,_seat$seatType3;if(!seat)return/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8\"},\"empty-\".concat(rowIndex,\"-\").concat(seatIndex));const isSelected=selectedSeats.find(s=>s.id===seat.id);// Determine aisle position based on layout\nlet showAisleAfter=false;if(isLuxuryCoach&&seatIndex===0){// 1|2 layout: aisle after first seat (A | B-C)\nshowAisleAfter=true;}else if(currentSeatsPerRow===4&&seatIndex===1){// 2|2 layout: aisle after second seat (A-B | C-D)\nshowAisleAfter=true;}// Mini van (3 seats): no aisle separation - A B C layout\n// Enhanced tooltip with seat features\nconst features=seat.features||{};let featureText='';if(features.single)featureText+=' (Single, Privacy)';else if(features.window)featureText+=' (Window)';else if(features.aisle)featureText+=' (Aisle)';if(features.pair)featureText+=features.window?', Paired':' (Paired)';return/*#__PURE__*/_jsxs(Fragment,{children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleSeatSelect(seat),className:\"w-8 h-8 rounded text-xs font-medium transition-colors \".concat(!seat.isAvailable?'bg-gray-300 text-gray-500 cursor-not-allowed':isSelected?((_seat$seatType=seat.seatType)===null||_seat$seatType===void 0?void 0:_seat$seatType.name)==='Business'?'bg-yellow-600 text-white':'bg-primary-600 text-white':((_seat$seatType2=seat.seatType)===null||_seat$seatType2===void 0?void 0:_seat$seatType2.name)==='Business'?'bg-yellow-100 text-yellow-800 hover:bg-yellow-200 border border-yellow-300':'bg-gray-100 text-gray-700 hover:bg-primary-100 border border-gray-300'),disabled:!seat.isAvailable,title:\"Seat \".concat(seat.seatNumber,\" - \").concat(((_seat$seatType3=seat.seatType)===null||_seat$seatType3===void 0?void 0:_seat$seatType3.name)||'Standard',\" - RM \").concat(seat.price).concat(featureText),children:seat.seatNumber}),showAisleAfter&&/*#__PURE__*/_jsx(\"div\",{className:\"w-6 flex items-center justify-center text-xs text-gray-400\",children:\"|\"})]},seat.id);})})},rowIndex);})}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-6 flex justify-center flex-wrap gap-4 text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 bg-gray-100 border border-gray-300 rounded\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Economy Available\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Business Available\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 bg-primary-600 rounded\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Selected\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 bg-gray-300 rounded\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Occupied\"})]})]})]})]});};const renderRouteStops=()=>{var _selectedTrip$originL,_selectedTrip$originL2,_selectedTrip$destina,_selectedTrip$destina2;// Always show route information, even for direct routes\nconst addMinutes=(dateString,minutes)=>{const date=new Date(dateString);date.setMinutes(date.getMinutes()+minutes);return date;};return/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4\",children:\"Route Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 bg-green-500 rounded-full\"}),/*#__PURE__*/_jsx(\"div\",{className:\"w-px h-8 bg-gray-300\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-gray-900\",children:(_selectedTrip$originL=selectedTrip.originLocation)===null||_selectedTrip$originL===void 0?void 0:_selectedTrip$originL.name}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:(_selectedTrip$originL2=selectedTrip.originLocation)===null||_selectedTrip$originL2===void 0?void 0:_selectedTrip$originL2.city}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-primary-600 font-medium\",children:[\"Departure: \",(()=>{try{return selectedTrip.departureDatetime?format(new Date(selectedTrip.departureDatetime),'HH:mm'):'N/A';}catch(error){return'Invalid time';}})()]})]})]}),routeStops&&routeStops.length>0&&routeStops.map((stop,index)=>{const arrivalTime=addMinutes(selectedTrip.departureDatetime,stop.arrivalOffsetMinutes);const departureTime=addMinutes(selectedTrip.departureDatetime,stop.departureOffsetMinutes);return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"span\",{className:\"text-xs text-white font-bold\",children:stop.stopOrder})}),/*#__PURE__*/_jsx(\"div\",{className:\"w-px h-8 bg-gray-300\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-gray-900\",children:stop.location.name}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:stop.location.city}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-blue-600\",children:[\"Arrival: \",format(arrivalTime,'HH:mm'),\" \\u2022 Departure: \",format(departureTime,'HH:mm'),/*#__PURE__*/_jsxs(\"span\",{className:\"text-gray-500 ml-2\",children:[\"(\",stop.departureOffsetMinutes-stop.arrivalOffsetMinutes,\" min stop)\"]})]}),stop.priceFromOrigin>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs text-gray-500\",children:[\"From origin: +RM \",stop.priceFromOrigin]})]})]},stop.id);}),(!routeStops||routeStops.length===0)&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col items-center\",children:/*#__PURE__*/_jsx(\"div\",{className:\"w-px h-8 bg-gray-300\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1\",children:/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 italic\",children:\"Direct route - no intermediate stops\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-px h-8 bg-gray-300\"}),/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 bg-red-500 rounded-full\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-gray-900\",children:(_selectedTrip$destina=selectedTrip.destinationLocation)===null||_selectedTrip$destina===void 0?void 0:_selectedTrip$destina.name}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:(_selectedTrip$destina2=selectedTrip.destinationLocation)===null||_selectedTrip$destina2===void 0?void 0:_selectedTrip$destina2.city}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-red-600 font-medium\",children:[\"Arrival: \",(()=>{try{// Calculate logical arrival time\nlet calculatedArrival;// If we have route stops, calculate from the last stop + remaining travel time\nif(routeStops&&routeStops.length>0){var _selectedTrip$route;const lastStop=routeStops[routeStops.length-1];const totalRouteDuration=((_selectedTrip$route=selectedTrip.route)===null||_selectedTrip$route===void 0?void 0:_selectedTrip$route.estimatedDurationMinutes)||300;// Calculate remaining travel time after last stop\nconst remainingTravelTime=totalRouteDuration-lastStop.departureOffsetMinutes;calculatedArrival=addMinutes(selectedTrip.departureDatetime,lastStop.departureOffsetMinutes+remainingTravelTime);}else{// For direct routes, use database arrival time or calculate from route duration\nconst estimatedArrival=selectedTrip.estimatedArrivalDatetime||selectedTrip.arrivalDatetime;if(estimatedArrival){calculatedArrival=new Date(estimatedArrival);}else{var _selectedTrip$route2;// Fallback: add route duration to departure time\nconst routeDuration=((_selectedTrip$route2=selectedTrip.route)===null||_selectedTrip$route2===void 0?void 0:_selectedTrip$route2.estimatedDurationMinutes)||300;calculatedArrival=addMinutes(selectedTrip.departureDatetime,routeDuration);}}return format(calculatedArrival,'HH:mm');}catch(error){return'Invalid time';}})()]})]})]})]})]});};const totalPrice=selectedSeats.reduce((total,seat)=>total+seat.price,0);return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-6xl mx-auto\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-6\",children:/*#__PURE__*/_jsxs(\"button\",{onClick:()=>navigate(-1),className:\"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors\",children:[/*#__PURE__*/_jsx(ArrowLeft,{className:\"w-5 h-5\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Back to search results\"})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-3 gap-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"lg:col-span-2 space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"text-2xl font-bold text-gray-900\",children:(_selectedTrip$route3=selectedTrip.route)===null||_selectedTrip$route3===void 0?void 0:_selectedTrip$route3.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-primary-600\",children:[\"RM \",selectedTrip.base_price||selectedTrip.price||((_selectedTrip$route4=selectedTrip.route)===null||_selectedTrip$route4===void 0?void 0:_selectedTrip$route4.basePrice)||((_selectedTrip$route5=selectedTrip.route)===null||_selectedTrip$route5===void 0?void 0:_selectedTrip$route5.base_price)||0]}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500\",children:\"per person\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-gray-600 mb-2\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-lg\",children:(_selectedTrip$originL3=selectedTrip.originLocation)===null||_selectedTrip$originL3===void 0?void 0:_selectedTrip$originL3.city}),/*#__PURE__*/_jsx(ArrowRight,{className:\"w-5 h-5 mx-3 text-primary-500\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium text-lg\",children:(_selectedTrip$destina3=selectedTrip.destinationLocation)===null||_selectedTrip$destina3===void 0?void 0:_selectedTrip$destina3.city})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-2\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-4 h-4 text-primary-500 mt-0.5 flex-shrink-0\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:(_selectedTrip$originL4=selectedTrip.originLocation)===null||_selectedTrip$originL4===void 0?void 0:_selectedTrip$originL4.name}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs\",children:(_selectedTrip$originL5=selectedTrip.originLocation)===null||_selectedTrip$originL5===void 0?void 0:_selectedTrip$originL5.address})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-2\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-4 h-4 text-primary-500 mt-0.5 flex-shrink-0\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:(_selectedTrip$destina4=selectedTrip.destinationLocation)===null||_selectedTrip$destina4===void 0?void 0:_selectedTrip$destina4.name}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs\",children:(_selectedTrip$destina5=selectedTrip.destinationLocation)===null||_selectedTrip$destina5===void 0?void 0:_selectedTrip$destina5.address})]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Clock,{className:\"w-4 h-4 text-primary-500\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-gray-900\",children:\"Departure\"}),/*#__PURE__*/_jsx(\"div\",{children:(()=>{try{return selectedTrip.departureDatetime?format(new Date(selectedTrip.departureDatetime),'HH:mm'):'N/A';}catch(error){return'Invalid time';}})()}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:(()=>{try{return selectedTrip.departureDatetime?format(new Date(selectedTrip.departureDatetime),'MMM dd, yyyy'):'N/A';}catch(error){return'Invalid date';}})()})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Clock,{className:\"w-4 h-4 text-primary-500\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-gray-900\",children:\"Arrival\"}),/*#__PURE__*/_jsx(\"div\",{children:(()=>{try{const arrivalTime=selectedTrip.estimatedArrivalDatetime||selectedTrip.arrivalDatetime;return arrivalTime?format(new Date(arrivalTime),'HH:mm'):'N/A';}catch(error){return'Invalid time';}})()}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs text-gray-500\",children:(()=>{try{const arrivalTime=selectedTrip.estimatedArrivalDatetime||selectedTrip.arrivalDatetime;return arrivalTime?format(new Date(arrivalTime),'MMM dd, yyyy'):'N/A';}catch(error){return'Invalid date';}})()})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Users,{className:\"w-4 h-4 text-primary-500\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-gray-900\",children:\"Available\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-success-600\",children:[selectedTrip.availableSeats,\" seats\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(Bus,{className:\"w-4 h-4 text-primary-500\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-gray-900\",children:\"Vehicle\"}),/*#__PURE__*/_jsx(\"div\",{children:(_selectedTrip$vehicle=selectedTrip.vehicleType)===null||_selectedTrip$vehicle===void 0?void 0:_selectedTrip$vehicle.name})]})]})]})]}),renderRouteStops(),renderSeatLayout(),/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4\",children:\"Booking Policies\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3 text-sm text-gray-600\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-2\",children:[/*#__PURE__*/_jsx(Info,{className:\"w-4 h-4 text-primary-500 mt-0.5\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Free cancellation up to 24 hours before departure\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-2\",children:[/*#__PURE__*/_jsx(Info,{className:\"w-4 h-4 text-primary-500 mt-0.5\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Please arrive at the terminal 15 minutes before departure\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-start space-x-2\",children:[/*#__PURE__*/_jsx(Info,{className:\"w-4 h-4 text-primary-500 mt-0.5\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Valid ID required for boarding\"})]})]})]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"lg:col-span-1\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"card sticky top-24\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold text-gray-900 mb-4\",children:\"Booking Summary\"}),selectedSeats.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900 mb-2\",children:\"Selected Seats\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-2\",children:selectedSeats.map(seat=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center text-sm\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Seat \",seat.seatNumber]}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[\"RM \",seat.price]})]},seat.id))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"border-t border-gray-200 pt-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-lg font-semibold text-gray-900\",children:\"Total\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-2xl font-bold text-primary-600\",children:[\"RM \",totalPrice.toFixed(2)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500 mt-1\",children:[selectedSeats.length,\" seat\",selectedSeats.length!==1?'s':'',\" selected\"]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleProceedToBooking,disabled:selectedSeats.length===0,className:\"w-full py-3 px-4 rounded-lg font-medium transition-colors \".concat(selectedSeats.length===0?'bg-gray-300 text-gray-500 cursor-not-allowed':'btn-primary'),children:!isAuthenticated?'Sign In to Book':'Proceed to Booking'}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 flex items-start space-x-2 text-xs text-gray-500\",children:[/*#__PURE__*/_jsx(CheckCircle,{className:\"w-4 h-4 text-success-500 mt-0.5\"}),/*#__PURE__*/_jsx(\"span\",{children:\"Your booking is secured with 256-bit SSL encryption\"})]})]})})]})]});};export default TripDetails;","map":{"version":3,"names":["React","useState","useEffect","Fragment","useParams","useNavigate","format","MapPin","Clock","Users","ArrowRight","Bus","CreditCard","ArrowLeft","Info","CheckCircle","AlertCircle","useApp","jsx","_jsx","jsxs","_jsxs","TripDetails","_selectedTrip$route3","_selectedTrip$route4","_selectedTrip$route5","_selectedTrip$originL3","_selectedTrip$destina3","_selectedTrip$originL4","_selectedTrip$originL5","_selectedTrip$destina4","_selectedTrip$destina5","_selectedTrip$vehicle","tripId","navigate","selectedTrip","selectedSeat","selectSeat","isAuthenticated","currentUser","addNotification","selectedSeats","setSelectedSeats","seatsLoaded","setSeatsLoaded","routeStops","setRouteStops","passengerInfo","setPassengerInfo","name","firstName","lastName","email","phone","seats","loadTripSeats","loadRouteStops","console","log","id","response","fetch","concat","ok","error","status","statusText","generateFallbackSeats","data","json","length","tripData","capacity","total_seats","totalSeats","basePrice","base_price","price","availableSeats","available_seats","seatsPerRow","rows","Math","ceil","occupiedCount","occupiedSeats","Set","tripIdHash","split","reduce","a","b","charCodeAt","i","seatIndex","abs","has","add","row","col","seatNumber","isOccupied","push","isAvailable","seatType","features","className","children","handleSeatSelect","seat","find","s","prev","filter","type","message","handleProceedToBooking","state","trip","renderSeatLayout","seatsByRow","forEach","rowNum","rowNumber","parseInt","position","slice","rowNumbers","Object","keys","sort","seatRows","map","A","B","C","D","Boolean","rowSeats","rowIndex","currentSeatsPerRow","isLuxuryCoach","_seat$seatType","_seat$seatType2","_seat$seatType3","isSelected","showAisleAfter","featureText","single","window","aisle","pair","onClick","disabled","title","renderRouteStops","_selectedTrip$originL","_selectedTrip$originL2","_selectedTrip$destina","_selectedTrip$destina2","addMinutes","dateString","minutes","date","Date","setMinutes","getMinutes","originLocation","city","departureDatetime","stop","index","arrivalTime","arrivalOffsetMinutes","departureTime","departureOffsetMinutes","stopOrder","location","priceFromOrigin","destinationLocation","calculatedArrival","_selectedTrip$route","lastStop","totalRouteDuration","route","estimatedDurationMinutes","remainingTravelTime","estimatedArrival","estimatedArrivalDatetime","arrivalDatetime","_selectedTrip$route2","routeDuration","totalPrice","total","address","vehicleType","toFixed"],"sources":["/Users/gohshunda/TWT-Transport-Booking/src/pages/TripDetails.js"],"sourcesContent":["import React, { useState, useEffect, Fragment } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { format } from 'date-fns';\nimport { \n  MapPin, \n  Clock, \n  Users, \n  ArrowRight, \n  Bus,\n  CreditCard,\n  ArrowLeft,\n  Info,\n  CheckCircle,\n  AlertCircle\n} from 'lucide-react';\nimport { useApp } from '../context/AppContext';\n\nconst TripDetails = () => {\n  const { tripId } = useParams();\n  const navigate = useNavigate();\n  const { \n    selectedTrip, \n    selectedSeat, \n    selectSeat, \n    isAuthenticated, \n    currentUser,\n    addNotification \n  } = useApp();\n  \n  const [selectedSeats, setSelectedSeats] = useState([]);\n  const [seatsLoaded, setSeatsLoaded] = useState(false);\n  const [routeStops, setRouteStops] = useState([]);\n  const [passengerInfo, setPassengerInfo] = useState({\n    name: currentUser?.firstName + ' ' + currentUser?.lastName || '',\n    email: currentUser?.email || '',\n    phone: currentUser?.phone || ''\n  });\n  \n  useEffect(() => {\n    if (!selectedTrip) {\n      navigate('/search');\n      return;\n    }\n    \n    // Load real seats from database if not already present\n    if (!selectedTrip.seats) {\n      loadTripSeats();\n    }\n    \n    // Load route stops\n    loadRouteStops();\n    \n    // Update passenger info when user changes\n    if (currentUser) {\n      setPassengerInfo({\n        name: currentUser.firstName + ' ' + currentUser.lastName,\n        email: currentUser.email,\n        phone: currentUser.phone || ''\n      });\n    }\n  }, [selectedTrip, navigate, currentUser]);\n\n  const loadTripSeats = async () => {\n    try {\n      console.log('🪑 Loading seats for trip:', selectedTrip.id);\n      const response = await fetch(`http://localhost:5001/api/seats/trip/${selectedTrip.id}`);\n      \n      if (!response.ok) {\n        console.error('Failed to load seats:', response.status, response.statusText);\n        generateFallbackSeats();\n        return;\n      }\n      \n      const data = await response.json();\n      const seats = data.data || [];\n      \n      console.log('✅ Loaded seats:', seats.length);\n      \n      // Add seats to selectedTrip object\n      selectedTrip.seats = seats;\n      \n      // Force re-render by updating state\n      setSelectedSeats([]);\n      setSeatsLoaded(true);\n      \n    } catch (error) {\n      console.error('Error loading trip seats:', error);\n      // Fallback: generate basic seats if API fails\n      generateFallbackSeats();\n    }\n  };\n\n  const loadRouteStops = async () => {\n    try {\n      console.log('🛣️ Loading route stops for trip:', selectedTrip.id);\n      const response = await fetch(`http://localhost:5001/api/trips/${selectedTrip.id}`);\n      \n      if (!response.ok) {\n        console.error('Failed to load trip details:', response.status);\n        return;\n      }\n      \n      const data = await response.json();\n      const tripData = data.data;\n      \n      if (tripData.routeStops && tripData.routeStops.length > 0) {\n        console.log('✅ Found route stops:', tripData.routeStops.length);\n        setRouteStops(tripData.routeStops);\n      } else {\n        console.log('ℹ️ No intermediate stops for this route');\n        setRouteStops([]);\n      }\n      \n    } catch (error) {\n      console.error('Error loading route stops:', error);\n      setRouteStops([]);\n    }\n  };\n\n  const generateFallbackSeats = () => {\n    const capacity = selectedTrip.total_seats || selectedTrip.totalSeats || 30;\n    const basePrice = selectedTrip.base_price || selectedTrip.price || 45;\n    const availableSeats = selectedTrip.available_seats || selectedTrip.availableSeats || capacity;\n    \n    const seats = [];\n    const seatsPerRow = 4;\n    const rows = Math.ceil(capacity / seatsPerRow);\n    \n    // Generate consistent occupied seats based on trip ID\n    const occupiedCount = capacity - availableSeats;\n    const occupiedSeats = new Set();\n    \n    const tripIdHash = selectedTrip.id.split('').reduce((a, b) => {\n      a = ((a << 5) - a) + b.charCodeAt(0);\n      return a & a;\n    }, 0);\n    \n    for (let i = 0; i < occupiedCount; i++) {\n      let seatIndex = (Math.abs(tripIdHash) + i * 7) % capacity + 1;\n      while (occupiedSeats.has(seatIndex)) {\n        seatIndex = (seatIndex % capacity) + 1;\n      }\n      occupiedSeats.add(seatIndex);\n    }\n    \n    for (let row = 1; row <= rows; row++) {\n      for (const col of ['A', 'B', 'C', 'D']) {\n        if (seats.length >= capacity) break;\n        \n        const seatNumber = `${row}${col}`;\n        const seatIndex = seats.length + 1;\n        const isOccupied = occupiedSeats.has(seatIndex);\n        \n        seats.push({\n          id: `seat-${selectedTrip.id}-${seatNumber}`,\n          seatNumber: seatNumber,\n          isAvailable: !isOccupied,\n          price: basePrice,\n          seatType: {\n            name: 'Standard',\n            features: ['Air Conditioning', 'Reclining Seat']\n          }\n        });\n      }\n    }\n    \n    selectedTrip.seats = seats;\n    setSeatsLoaded(true);\n  };\n  \n  if (!selectedTrip) {\n    return (\n      <div className=\"min-h-screen flex items-center justify-center\">\n        <div className=\"text-center\">\n          <div className=\"w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full animate-spin mx-auto mb-4\"></div>\n          <p className=\"text-gray-600\">Loading trip details...</p>\n        </div>\n      </div>\n    );\n  }\n  \n  const handleSeatSelect = (seat) => {\n    if (!seat.isAvailable) return;\n    \n    if (selectedSeats.find(s => s.id === seat.id)) {\n      // Deselect seat\n      setSelectedSeats(prev => prev.filter(s => s.id !== seat.id));\n    } else {\n      // Select seat (limit to 4 seats)\n      if (selectedSeats.length < 4) {\n        setSelectedSeats(prev => [...prev, seat]);\n      } else {\n        addNotification({\n          type: 'warning',\n          message: 'Maximum 4 seats can be selected at once'\n        });\n      }\n    }\n  };\n  \n  const handleProceedToBooking = () => {\n    if (selectedSeats.length === 0) {\n      addNotification({\n        type: 'warning',\n        message: 'Please select at least one seat'\n      });\n      return;\n    }\n    \n    if (!isAuthenticated) {\n      navigate('/login');\n      return;\n    }\n    \n    // Store selected seats and proceed to booking\n    navigate('/booking', { \n      state: { \n        trip: selectedTrip, \n        seats: selectedSeats,\n        passengerInfo \n      } \n    });\n  };\n  \n  const renderSeatLayout = () => {\n    if (!selectedTrip.seats || selectedTrip.seats.length === 0) return null;\n    \n    // Group seats by row number for real database seats\n    const seatsByRow = {};\n    selectedTrip.seats.forEach(seat => {\n      const rowNum = seat.rowNumber || parseInt(seat.seatNumber);\n      if (!seatsByRow[rowNum]) {\n        seatsByRow[rowNum] = {};\n      }\n      seatsByRow[rowNum][seat.position || seat.seatNumber.slice(-1)] = seat;\n    });\n    \n    const rowNumbers = Object.keys(seatsByRow).sort((a, b) => parseInt(a) - parseInt(b));\n    \n    // Use the actual database layout - respect the row structure from database\n    const seatRows = rowNumbers.map(rowNum => {\n      const row = seatsByRow[rowNum];\n      // Return seats in order: A, B, C, D (filter out undefined)\n      return [row.A, row.B, row.C, row.D].filter(Boolean);\n    });\n    \n    return (\n      <div className=\"bg-white rounded-lg p-6 border border-gray-200\">\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Select Your Seats</h3>\n        \n        {/* Bus Layout */}\n        <div className=\"max-w-md mx-auto\">\n          {/* Driver Area */}\n          <div className=\"flex justify-end mb-4\">\n            <div className=\"w-12 h-8 bg-gray-300 rounded flex items-center justify-center text-xs text-gray-600\">\n              Driver\n            </div>\n          </div>\n          \n          {/* Seats */}\n                          <div className=\"space-y-2\">\n          {seatRows.map((rowSeats, rowIndex) => {\n            const currentSeatsPerRow = rowSeats.length;\n            const isLuxuryCoach = currentSeatsPerRow === 3; // 3 seats = luxury coach (1|2 layout)\n            \n            return (\n              <div key={rowIndex} className=\"flex justify-center items-center\">\n                <div className=\"flex items-center space-x-1\">\n                  {rowSeats.map((seat, seatIndex) => {\n                    if (!seat) return <div key={`empty-${rowIndex}-${seatIndex}`} className=\"w-8 h-8\"></div>;\n                    \n                    const isSelected = selectedSeats.find(s => s.id === seat.id);\n                    \n                    // Determine aisle position based on layout\n                    let showAisleAfter = false;\n                    if (isLuxuryCoach && seatIndex === 0) {\n                      // 1|2 layout: aisle after first seat (A | B-C)\n                      showAisleAfter = true;\n                    } else if (currentSeatsPerRow === 4 && seatIndex === 1) {\n                      // 2|2 layout: aisle after second seat (A-B | C-D)\n                      showAisleAfter = true;\n                    }\n                    // Mini van (3 seats): no aisle separation - A B C layout\n                    \n                    // Enhanced tooltip with seat features\n                    const features = seat.features || {};\n                    let featureText = '';\n                    if (features.single) featureText += ' (Single, Privacy)';\n                    else if (features.window) featureText += ' (Window)';\n                    else if (features.aisle) featureText += ' (Aisle)';\n                    if (features.pair) featureText += features.window ? ', Paired' : ' (Paired)';\n                    \n                    return (\n                      <Fragment key={seat.id}>\n                        <button\n                          onClick={() => handleSeatSelect(seat)}\n                          className={`w-8 h-8 rounded text-xs font-medium transition-colors ${\n                            !seat.isAvailable\n                              ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                              : isSelected\n                              ? seat.seatType?.name === 'Business' ? 'bg-yellow-600 text-white' : 'bg-primary-600 text-white'\n                              : seat.seatType?.name === 'Business' \n                              ? 'bg-yellow-100 text-yellow-800 hover:bg-yellow-200 border border-yellow-300'\n                              : 'bg-gray-100 text-gray-700 hover:bg-primary-100 border border-gray-300'\n                          }`}\n                          disabled={!seat.isAvailable}\n                          title={`Seat ${seat.seatNumber} - ${seat.seatType?.name || 'Standard'} - RM ${seat.price}${featureText}`}\n                        >\n                          {seat.seatNumber}\n                        </button>\n                        {/* Add aisle space */}\n                        {showAisleAfter && <div className=\"w-6 flex items-center justify-center text-xs text-gray-400\">|</div>}\n                      </Fragment>\n                    );\n                  })}\n                </div>\n              </div>\n            );\n          })}\n          </div>\n          \n          {/* Legend */}\n          <div className=\"mt-6 flex justify-center flex-wrap gap-4 text-xs\">\n            <div className=\"flex items-center space-x-1\">\n              <div className=\"w-4 h-4 bg-gray-100 border border-gray-300 rounded\"></div>\n              <span>Economy Available</span>\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <div className=\"w-4 h-4 bg-yellow-100 border border-yellow-300 rounded\"></div>\n              <span>Business Available</span>\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <div className=\"w-4 h-4 bg-primary-600 rounded\"></div>\n              <span>Selected</span>\n            </div>\n            <div className=\"flex items-center space-x-1\">\n              <div className=\"w-4 h-4 bg-gray-300 rounded\"></div>\n              <span>Occupied</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  const renderRouteStops = () => {\n    // Always show route information, even for direct routes\n\n    const addMinutes = (dateString, minutes) => {\n      const date = new Date(dateString);\n      date.setMinutes(date.getMinutes() + minutes);\n      return date;\n    };\n\n    return (\n      <div className=\"card\">\n        <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Route Information</h3>\n        <div className=\"space-y-4\">\n          {/* Origin */}\n          <div className=\"flex items-center space-x-4\">\n            <div className=\"flex flex-col items-center\">\n              <div className=\"w-4 h-4 bg-green-500 rounded-full\"></div>\n              <div className=\"w-px h-8 bg-gray-300\"></div>\n            </div>\n            <div className=\"flex-1\">\n              <div className=\"font-medium text-gray-900\">{selectedTrip.originLocation?.name}</div>\n              <div className=\"text-sm text-gray-600\">{selectedTrip.originLocation?.city}</div>\n              <div className=\"text-sm text-primary-600 font-medium\">\n                Departure: {(() => {\n                  try {\n                    return selectedTrip.departureDatetime ? format(new Date(selectedTrip.departureDatetime), 'HH:mm') : 'N/A';\n                  } catch (error) {\n                    return 'Invalid time';\n                  }\n                })()}\n              </div>\n            </div>\n          </div>\n\n          {/* Intermediate Stops */}\n          {routeStops && routeStops.length > 0 && routeStops.map((stop, index) => {\n            const arrivalTime = addMinutes(selectedTrip.departureDatetime, stop.arrivalOffsetMinutes);\n            const departureTime = addMinutes(selectedTrip.departureDatetime, stop.departureOffsetMinutes);\n            \n            return (\n              <div key={stop.id} className=\"flex items-center space-x-4\">\n                <div className=\"flex flex-col items-center\">\n                  <div className=\"w-4 h-4 bg-blue-500 rounded-full flex items-center justify-center\">\n                    <span className=\"text-xs text-white font-bold\">{stop.stopOrder}</span>\n                  </div>\n                  <div className=\"w-px h-8 bg-gray-300\"></div>\n                </div>\n                <div className=\"flex-1\">\n                  <div className=\"font-medium text-gray-900\">{stop.location.name}</div>\n                  <div className=\"text-sm text-gray-600\">{stop.location.city}</div>\n                  <div className=\"text-sm text-blue-600\">\n                    Arrival: {format(arrivalTime, 'HH:mm')} • Departure: {format(departureTime, 'HH:mm')}\n                    <span className=\"text-gray-500 ml-2\">({stop.departureOffsetMinutes - stop.arrivalOffsetMinutes} min stop)</span>\n                  </div>\n                  {stop.priceFromOrigin > 0 && (\n                    <div className=\"text-xs text-gray-500\">\n                      From origin: +RM {stop.priceFromOrigin}\n                    </div>\n                  )}\n                </div>\n              </div>\n            );\n          })}\n\n          {/* Direct route indicator */}\n          {(!routeStops || routeStops.length === 0) && (\n            <div className=\"flex items-center space-x-4\">\n              <div className=\"flex flex-col items-center\">\n                <div className=\"w-px h-8 bg-gray-300\"></div>\n              </div>\n              <div className=\"flex-1\">\n                <div className=\"text-sm text-gray-500 italic\">Direct route - no intermediate stops</div>\n              </div>\n            </div>\n          )}\n\n          {/* Destination */}\n          <div className=\"flex items-center space-x-4\">\n            <div className=\"flex flex-col items-center\">\n              <div className=\"w-px h-8 bg-gray-300\"></div>\n              <div className=\"w-4 h-4 bg-red-500 rounded-full\"></div>\n            </div>\n            <div className=\"flex-1\">\n              <div className=\"font-medium text-gray-900\">{selectedTrip.destinationLocation?.name}</div>\n              <div className=\"text-sm text-gray-600\">{selectedTrip.destinationLocation?.city}</div>\n              <div className=\"text-sm text-red-600 font-medium\">\n                Arrival: {(() => {\n                  try {\n                    // Calculate logical arrival time\n                    let calculatedArrival;\n                    \n                    // If we have route stops, calculate from the last stop + remaining travel time\n                    if (routeStops && routeStops.length > 0) {\n                      const lastStop = routeStops[routeStops.length - 1];\n                      const totalRouteDuration = selectedTrip.route?.estimatedDurationMinutes || 300;\n                      // Calculate remaining travel time after last stop\n                      const remainingTravelTime = totalRouteDuration - lastStop.departureOffsetMinutes;\n                      calculatedArrival = addMinutes(selectedTrip.departureDatetime, lastStop.departureOffsetMinutes + remainingTravelTime);\n                    } else {\n                      // For direct routes, use database arrival time or calculate from route duration\n                      const estimatedArrival = selectedTrip.estimatedArrivalDatetime || selectedTrip.arrivalDatetime;\n                      if (estimatedArrival) {\n                        calculatedArrival = new Date(estimatedArrival);\n                      } else {\n                        // Fallback: add route duration to departure time\n                        const routeDuration = selectedTrip.route?.estimatedDurationMinutes || 300;\n                        calculatedArrival = addMinutes(selectedTrip.departureDatetime, routeDuration);\n                      }\n                    }\n                    \n                    return format(calculatedArrival, 'HH:mm');\n                  } catch (error) {\n                    return 'Invalid time';\n                  }\n                })()}\n              </div>\n            </div>\n          </div>\n\n\n        </div>\n      </div>\n    );\n  };\n  \n  const totalPrice = selectedSeats.reduce((total, seat) => total + seat.price, 0);\n  \n  return (\n    <div className=\"max-w-6xl mx-auto\">\n      {/* Back Button */}\n      <div className=\"mb-6\">\n        <button\n          onClick={() => navigate(-1)}\n          className=\"flex items-center space-x-2 text-gray-600 hover:text-gray-900 transition-colors\"\n        >\n          <ArrowLeft className=\"w-5 h-5\" />\n          <span>Back to search results</span>\n        </button>\n      </div>\n      \n      {/* Trip Information */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n        {/* Trip Details */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          {/* Trip Header */}\n          <div className=\"card\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <h1 className=\"text-2xl font-bold text-gray-900\">\n                {selectedTrip.route?.name}\n              </h1>\n              <div className=\"text-right\">\n                <div className=\"text-2xl font-bold text-primary-600\">\n                  RM {selectedTrip.base_price || selectedTrip.price || selectedTrip.route?.basePrice || selectedTrip.route?.base_price || 0}\n                </div>\n                <div className=\"text-sm text-gray-500\">per person</div>\n              </div>\n            </div>\n            \n            <div className=\"mb-4\">\n              <div className=\"flex items-center text-gray-600 mb-2\">\n                <span className=\"font-medium text-lg\">{selectedTrip.originLocation?.city}</span>\n                <ArrowRight className=\"w-5 h-5 mx-3 text-primary-500\" />\n                <span className=\"font-medium text-lg\">{selectedTrip.destinationLocation?.city}</span>\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600\">\n                <div className=\"flex items-start space-x-2\">\n                  <MapPin className=\"w-4 h-4 text-primary-500 mt-0.5 flex-shrink-0\" />\n                  <div>\n                    <div className=\"font-medium\">{selectedTrip.originLocation?.name}</div>\n                    <div className=\"text-xs\">{selectedTrip.originLocation?.address}</div>\n                  </div>\n                </div>\n                <div className=\"flex items-start space-x-2\">\n                  <MapPin className=\"w-4 h-4 text-primary-500 mt-0.5 flex-shrink-0\" />\n                  <div>\n                    <div className=\"font-medium\">{selectedTrip.destinationLocation?.name}</div>\n                    <div className=\"text-xs\">{selectedTrip.destinationLocation?.address}</div>\n                  </div>\n                </div>\n              </div>\n            </div>\n            \n            <div className=\"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm\">\n              <div className=\"flex items-center space-x-2\">\n                <Clock className=\"w-4 h-4 text-primary-500\" />\n                <div>\n                  <div className=\"font-medium text-gray-900\">Departure</div>\n                  <div>\n                    {(() => {\n                      try {\n                        return selectedTrip.departureDatetime ? format(new Date(selectedTrip.departureDatetime), 'HH:mm') : 'N/A';\n                      } catch (error) {\n                        return 'Invalid time';\n                      }\n                    })()}\n                  </div>\n                  <div className=\"text-xs text-gray-500\">\n                    {(() => {\n                      try {\n                        return selectedTrip.departureDatetime ? format(new Date(selectedTrip.departureDatetime), 'MMM dd, yyyy') : 'N/A';\n                      } catch (error) {\n                        return 'Invalid date';\n                      }\n                    })()}\n                  </div>\n                </div>\n              </div>\n              \n              <div className=\"flex items-center space-x-2\">\n                <Clock className=\"w-4 h-4 text-primary-500\" />\n                <div>\n                  <div className=\"font-medium text-gray-900\">Arrival</div>\n                  <div>\n                    {(() => {\n                      try {\n                        const arrivalTime = selectedTrip.estimatedArrivalDatetime || selectedTrip.arrivalDatetime;\n                        return arrivalTime ? format(new Date(arrivalTime), 'HH:mm') : 'N/A';\n                      } catch (error) {\n                        return 'Invalid time';\n                      }\n                    })()}\n                  </div>\n                  <div className=\"text-xs text-gray-500\">\n                    {(() => {\n                      try {\n                        const arrivalTime = selectedTrip.estimatedArrivalDatetime || selectedTrip.arrivalDatetime;\n                        return arrivalTime ? format(new Date(arrivalTime), 'MMM dd, yyyy') : 'N/A';\n                      } catch (error) {\n                        return 'Invalid date';\n                      }\n                    })()}\n                  </div>\n                </div>\n              </div>\n              \n              <div className=\"flex items-center space-x-2\">\n                <Users className=\"w-4 h-4 text-primary-500\" />\n                <div>\n                  <div className=\"font-medium text-gray-900\">Available</div>\n                  <div className=\"text-success-600\">{selectedTrip.availableSeats} seats</div>\n                </div>\n              </div>\n              \n              <div className=\"flex items-center space-x-2\">\n                <Bus className=\"w-4 h-4 text-primary-500\" />\n                <div>\n                  <div className=\"font-medium text-gray-900\">Vehicle</div>\n                  <div>{selectedTrip.vehicleType?.name}</div>\n                </div>\n              </div>\n            </div>\n          </div>\n          \n          {/* Route Information with Stops */}\n          {renderRouteStops()}\n          \n          {/* Seat Selection */}\n          {renderSeatLayout()}\n          \n          {/* Trip Policies */}\n          <div className=\"card\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Booking Policies</h3>\n            <div className=\"space-y-3 text-sm text-gray-600\">\n              <div className=\"flex items-start space-x-2\">\n                <Info className=\"w-4 h-4 text-primary-500 mt-0.5\" />\n                <span>Free cancellation up to 24 hours before departure</span>\n              </div>\n              <div className=\"flex items-start space-x-2\">\n                <Info className=\"w-4 h-4 text-primary-500 mt-0.5\" />\n                <span>Please arrive at the terminal 15 minutes before departure</span>\n              </div>\n              <div className=\"flex items-start space-x-2\">\n                <Info className=\"w-4 h-4 text-primary-500 mt-0.5\" />\n                <span>Valid ID required for boarding</span>\n              </div>\n            </div>\n          </div>\n        </div>\n        \n        {/* Booking Summary */}\n        <div className=\"lg:col-span-1\">\n          <div className=\"card sticky top-24\">\n            <h3 className=\"text-lg font-semibold text-gray-900 mb-4\">Booking Summary</h3>\n            \n            {/* Selected Seats */}\n            {selectedSeats.length > 0 && (\n              <div className=\"mb-4\">\n                <h4 className=\"font-medium text-gray-900 mb-2\">Selected Seats</h4>\n                <div className=\"space-y-2\">\n                  {selectedSeats.map((seat) => (\n                    <div key={seat.id} className=\"flex justify-between items-center text-sm\">\n                      <span>Seat {seat.seatNumber}</span>\n                      <span className=\"font-medium\">RM {seat.price}</span>\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n            \n            {/* Total */}\n            <div className=\"border-t border-gray-200 pt-4 mb-6\">\n              <div className=\"flex justify-between items-center\">\n                <span className=\"text-lg font-semibold text-gray-900\">Total</span>\n                <span className=\"text-2xl font-bold text-primary-600\">\n                  RM {totalPrice.toFixed(2)}\n                </span>\n              </div>\n              <div className=\"text-sm text-gray-500 mt-1\">\n                {selectedSeats.length} seat{selectedSeats.length !== 1 ? 's' : ''} selected\n              </div>\n            </div>\n            \n            {/* Proceed Button */}\n            <button\n              onClick={handleProceedToBooking}\n              disabled={selectedSeats.length === 0}\n              className={`w-full py-3 px-4 rounded-lg font-medium transition-colors ${\n                selectedSeats.length === 0\n                  ? 'bg-gray-300 text-gray-500 cursor-not-allowed'\n                  : 'btn-primary'\n              }`}\n            >\n              {!isAuthenticated ? 'Sign In to Book' : 'Proceed to Booking'}\n            </button>\n            \n            {/* Security Note */}\n            <div className=\"mt-4 flex items-start space-x-2 text-xs text-gray-500\">\n              <CheckCircle className=\"w-4 h-4 text-success-500 mt-0.5\" />\n              <span>Your booking is secured with 256-bit SSL encryption</span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default TripDetails; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}