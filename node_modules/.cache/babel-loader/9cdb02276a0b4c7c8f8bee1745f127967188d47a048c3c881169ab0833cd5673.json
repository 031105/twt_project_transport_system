{"ast":null,"code":"import _objectSpread from\"/Users/gohshunda/TWT-Transport-Booking/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect,useRef}from'react';import{useNavigate}from'react-router-dom';import AdminLayout from'../../layouts/AdminLayout';import{useApp}from'../../context/AppContext';import AdminCustomerServicePortal from'./AdminCustomerServicePortal';import{format,addDays}from'date-fns';import{Calendar,Clock,MapPin,Bus,Users,Package,TrendingUp,DollarSign,BarChart2,BarChart3,Search,Plus,Edit,Trash,Trash2,Check,X,ChevronRight,ChevronDown,AlertTriangle,AlertCircle,Info,User,Phone,Mail,CreditCard,Printer,Save,Download,ArrowRight,FileText,MessageSquare,Send,Activity,Route,Settings,Map}from'lucide-react';import{getDashboardStats,getAnalyticsData,getVehicles,addVehicle,updateVehicle,getRoutes,getLocationsForRoutes,getTodaysSchedule,getRouteStops,createSchedule,getTripDetails,getPopularTrips,searchTrips,createBooking,formatCurrency,formatDate,formatTime,calculateOccupancy,getOccupancyColorClass,handleApiError,getRouteAnalytics,getSchedules,createRoute}from'../../services/adminApi';import RouteMap from'../../components/admin/RouteMap';import PopularTrips from'../../components/admin/PopularTrips';import PopularTrip from'../../components/admin/PopularTrip';import RouteDetails from'../../components/admin/RouteDetails';import RouteSelector from'../../components/admin/RouteSelector';import LocationSelector from'../../components/admin/LocationSelector';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const AdminDashboard=_ref=>{let{activeTab='customer-service',setActiveTab}=_ref;const{locations,systemDate}=useApp();const[loading,setLoading]=useState(true);const[error,setError]=useState(null);const[stats,setStats]=useState({activeRoutes:0,activeTrips:0,fleetSize:0,scheduledTrips:0});const[routes,setRoutes]=useState([]);const[vehicles,setVehicles]=useState([]);const[todaysSchedule,setTodaysSchedule]=useState([]);const[selectedRoute,setSelectedRoute]=useState(null);const[showRouteDetails,setShowRouteDetails]=useState(false);const[detailRoute,setDetailRoute]=useState(null);const[popularTrips,setPopularTrips]=useState([{id:'1',route:{id:'1',name:'KL - Johor Bahru Express'},origin:'Kuala Lumpur',destination:'Johor Bahru',departureTime:'08:00 AM',date:'2023-06-25'},{id:'2',route:{id:'2',name:'KL - Penang Highway'},origin:'Kuala Lumpur',destination:'Penang',departureTime:'09:30 AM',date:'2023-06-25'},{id:'3',route:{id:'3',name:'KL - Malacca Direct'},origin:'Kuala Lumpur',destination:'Malacca',departureTime:'10:15 AM',date:'2023-06-25'}]);const handlePopularTripSelect=trip=>{// 显示行程详情\nsetDetailRoute(trip.route);setShowRouteDetails(true);};useEffect(()=>{loadDashboardData();},[]);const loadDashboardData=async()=>{setLoading(true);try{// Load all dashboard data in parallel\nconst[statsResponse,routesResponse,vehiclesResponse,scheduleResponse]=await Promise.all([getDashboardStats(),getRoutes(),getVehicles(),getTodaysSchedule()]);if(statsResponse.success){setStats(statsResponse.data);}if(routesResponse.success){setRoutes(routesResponse.data);}if(vehiclesResponse.success){setVehicles(vehiclesResponse.data);}if(scheduleResponse.success){setTodaysSchedule(scheduleResponse.data);}setError(null);}catch(err){console.error('Error loading dashboard data:',err);setError(handleApiError(err));}finally{setLoading(false);}};const handleRouteClick=route=>{setSelectedRoute(route);};const handleViewRoute=route=>{setDetailRoute(route);setShowRouteDetails(true);};const clearSelection=()=>{setSelectedRoute(null);};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-center h-64\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full animate-spin\"}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-gray-600\",children:\"Loading dashboard data...\"})]})});}if(error){return/*#__PURE__*/_jsx(\"div\",{className:\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\",children:/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 border border-red-200 rounded-lg p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"h-5 w-5 text-red-400\",viewBox:\"0 0 20 20\",fill:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\",clipRule:\"evenodd\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-3\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-sm font-medium text-red-800\",children:\"Error loading dashboard\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-2 text-sm text-red-700\",children:[/*#__PURE__*/_jsx(\"p\",{children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:loadDashboardData,className:\"mt-2 text-red-800 underline hover:text-red-900\",children:\"Try again\"})]})]})]})})});}return/*#__PURE__*/_jsxs(\"div\",{className:\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\",children:[activeTab==='customer-service'&&/*#__PURE__*/_jsx(AdminCustomerServicePortal,{}),activeTab==='overview'&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end mb-6\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3\",children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('analytics'),className:\"btn-secondary flex items-center\",children:[/*#__PURE__*/_jsx(BarChart3,{className:\"w-4 h-4 mr-2\"}),\"Analytics\"]}),/*#__PURE__*/_jsxs(\"button\",{onClick:()=>setActiveTab('schedule'),className:\"btn-primary flex items-center\",children:[/*#__PURE__*/_jsx(Plus,{className:\"w-4 h-4 mr-2\"}),\"Add Route\"]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Active Routes\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-3xl font-bold text-primary-600\",children:stats.activeRoutes})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(Route,{className:\"w-6 h-6 text-primary-600\"})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Active Trips\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-3xl font-bold text-success-600\",children:stats.activeTrips})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-success-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(Bus,{className:\"w-6 h-6 text-success-600\"})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Fleet Size\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-3xl font-bold text-warning-600\",children:stats.fleetSize})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-warning-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(Settings,{className:\"w-6 h-6 text-warning-600\"})})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Scheduled Trips\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-3xl font-bold text-purple-600\",children:stats.scheduledTrips})]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(Calendar,{className:\"w-6 h-6 text-purple-600\"})})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card hover:shadow-lg transition-shadow cursor-pointer\",onClick:()=>setActiveTab('vehicles'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(Bus,{className:\"w-6 h-6 text-blue-600\"})}),/*#__PURE__*/_jsx(ArrowRight,{className:\"w-5 h-5 text-gray-400\"})]}),/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-lg text-gray-900 mb-2\",children:\"Manage Vehicles\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-sm\",children:\"Add, edit, or maintain vehicles\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card hover:shadow-lg transition-shadow cursor-pointer\",onClick:()=>setActiveTab('schedule'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(MapPin,{className:\"w-6 h-6 text-green-600\"})}),/*#__PURE__*/_jsx(ArrowRight,{className:\"w-5 h-5 text-gray-400\"})]}),/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-lg text-gray-900 mb-2\",children:\"Route Planning\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-sm\",children:\"Create and optimize routes\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card hover:shadow-lg transition-shadow cursor-pointer\",onClick:()=>setActiveTab('schedule'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(Calendar,{className:\"w-6 h-6 text-yellow-600\"})}),/*#__PURE__*/_jsx(ArrowRight,{className:\"w-5 h-5 text-gray-400\"})]}),/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-lg text-gray-900 mb-2\",children:\"Schedule Trips\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-sm\",children:\"Plan daily operations\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card hover:shadow-lg transition-shadow cursor-pointer\",onClick:()=>setActiveTab('settings'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(Activity,{className:\"w-6 h-6 text-blue-600\"})}),/*#__PURE__*/_jsx(ArrowRight,{className:\"w-5 h-5 text-gray-400\"})]}),/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-lg text-gray-900 mb-2\",children:\"Recent Activity\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 text-sm\",children:\"View recent system activities\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold\",children:\"Active Routes\"}),/*#__PURE__*/_jsx(\"button\",{onClick:clearSelection,className:\"btn-secondary text-sm\",children:\"Clear Selection\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3 max-h-96 overflow-y-auto\",children:routes.map(route=>{var _locations$find,_locations$find2;return/*#__PURE__*/_jsx(\"div\",{className:\"p-4 border rounded-lg cursor-pointer transition-colors \".concat((selectedRoute===null||selectedRoute===void 0?void 0:selectedRoute.id)===route.id?'border-primary-500 bg-primary-50':'border-gray-200 hover:border-gray-300'),onClick:()=>handleRouteClick(route),children:/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-between\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900\",children:route.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();handleViewRoute(route);},className:\"text-primary-600 hover:text-primary-700\",title:\"View Details\",children:/*#__PURE__*/_jsx(BarChart3,{className:\"w-4 h-4\"})}),/*#__PURE__*/_jsx(\"button\",{className:\"text-gray-400 hover:text-gray-600\",title:\"Edit\",children:/*#__PURE__*/_jsx(Edit,{className:\"w-4 h-4\"})}),/*#__PURE__*/_jsx(\"button\",{className:\"text-red-400 hover:text-red-600\",title:\"Delete\",children:/*#__PURE__*/_jsx(Trash2,{className:\"w-4 h-4\"})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600 space-y-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-4 h-4 mr-2\"}),(_locations$find=locations.find(l=>l.id===route.originId))===null||_locations$find===void 0?void 0:_locations$find.city,\" \\u2192 \",(_locations$find2=locations.find(l=>l.id===route.destinationId))===null||_locations$find2===void 0?void 0:_locations$find2.city]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Distance: \",route.distanceKm,\" km\"]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Duration: \",Math.floor(route.durationHours),\"h \",Math.round(route.durationHours%1*60),\"m\"]}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-primary-600 font-medium\",children:[\"Price: RM \",route.basePrice]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"mt-2\",children:(()=>{const routeTrips=todaysSchedule.filter(trip=>trip.routeId===route.id);const avgOccupation=routeTrips.length>0?routeTrips.reduce((sum,trip)=>sum+calculateOccupancy(trip),0)/routeTrips.length:0;return avgOccupation>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between text-xs\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Avg. Occupation:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-16 bg-gray-200 rounded-full h-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-2 rounded-full transition-all\",style:{width:\"\".concat(Math.min(avgOccupation,100),\"%\"),backgroundColor:avgOccupation>80?'#EF4444':avgOccupation>60?'#F59E0B':'#10B981'}})}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium \".concat(avgOccupation>80?'text-red-600':avgOccupation>60?'text-yellow-600':'text-green-600'),children:[typeof avgOccupation==='number'?avgOccupation.toFixed(0):'0',\"%\"]})]})]});})()})]})]})})},route.id);})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold\",children:\"Route Visualization\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-secondary text-sm\",children:\"Clear Selection\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"h-96 bg-gray-100 rounded-lg\",children:/*#__PURE__*/_jsx(RouteMap,{routes:selectedRoute?[selectedRoute]:routes,locations:locations,selectedTrips:todaysSchedule})})]})]})]}),activeTab==='vehicles'&&/*#__PURE__*/_jsx(VehicleManagement,{vehicles:vehicles,onRefresh:loadDashboardData}),activeTab==='schedule'&&/*#__PURE__*/_jsx(ScheduleManagement,{todaysSchedule:todaysSchedule,routes:routes,vehicles:vehicles,onRefresh:loadDashboardData}),activeTab==='analytics'&&/*#__PURE__*/_jsx(Analytics,{}),activeTab==='routes'&&/*#__PURE__*/_jsx(RouteManagement,{routes:routes,onRefresh:loadDashboardData}),showRouteDetails&&/*#__PURE__*/_jsx(\"div\",{style:{zIndex:9999},children:/*#__PURE__*/_jsx(RouteDetails,{route:detailRoute,locations:locations,onClose:()=>{setShowRouteDetails(false);setDetailRoute(null);}})})]});};// Vehicle Management Component\nconst VehicleManagement=_ref2=>{let{vehicles=[],onRefresh}=_ref2;const[showAddVehicle,setShowAddVehicle]=useState(false);const[editingVehicle,setEditingVehicle]=useState(null);const[showServiceModal,setShowServiceModal]=useState(null);const handleAddVehicle=()=>{setShowAddVehicle(true);};const handleEditVehicle=vehicle=>{setEditingVehicle(_objectSpread(_objectSpread({},vehicle),{},{editCapacity:vehicle.vehicle_capacity||vehicle.capacity||0,editMileage:vehicle.current_mileage||0,editLastService:vehicle.last_service_date||''}));};const handleServiceVehicle=async vehicle=>{try{// Toggle between active and maintenance status\nconst newStatus=vehicle.status==='active'?'maintenance':'active';const response=await fetch(\"http://localhost:5001/api/admin/vehicles/\".concat(vehicle.id),{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({status:newStatus})});if(response.ok){setShowServiceModal(_objectSpread(_objectSpread({},vehicle),{},{newStatus,message:newStatus==='maintenance'?'Vehicle has been marked for maintenance':'Vehicle has been returned to active service'}));// Refresh data after a short delay\nsetTimeout(()=>{onRefresh();},1500);}else{alert('Failed to update vehicle status');}}catch(error){console.error('Error updating vehicle status:',error);alert('Error updating vehicle status');}};const handleSaveEdit=async()=>{try{const updateData={current_mileage:editingVehicle.editMileage,last_service_date:editingVehicle.editLastService||null};// Update capacity through vehicle_types if needed\nif(editingVehicle.editCapacity!==editingVehicle.vehicle_capacity){// For now, we'll skip capacity update as it's tied to vehicle_type\n// In a real scenario, you'd either update vehicle_type or create new type\n}const response=await fetch(\"http://localhost:5001/api/admin/vehicles/\".concat(editingVehicle.id),{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(updateData)});if(response.ok){setEditingVehicle(null);onRefresh();alert('Vehicle updated successfully!');}else{alert('Failed to update vehicle');}}catch(error){console.error('Error updating vehicle:',error);alert('Error updating vehicle');}};return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900\",children:\"Vehicle Management\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn-primary flex items-center\",onClick:handleAddVehicle,children:[/*#__PURE__*/_jsx(Plus,{className:\"w-4 h-4 mr-2\"}),\"Add Vehicle\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-3 gap-6\",children:vehicles.map(vehicle=>/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(Bus,{className:\"w-5 h-5 text-blue-600\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-gray-900\",children:vehicle.license_plate||vehicle.plateNumber||vehicle.vehicle_number}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:vehicle.model||'N/A'})]})]}),/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 rounded-full text-xs font-medium \".concat(vehicle.status==='active'?'bg-green-100 text-green-800':vehicle.status==='maintenance'?'bg-yellow-100 text-yellow-800':'bg-red-100 text-red-800'),children:vehicle.status})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-2 text-sm\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Capacity:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[vehicle.vehicle_capacity||vehicle.capacity||'N/A',\" seats\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Mileage:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[vehicle.current_mileage?vehicle.current_mileage.toLocaleString():'N/A',\" km\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-600\",children:\"Last Service:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:vehicle.last_service_date?new Date(vehicle.last_service_date).toLocaleDateString('en-GB'):vehicle.lastService||'N/A'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-4 flex space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-secondary text-xs flex-1\",onClick:()=>handleEditVehicle(vehicle),children:\"Edit\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-secondary text-xs flex-1\",onClick:()=>handleServiceVehicle(vehicle),children:\"Service\"})]})]},vehicle.id))}),showAddVehicle&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg p-6 w-full max-w-md\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-4\",children:\"Add New Vehicle\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mb-4\",children:\"Add vehicle functionality coming soon...\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-secondary w-full\",onClick:()=>setShowAddVehicle(false),children:\"Close\"})]})}),editingVehicle&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg p-6 w-full max-w-md\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold mb-4\",children:[\"Edit Vehicle: \",editingVehicle.license_plate]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Capacity (seats)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:editingVehicle.editCapacity,onChange:e=>setEditingVehicle(prev=>_objectSpread(_objectSpread({},prev),{},{editCapacity:parseInt(e.target.value)})),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\",min:\"1\",max:\"100\",disabled:true}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:\"Capacity is determined by vehicle type\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Current Mileage (km)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",value:editingVehicle.editMileage,onChange:e=>setEditingVehicle(prev=>_objectSpread(_objectSpread({},prev),{},{editMileage:parseInt(e.target.value)})),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\",min:\"0\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Last Service Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:editingVehicle.editLastService,onChange:e=>setEditingVehicle(prev=>_objectSpread(_objectSpread({},prev),{},{editLastService:e.target.value})),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3 mt-6\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-primary flex-1\",onClick:handleSaveEdit,children:\"Save Changes\"}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-secondary flex-1\",onClick:()=>setEditingVehicle(null),children:\"Cancel\"})]})]})}),showServiceModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg p-6 w-full max-w-md\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold mb-4\",children:[\"Service Status: \",showServiceModal.license_plate]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"inline-flex items-center px-4 py-2 rounded-full text-sm font-medium \".concat(showServiceModal.newStatus==='maintenance'?'bg-yellow-100 text-yellow-800':'bg-green-100 text-green-800'),children:[\"Status: \",showServiceModal.newStatus==='maintenance'?'Under Maintenance':'Active Service']}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600 mt-4\",children:showServiceModal.message}),showServiceModal.newStatus==='maintenance'&&/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-yellow-600 mt-2\",children:\"Vehicle is now out of service. Click Service button again to return to active status.\"})]}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-secondary w-full\",onClick:()=>setShowServiceModal(null),children:\"Close\"})]})})]});};// Schedule Management Component\nconst ScheduleManagement=_ref3=>{let{todaysSchedule=[],routes=[],vehicles=[],onRefresh}=_ref3;const{systemDate}=useApp();const[selectedDate,setSelectedDate]=useState(systemDate);const[filteredSchedule,setFilteredSchedule]=useState([]);const[showCreateModal,setShowCreateModal]=useState(false);const[createForm,setCreateForm]=useState({route_id:'',vehicle_id:'',departure_date:systemDate,departure_time:'08:00',base_price:0,seat_types:[{id:'regular',name:'Regular Seats',multiplier:1.0,enabled:true},{id:'premium',name:'Premium Seats',multiplier:1.5,enabled:true},{id:'vip',name:'VIP Seats',multiplier:2.0,enabled:true}],pricing_rules:[{id:'weekend',name:'Weekend Pricing',type:'surcharge',value:15,enabled:false},{id:'holiday',name:'Holiday Pricing',type:'surcharge',value:25,enabled:false},{id:'early_booking',name:'Early Booking Discount',type:'discount',value:10,enabled:false}]});// State for route stops\nconst[routeStops,setRouteStops]=useState([]);const[loadingStops,setLoadingStops]=useState(false);const[dateRange,setDateRange]=useState({startDate:selectedDate,endDate:selectedDate});const[loadingSchedule,setLoadingSchedule]=useState(false);const[viewMode,setViewMode]=useState('day');// 'day', 'week', 'month'\n// State for loading and form submission\nconst[loading,setLoading]=useState(false);const[creatingTrip,setCreatingTrip]=useState(false);// Add state for trip details modal\nconst[showTripDetailsModal,setShowTripDetailsModal]=useState(false);const[selectedTrip,setSelectedTrip]=useState(null);const[loadingTripDetails,setLoadingTripDetails]=useState(false);// Filter schedule by selected date or date range\n// Load schedule data based on selected date and view mode\nuseEffect(()=>{const loadScheduleForDate=async()=>{setLoadingSchedule(true);try{// Use date range if in week or month view mode\nconst startDate=viewMode==='day'?selectedDate:dateRange.startDate;const endDate=viewMode==='day'?selectedDate:dateRange.endDate;const response=await fetch(\"http://localhost:5001/api/admin/schedules?startDate=\".concat(startDate,\"&endDate=\").concat(endDate));if(response.ok){const data=await response.json();if(data.success){// Sort by date then by departure time\nconst sortedSchedule=data.data.sort((a,b)=>{const dateA=new Date(a.departure_datetime);const dateB=new Date(b.departure_datetime);if(dateA.toDateString()===dateB.toDateString()){return dateA.getTime()-dateB.getTime();// Sort by time if same day\n}return dateA.getTime()-dateB.getTime();// Sort by date\n});setFilteredSchedule(sortedSchedule);}}}catch(error){console.error('Error loading schedule for date:',error);setFilteredSchedule([]);}finally{setLoadingSchedule(false);}};loadScheduleForDate();},[selectedDate,dateRange,viewMode]);// Load route stops when a route is selected\nuseEffect(()=>{if(createForm.route_id){loadRouteStops();}},[createForm.route_id]);// eslint-disable-line react-hooks/exhaustive-deps\nconst loadRouteStops=async()=>{if(!createForm.route_id){setRouteStops([]);return;}try{setLoadingStops(true);const response=await getRouteStops(createForm.route_id);if(response.success){setRouteStops(response.data);}else{setRouteStops([]);}}catch(error){console.error('Error loading route stops:',error);setRouteStops([]);}finally{setLoadingStops(false);}};const formatTime=datetime=>{try{return new Date(datetime).toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});}catch(error){return'Invalid time';}};const formatDate=datetime=>{try{return new Date(datetime).toLocaleDateString('en-GB');}catch(error){return'Invalid date';}};const getStatusColor=status=>{switch(status){case'scheduled':return'bg-blue-100 text-blue-800';case'boarding':return'bg-yellow-100 text-yellow-800';case'in_transit':return'bg-green-100 text-green-800';case'arrived':return'bg-gray-100 text-gray-800';case'cancelled':return'bg-red-100 text-red-800';case'delayed':return'bg-orange-100 text-orange-800';default:return'bg-gray-100 text-gray-800';}};// Handle seat type multiplier change\nconst handleSeatTypeChange=(id,value)=>{setCreateForm(prev=>{const updatedSeatTypes=prev.seat_types.map(type=>type.id===id?_objectSpread(_objectSpread({},type),{},{multiplier:parseFloat(value)}):type);return _objectSpread(_objectSpread({},prev),{},{seat_types:updatedSeatTypes});});};// Handle pricing rule toggle\nconst handlePricingRuleToggle=(id,enabled)=>{setCreateForm(prev=>{const updatedRules=prev.pricing_rules.map(rule=>rule.id===id?_objectSpread(_objectSpread({},rule),{},{enabled}):rule);return _objectSpread(_objectSpread({},prev),{},{pricing_rules:updatedRules});});};// Handle pricing rule value change\nconst handlePricingRuleValueChange=(id,value)=>{setCreateForm(prev=>{const updatedRules=prev.pricing_rules.map(rule=>rule.id===id?_objectSpread(_objectSpread({},rule),{},{value:parseInt(value,10)}):rule);return _objectSpread(_objectSpread({},prev),{},{pricing_rules:updatedRules});});};// Create trip schedule with enhanced options\nconst handleCreateTrip=async()=>{// Validate form\nif(!createForm.route_id||!createForm.vehicle_id||!createForm.departure_date||!createForm.departure_time||!createForm.base_price){alert('Please fill in all required fields');return;}try{setCreatingTrip(true);// Get route stops to calculate estimated arrival time\nlet estimatedArrivalDatetime;if(routeStops.length>0){// If we have route stops, use the last stop's arrival offset\nconst lastStop=routeStops[routeStops.length-1];const arrivalOffsetMinutes=lastStop.arrival_offset_minutes||0;// Calculate estimated arrival time\nconst departureDatetime=new Date(\"\".concat(createForm.departure_date,\"T\").concat(createForm.departure_time));estimatedArrivalDatetime=new Date(departureDatetime.getTime()+arrivalOffsetMinutes*60000);}else{// Fallback: Add 4 hours if no route stops data\nconst departureDatetime=new Date(\"\".concat(createForm.departure_date,\"T\").concat(createForm.departure_time));estimatedArrivalDatetime=new Date(departureDatetime.getTime()+4*60*60000);}// Format dates for API\nconst departureDatetime=new Date(\"\".concat(createForm.departure_date,\"T\").concat(createForm.departure_time));// Prepare seat type pricing data\nconst seatTypePricing=createForm.seat_types.filter(type=>type.enabled).map(type=>({seat_type_id:type.id,name:type.name,price_multiplier:parseFloat(type.multiplier)}));// Prepare pricing rules data\nconst pricingRules=createForm.pricing_rules.filter(rule=>rule.enabled).map(rule=>({rule_name:rule.name,rule_type:rule.type,rule_value:parseInt(rule.value,10)}));// Create schedule\nconst response=await createSchedule({route_id:createForm.route_id,vehicle_id:createForm.vehicle_id,departure_datetime:departureDatetime.toISOString(),estimated_arrival_datetime:estimatedArrivalDatetime.toISOString(),base_price:parseFloat(createForm.base_price),seat_type_pricing:seatTypePricing,pricing_rules:pricingRules});if(response.success){setShowCreateModal(false);resetCreateForm();onRefresh();alert('Trip scheduled successfully!');}else{alert('Failed to schedule trip: '+(response.message||'Unknown error'));}}catch(error){console.error('Error creating trip:',error);alert('Error scheduling trip: '+(error.message||'Unknown error'));}finally{setCreatingTrip(false);}};// Function to group trips by date\nconst getTripsByDate=()=>{const groupedTrips={};filteredSchedule.forEach(trip=>{const date=new Date(trip.departure_datetime).toDateString();if(!groupedTrips[date]){groupedTrips[date]=[];}groupedTrips[date].push(trip);});return groupedTrips;};// Set week view dates\nconst setWeekView=()=>{const currentDate=new Date(selectedDate);const startOfWeek=new Date(currentDate);startOfWeek.setDate(currentDate.getDate()-currentDate.getDay());const endOfWeek=new Date(startOfWeek);endOfWeek.setDate(startOfWeek.getDate()+6);setDateRange({startDate:startOfWeek.toISOString().split('T')[0],endDate:endOfWeek.toISOString().split('T')[0]});setViewMode('week');};// Set month view dates\nconst setMonthView=()=>{const currentDate=new Date(selectedDate);const startOfMonth=new Date(currentDate.getFullYear(),currentDate.getMonth(),1);const endOfMonth=new Date(currentDate.getFullYear(),currentDate.getMonth()+1,0);setDateRange({startDate:startOfMonth.toISOString().split('T')[0],endDate:endOfMonth.toISOString().split('T')[0]});setViewMode('month');};// Switch back to day view\nconst setDayView=()=>{setViewMode('day');};// Get formatted date range text based on view mode\nconst getDateRangeText=()=>{if(viewMode==='day'){return\"Schedule for \".concat(formatDate(selectedDate));}else if(viewMode==='week'){return\"Week of \".concat(formatDate(dateRange.startDate),\" - \").concat(formatDate(dateRange.endDate));}else{return\"Month of \".concat(new Date(dateRange.startDate).toLocaleString('en-US',{month:'long',year:'numeric'}));}};// Reset create form to initial state\nconst resetCreateForm=()=>{setCreateForm({route_id:'',vehicle_id:'',departure_date:systemDate,departure_time:'08:00',base_price:0,seat_types:[{id:'regular',name:'Regular Seats',multiplier:1.0,enabled:true},{id:'premium',name:'Premium Seats',multiplier:1.5,enabled:true},{id:'vip',name:'VIP Seats',multiplier:2.0,enabled:true}],pricing_rules:[{id:'weekend',name:'Weekend Pricing',type:'surcharge',value:15,enabled:false},{id:'holiday',name:'Holiday Pricing',type:'surcharge',value:25,enabled:false},{id:'early_booking',name:'Early Booking Discount',type:'discount',value:10,enabled:false}]});setRouteStops([]);};// Handle trip click\nconst handleTripClick=async tripId=>{setLoadingTripDetails(true);try{const response=await getTripDetails(tripId);if(response.success){setSelectedTrip(response.data);setShowTripDetailsModal(true);}else{alert('Failed to load trip details');}}catch(error){console.error('Error loading trip details:',error);alert('Error loading trip details');}finally{setLoadingTripDetails(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap justify-between items-center gap-4\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900\",children:\"Schedule Management\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-wrap items-center gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"inline-flex rounded-md shadow-sm\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 text-sm font-medium \".concat(viewMode==='day'?'bg-blue-600 text-white':'bg-white text-gray-700 hover:bg-gray-50',\" border border-gray-300 rounded-l-md focus:z-10\"),onClick:setDayView,children:\"Day\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 text-sm font-medium \".concat(viewMode==='week'?'bg-blue-600 text-white':'bg-white text-gray-700 hover:bg-gray-50',\" border-t border-b border-r border-gray-300 focus:z-10\"),onClick:setWeekView,children:\"Week\"}),/*#__PURE__*/_jsx(\"button\",{className:\"px-4 py-2 text-sm font-medium \".concat(viewMode==='month'?'bg-blue-600 text-white':'bg-white text-gray-700 hover:bg-gray-50',\" border-t border-b border-r border-gray-300 rounded-r-md focus:z-10\"),onClick:setMonthView,children:\"Month\"})]}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:selectedDate,onChange:e=>setSelectedDate(e.target.value),className:\"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\",min:systemDate,max:\"2025-07-31\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn-primary flex items-center\",onClick:()=>setShowCreateModal(true),children:[/*#__PURE__*/_jsx(Calendar,{className:\"w-4 h-4 mr-2\"}),\"Create Schedule\"]})]})]}),loadingSchedule?/*#__PURE__*/_jsx(\"div\",{className:\"card py-16\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center justify-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 border-4 border-t-4 border-primary-600 border-t-transparent rounded-full animate-spin\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-4 text-gray-600\",children:\"Loading schedule data...\"})]})}):/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold mb-4\",children:[getDateRangeText(),/*#__PURE__*/_jsxs(\"span\",{className:\"ml-2 text-sm font-normal text-gray-600\",children:[\"(\",filteredSchedule.length,\" trips)\"]})]}),filteredSchedule.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8 text-gray-500\",children:[/*#__PURE__*/_jsx(Calendar,{className:\"w-12 h-12 mx-auto mb-3 text-gray-300\"}),/*#__PURE__*/_jsx(\"p\",{children:\"No trips scheduled for this period\"})]}):viewMode==='day'?/*#__PURE__*/// Day view - simple list\n_jsx(\"div\",{className:\"space-y-3\",children:filteredSchedule.map(trip=>{const occupiedSeats=trip.occupied_seats||trip.total_seats-trip.available_seats;const occupancyPercentage=trip.occupancy_percentage||Math.round(occupiedSeats/trip.total_seats*100);return/*#__PURE__*/_jsx(\"div\",{className:\"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer\",onClick:()=>handleTripClick(trip.id),children:/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-between\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900\",children:trip.route_name}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:e=>{e.stopPropagation();handleTripClick(trip.id);},className:\"text-primary-600 hover:text-primary-700\",title:\"View Details\",children:/*#__PURE__*/_jsx(BarChart3,{className:\"w-4 h-4\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:e=>e.stopPropagation(),className:\"text-gray-400 hover:text-gray-600\",title:\"Edit\",children:/*#__PURE__*/_jsx(Edit,{className:\"w-4 h-4\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:e=>e.stopPropagation(),className:\"text-red-400 hover:text-red-600\",title:\"Delete\",children:/*#__PURE__*/_jsx(Trash2,{className:\"w-4 h-4\"})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600 space-y-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-4 h-4 mr-2\"}),trip.origin_name,\" \\u2192 \",trip.destination_name]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Departure: \",formatTime(trip.departure_datetime)]}),/*#__PURE__*/_jsxs(\"span\",{children:[\"Arrival: \",formatTime(trip.estimated_arrival_datetime)]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"Vehicle: \",trip.vehicle_number||trip.license_plate]}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-primary-600 font-medium\",children:[\"Price: RM \",trip.base_price]})]})]})]})})},trip.id);})}):/*#__PURE__*/// Week/Month view - grouped by date\n_jsx(\"div\",{className:\"space-y-6\",children:Object.entries(getTripsByDate()).length===0?/*#__PURE__*/_jsx(\"div\",{className:\"py-10 text-center text-gray-500\",children:\"No trips scheduled for this period\"}):Object.entries(getTripsByDate()).map(_ref4=>{let[date,trips]=_ref4;return/*#__PURE__*/_jsxs(\"div\",{className:\"py-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"px-4 py-2 bg-gray-50 font-medium\",children:new Date(date).toLocaleDateString('en-US',{weekday:'long',month:'long',day:'numeric',year:'numeric'})}),/*#__PURE__*/_jsx(\"div\",{className:\"divide-y divide-gray-100\",children:trips.map(trip=>/*#__PURE__*/_jsx(\"div\",{className:\"p-4 hover:bg-gray-50 cursor-pointer transition-colors\",onClick:()=>handleTripClick(trip.id),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-lg font-medium w-20 text-gray-900\",children:formatTime(trip.departure_datetime)}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium text-gray-900\",children:trip.route_name}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600\",children:[trip.origin_name,\" \\u2192 \",trip.destination_name]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:trip.vehicle_number||trip.license_plate}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 rounded-full text-xs font-medium \".concat(getStatusColor(trip.status)),children:trip.status.replace('_',' ').toUpperCase()})})]})]})},trip.id))})]},date);})})]}),showCreateModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold\",children:\"Create New Trip Schedule\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowCreateModal(false),className:\"text-gray-400 hover:text-gray-600\",children:/*#__PURE__*/_jsx(X,{size:20})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-700\",children:\"Basic Trip Information\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Route\"}),/*#__PURE__*/_jsx(RouteSelector,{value:createForm.route_id,onChange:value=>{setCreateForm(prev=>_objectSpread(_objectSpread({},prev),{},{route_id:value}));if(value){// When route changes, load route stops\ngetRouteStops(value).then(response=>{if(response.success){setRouteStops(response.data||[]);}else{setRouteStops([]);}}).catch(err=>{console.error('Error loading route stops:',err);setRouteStops([]);});}else{setRouteStops([]);}}})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Vehicle\"}),/*#__PURE__*/_jsxs(\"select\",{value:createForm.vehicle_id,onChange:e=>setCreateForm(prev=>_objectSpread(_objectSpread({},prev),{},{vehicle_id:e.target.value})),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\",children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select a vehicle\"}),vehicles.map(vehicle=>/*#__PURE__*/_jsxs(\"option\",{value:vehicle.id,children:[vehicle.vehicle_number,\" - \",vehicle.license_plate,\" (\",vehicle.vehicle_type_name,\")\"]},vehicle.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Departure Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:createForm.departure_date,onChange:e=>setCreateForm(prev=>_objectSpread(_objectSpread({},prev),{},{departure_date:e.target.value})),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\",min:systemDate})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Departure Time\"}),/*#__PURE__*/_jsx(\"input\",{type:\"time\",value:createForm.departure_time,onChange:e=>setCreateForm(prev=>_objectSpread(_objectSpread({},prev),{},{departure_time:e.target.value})),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-700\",children:\"Pricing Configuration\"}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"Base Price (RM)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.50\",min:\"0\",value:createForm.base_price,onChange:e=>setCreateForm(prev=>_objectSpread(_objectSpread({},prev),{},{base_price:e.target.value})),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\",placeholder:\"e.g. 45.00\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 p-3 rounded-lg border border-gray-200\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"text-sm font-medium text-gray-700 mb-2\",children:\"Seat Type Pricing\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3 mt-3\",children:createForm.seat_types.map(seatType=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:\"\".concat(seatType.id,\"-seats\"),className:\"mr-2\",checked:seatType.enabled,onChange:e=>{const updatedSeatTypes=createForm.seat_types.map(type=>type.id===seatType.id?_objectSpread(_objectSpread({},type),{},{enabled:e.target.checked}):type);setCreateForm(prev=>_objectSpread(_objectSpread({},prev),{},{seat_types:updatedSeatTypes}));}}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"\".concat(seatType.id,\"-seats\"),className:\"text-sm\",children:seatType.name})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm flex items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500 mr-2\",children:\"Multiplier:\"}),seatType.id==='regular'?/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:\"1.0x\"}):/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.1\",min:\"1\",className:\"w-16 px-2 py-1 border border-gray-300 rounded-md\",value:seatType.multiplier,onChange:e=>handleSeatTypeChange(seatType.id,e.target.value)})]})]},seatType.id))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 p-3 rounded-lg border border-gray-200\",children:[/*#__PURE__*/_jsx(\"h5\",{className:\"text-sm font-medium text-gray-700 mb-2\",children:\"Dynamic Pricing Rules\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-3 mt-3\",children:createForm.pricing_rules.map(rule=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:rule.id,className:\"mr-2\",checked:rule.enabled,onChange:e=>handlePricingRuleToggle(rule.id,e.target.checked)}),/*#__PURE__*/_jsx(\"label\",{htmlFor:rule.id,className:\"text-sm\",children:rule.name})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm flex items-center\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500 mr-2\",children:rule.id==='early_booking'?'-':'+'}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"1\",min:\"0\",className:\"w-16 px-2 py-1 border border-gray-300 rounded-md\",value:rule.value,disabled:!rule.enabled,onChange:e=>handlePricingRuleValueChange(rule.id,e.target.value)}),/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500 ml-1\",children:\"%\"})]})]},rule.id))})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3 mt-6\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-primary flex-1\",onClick:handleCreateTrip,disabled:creatingTrip||!createForm.route_id||!createForm.vehicle_id||!createForm.departure_date||!createForm.departure_time||!createForm.base_price,children:creatingTrip?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2\"}),\"Creating...\"]}):'Schedule Trip'}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-secondary flex-1\",onClick:()=>setShowCreateModal(false),disabled:creatingTrip,children:\"Cancel\"})]})]})}),showTripDetailsModal&&selectedTrip&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold\",children:selectedTrip.trips_scheduled?'Route Details':'Trip Details'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowTripDetailsModal(false),className:\"text-gray-400 hover:text-gray-600\",children:/*#__PURE__*/_jsx(X,{className:\"w-5 h-5\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 p-4 rounded-lg mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-lg\",children:selectedTrip.route_name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:selectedTrip.trip_number})]}),selectedTrip.trips_scheduled?/*#__PURE__*/_jsx(\"span\",{className:\"px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800\",children:\"ROUTE OVERVIEW\"}):/*#__PURE__*/_jsx(\"span\",{className:\"px-3 py-1 rounded-full text-sm font-medium \".concat(getStatusColor(selectedTrip.status)),children:selectedTrip.status.replace('_',' ').toUpperCase()})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-700 border-b pb-2\",children:selectedTrip.trips_scheduled?'Route Information':'Trip Information'}),selectedTrip.trips_scheduled?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Route\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium\",children:[selectedTrip.origin_name,\" \\u2192 \",selectedTrip.destination_name]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Scheduled Trips\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium\",children:[selectedTrip.trips_scheduled,\" trips\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Total Passengers\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium\",children:[selectedTrip.total_passengers||0,\" passengers\"]})]})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Departure\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:formatDate(selectedTrip.departure_datetime)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:formatTime(selectedTrip.departure_datetime)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Arrival (Est.)\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:formatDate(selectedTrip.estimated_arrival_datetime)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:formatTime(selectedTrip.estimated_arrival_datetime)})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Route\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium\",children:[selectedTrip.origin_name,\" \\u2192 \",selectedTrip.destination_name]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[selectedTrip.origin_city,\" to \",selectedTrip.destination_city]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Vehicle\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:selectedTrip.vehicle_model}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[selectedTrip.vehicle_number,\" | \",selectedTrip.license_plate,\" | \",selectedTrip.vehicle_type]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-700 border-b pb-2\",children:\"Occupancy & Pricing\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:selectedTrip.trips_scheduled?'Average Occupancy':'Seats'}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:selectedTrip.trips_scheduled?\"\".concat(selectedTrip.avg_occupancy||0,\"%\"):\"\".concat(selectedTrip.occupied_seats,\" / \").concat(selectedTrip.total_seats,\" occupied\")})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-20 bg-gray-200 rounded-full h-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-2 rounded-full transition-all\",style:{width:\"\".concat(Math.min(selectedTrip.occupancy_percentage||selectedTrip.avg_occupancy||0,100),\"%\"),backgroundColor:(selectedTrip.occupancy_percentage||selectedTrip.avg_occupancy||0)>80?'#EF4444':(selectedTrip.occupancy_percentage||selectedTrip.avg_occupancy||0)>60?'#F59E0B':'#10B981'}})}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium\",children:[selectedTrip.occupancy_percentage||selectedTrip.avg_occupancy||0,\"%\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:selectedTrip.trips_scheduled?'Total Revenue':'Base Price'}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium\",children:[\"RM \",selectedTrip.trips_scheduled?selectedTrip.total_revenue||0:selectedTrip.base_price]})]}),!selectedTrip.trips_scheduled&&selectedTrip.seat_pricing&&selectedTrip.seat_pricing.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Seat Type Pricing\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-1 mt-1\",children:selectedTrip.seat_pricing.map((pricing,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{children:pricing.seat_type_id.charAt(0).toUpperCase()+pricing.seat_type_id.slice(1)}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[pricing.price_multiplier,\"x\"]})]},index))})]}),!selectedTrip.trips_scheduled&&selectedTrip.pricing_rules&&selectedTrip.pricing_rules.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Pricing Rules\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-1 mt-1\",children:selectedTrip.pricing_rules.map((rule,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{children:rule.rule_name.replace(/_/g,' ').replace(/\\b\\w/g,l=>l.toUpperCase())}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[rule.rule_type==='discount'?'-':'+',rule.rule_value,\"%\"]})]},index))})]})]})]}),!selectedTrip.trips_scheduled&&selectedTrip.stops&&selectedTrip.stops.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-700 border-b pb-2 mb-4\",children:\"Route Stops\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:selectedTrip.stops.map((stop,index)=>{const isOrigin=index===0;const isDestination=index===selectedTrip.stops.length-1;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[!isDestination&&/*#__PURE__*/_jsx(\"div\",{className:\"h-full w-0.5 bg-blue-500 absolute left-2 top-3\"}),isOrigin||isDestination?/*#__PURE__*/_jsx(\"div\",{className:\"h-4 w-4 rounded-full bg-blue-500 mt-1\"}):/*#__PURE__*/_jsx(\"div\",{className:\"h-4 w-4 rounded-full border-2 border-blue-500 bg-white mt-1\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"ml-4 flex-1\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium\",children:[stop.location_name,isOrigin&&' (Origin)',isDestination&&' (Destination)']}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:stop.location_city})]}),!isOrigin&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500\",children:[\"+\",Math.floor(stop.arrival_offset_minutes/60),\" hrs\",stop.arrival_offset_minutes%60>0?\" \".concat(stop.arrival_offset_minutes%60,\" mins\"):'']}),stop.price_from_origin>0&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm font-medium\",children:[\"RM \",stop.price_from_origin]})]})]})})]},stop.id);})})]}),selectedTrip.trips_scheduled&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-700 border-b pb-2 mb-4\",children:\"Performance Data\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gray-50 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 mb-1\",children:\"Average Occupancy\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-xl font-semibold\",children:[selectedTrip.avg_occupancy||0,\"%\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full bg-gray-200 rounded-full h-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-2 rounded-full transition-all\",style:{width:\"\".concat(Math.min(selectedTrip.avg_occupancy||0,100),\"%\"),backgroundColor:(selectedTrip.avg_occupancy||0)>80?'#10B981':(selectedTrip.avg_occupancy||0)>60?'#F59E0B':'#EF4444'}})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gray-50 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 mb-1\",children:\"Total Revenue\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xl font-semibold text-green-600\",children:[\"RM \",selectedTrip.total_revenue||0]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gray-50 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 mb-1\",children:\"Total Passengers\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-semibold\",children:selectedTrip.total_passengers||0})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gray-50 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 mb-1\",children:\"Average Price Per Trip\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xl font-semibold\",children:[\"RM \",selectedTrip.trips_scheduled?(selectedTrip.total_revenue/selectedTrip.trips_scheduled).toFixed(2):0]})]})]})]}),selectedTrip.trips_scheduled&&selectedTrip.trips&&selectedTrip.trips.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-700 border-b pb-2 mb-4\",children:\"Scheduled Trips\"}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-hidden border border-gray-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Trip Number\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Departure\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Vehicle\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Occupancy\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:selectedTrip.trips.map(trip=>{var _trip$status;const occupiedSeats=trip.occupied_seats||trip.total_seats-trip.available_seats||0;const occupancyPercentage=trip.occupancy_percentage||(trip.total_seats?Math.round(occupiedSeats/trip.total_seats*100):0);return/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900\",children:trip.trip_number}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-3 whitespace-nowrap text-sm text-gray-500\",children:[/*#__PURE__*/_jsx(\"div\",{children:formatDate(trip.departure_datetime)}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs\",children:formatTime(trip.departure_datetime)})]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 whitespace-nowrap text-sm text-gray-500\",children:trip.vehicle_number||trip.license_plate||'N/A'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 whitespace-nowrap\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-16 bg-gray-200 rounded-full h-2 mr-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-2 rounded-full transition-all\",style:{width:\"\".concat(Math.min(occupancyPercentage,100),\"%\"),backgroundColor:occupancyPercentage>80?'#EF4444':occupancyPercentage>60?'#F59E0B':'#10B981'}})}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs font-medium\",children:[occupancyPercentage,\"%\"]})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 whitespace-nowrap\",children:/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full \".concat(getStatusColor(trip.status)),children:((_trip$status=trip.status)===null||_trip$status===void 0?void 0:_trip$status.replace('_',' ').toUpperCase())||'N/A'})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 whitespace-nowrap text-sm text-gray-500\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleTripClick(trip.id),className:\"text-blue-600 hover:text-blue-800\",children:\"View\"})})]},trip.id);})})]})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end space-x-3 pt-4 border-t\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn-secondary\",onClick:()=>setShowTripDetailsModal(false),children:\"Close\"})})]})})]});};// Analytics Component\nconst Analytics=()=>{var _analyticsData$totalR,_analyticsData$totalP;const[analyticsData,setAnalyticsData]=useState(null);const[routePerformance,setRoutePerformance]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState(null);// Add state for trip details modal\nconst[showTripDetailsModal,setShowTripDetailsModal]=useState(false);const[selectedTrip,setSelectedTrip]=useState(null);const[loadingTripDetails,setLoadingTripDetails]=useState(false);// Helper function to get status color\nconst getStatusColor=status=>{switch(status===null||status===void 0?void 0:status.toLowerCase()){case'scheduled':return'bg-blue-100 text-blue-800';case'boarding':return'bg-yellow-100 text-yellow-800';case'in_transit':return'bg-green-100 text-green-800';case'arrived':return'bg-purple-100 text-purple-800';case'cancelled':return'bg-red-100 text-red-800';case'delayed':return'bg-orange-100 text-orange-800';default:return'bg-gray-100 text-gray-800';}};// Helper functions for date formatting\nconst formatTime=datetime=>{if(!datetime)return'';try{return new Date(datetime).toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:true});}catch(error){console.error('Error formatting time:',error);return'';}};const formatDate=datetime=>{if(!datetime)return'';try{return new Date(datetime).toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'});}catch(error){console.error('Error formatting date:',error);return'';}};useEffect(()=>{const loadAnalyticsData=async()=>{setLoading(true);try{// 加载总体分析数据\nconst statsResponse=await getAnalyticsData();if(statsResponse.success){setAnalyticsData(statsResponse.data);}else{setError('Failed to load analytics data');}// 加载路线表现数据\nconst routeResponse=await getRouteAnalytics();if(routeResponse.success){setRoutePerformance(routeResponse.data);}else{setError('Failed to load route performance data');}}catch(err){console.error('Error loading analytics:',err);setError(handleApiError(err));}finally{setLoading(false);}};loadAnalyticsData();},[]);// Handle route click to show details\nconst handleRouteClick=async route=>{console.log(\"Route clicked:\",route);try{// 创建一个包含路线数据的对象，模拟行程详情结构\nconst routeDetails={id:route.id||Math.random().toString(36).substr(2,9),route_name:route.route_name||'Unknown Route',trip_number:\"Route-\".concat((route.route_name||'Unknown').replace(/\\s+/g,'-')),status:'active',origin_name:route.route_name?route.route_name.split(' - ')[0]:'Unknown',destination_name:route.route_name?route.route_name.split(' - ')[1]||'':'',origin_city:route.route_name?route.route_name.split(' - ')[0]:'Unknown',destination_city:route.route_name?route.route_name.split(' - ')[1]||'':'',base_price:route.total_revenue&&route.trips_scheduled?route.total_revenue/route.trips_scheduled:0,total_seats:0,available_seats:0,occupied_seats:route.total_passengers||0,occupancy_percentage:route.avg_occupancy||0,departure_datetime:new Date().toISOString(),estimated_arrival_datetime:new Date(new Date().getTime()+3600000).toISOString(),vehicle_model:'Various',vehicle_number:'Multiple',license_plate:'-',vehicle_type:'Various',// 添加路线特有的数据\ntrips_scheduled:route.trips_scheduled||0,total_passengers:route.total_passengers||0,total_revenue:route.total_revenue||0,avg_occupancy:route.avg_occupancy||0,// 空数组，避免undefined错误\nstops:[],seat_pricing:[],pricing_rules:[],// 添加行程列表，初始为空\ntrips:[]};// 获取该路线下的所有行程\ntry{setLoadingTripDetails(true);// 获取当前日期作为默认参数\nconst today=new Date();// 获取30天前的日期作为开始日期\nconst startDate=new Date(today);startDate.setDate(today.getDate()-30);// 获取30天后的日期作为结束日期\nconst endDate=new Date(today);endDate.setDate(today.getDate()+30);// 格式化日期为ISO字符串\nconst startDateStr=startDate.toISOString().split('T')[0];const endDateStr=endDate.toISOString().split('T')[0];console.log(\"Fetching trips from \".concat(startDateStr,\" to \").concat(endDateStr));const response=await getSchedules(startDateStr,endDateStr);if(response.success){// 过滤出与当前路线名称匹配的行程\nconst routeTrips=response.data.filter(trip=>trip.route_name===route.route_name);// 添加行程列表到路线详情\nrouteDetails.trips=routeTrips;console.log(\"Found trips for route:\",routeTrips.length);}else{console.error(\"Failed to fetch trips:\",response.message);}}catch(error){console.error(\"Error fetching trips for route:\",error);// 继续执行，即使获取行程失败\n}finally{setLoadingTripDetails(false);}// 设置选中的行程并显示模态框\nsetSelectedTrip(routeDetails);setShowTripDetailsModal(true);}catch(error){console.error(\"Error showing route details:\",error);alert('Failed to show route details');}};// Handle trip click\nconst handleTripClick=async tripId=>{setLoadingTripDetails(true);try{const response=await getTripDetails(tripId);if(response.success){setSelectedTrip(response.data);setShowTripDetailsModal(true);}else{alert('Failed to load trip details');}}catch(error){console.error('Error loading trip details:',error);alert('Error loading trip details');}finally{setLoadingTripDetails(false);}};if(loading){return/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center py-20\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-12 h-12 border-4 border-primary-600 border-t-transparent rounded-full animate-spin\"}),/*#__PURE__*/_jsx(\"p\",{className:\"mt-4 text-gray-600\",children:\"Loading analytics data...\"})]})});}if(error){return/*#__PURE__*/_jsxs(\"div\",{className:\"card bg-red-50 border-red-200\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center text-red-600 mb-2\",children:[/*#__PURE__*/_jsx(AlertCircle,{className:\"w-5 h-5 mr-2\"}),/*#__PURE__*/_jsx(\"h3\",{className:\"font-medium\",children:\"Error loading analytics\"})]}),/*#__PURE__*/_jsx(\"p\",{className:\"text-red-600\",children:error}),/*#__PURE__*/_jsx(\"button\",{className:\"mt-4 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-md\",onClick:()=>window.location.reload(),children:\"Retry\"})]});}return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900\",children:\"Analytics & Reports\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Total Revenue\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-2xl font-bold text-green-600\",children:[\"RM \",(analyticsData===null||analyticsData===void 0?void 0:(_analyticsData$totalR=analyticsData.totalRevenue)===null||_analyticsData$totalR===void 0?void 0:_analyticsData$totalR.toLocaleString())||'0']})]}),/*#__PURE__*/_jsx(TrendingUp,{className:\"w-8 h-8 text-green-600\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Average Occupancy\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-2xl font-bold text-blue-600\",children:[typeof(analyticsData===null||analyticsData===void 0?void 0:analyticsData.averageOccupancy)==='number'?analyticsData.averageOccupancy.toFixed(1):'0',\"%\"]})]}),/*#__PURE__*/_jsx(Users,{className:\"w-8 h-8 text-blue-600\"})]})}),/*#__PURE__*/_jsx(\"div\",{className:\"card\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:\"Total Passengers\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-2xl font-bold text-purple-600\",children:(analyticsData===null||analyticsData===void 0?void 0:(_analyticsData$totalP=analyticsData.totalPassengers)===null||_analyticsData$totalP===void 0?void 0:_analyticsData$totalP.toLocaleString())||'0'})]}),/*#__PURE__*/_jsx(Users,{className:\"w-8 h-8 text-purple-600\"})]})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-4\",children:\"Route Performance\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:routePerformance.length>0?routePerformance.map(route=>/*#__PURE__*/_jsx(\"div\",{className:\"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors\",onClick:()=>handleRouteClick(route),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-900\",children:route.route_name}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[route.trips_scheduled,\" trips scheduled\"]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right space-y-1\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm font-medium text-green-600\",children:[\"RM \",parseFloat(route.total_revenue||0).toLocaleString()]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-20 bg-gray-200 rounded-full h-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-2 rounded-full transition-all\",style:{width:\"\".concat(Math.min(route.avg_occupancy||0,100),\"%\"),backgroundColor:(route.avg_occupancy||0)>80?'#EF4444':(route.avg_occupancy||0)>60?'#F59E0B':'#10B981'}})}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs font-medium\",children:[typeof route.avg_occupancy==='number'?route.avg_occupancy.toFixed(0):'0',\"%\"]})]})]})]})},route.route_name)):/*#__PURE__*/_jsx(\"div\",{className:\"text-center py-8 text-gray-500\",children:/*#__PURE__*/_jsx(\"p\",{children:\"No route performance data available\"})})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-4\",children:\"Monthly Revenue\"}),/*#__PURE__*/_jsx(\"div\",{className:\"h-64 bg-gray-50 rounded-lg flex items-center justify-center\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"Monthly revenue chart will be displayed here\"})})]}),showTripDetailsModal&&selectedTrip&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-4\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold\",children:selectedTrip.trips_scheduled?'Route Details':'Trip Details'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowTripDetailsModal(false),className:\"text-gray-400 hover:text-gray-600\",children:/*#__PURE__*/_jsx(X,{className:\"w-5 h-5\"})})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-gray-50 p-4 rounded-lg mb-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold text-lg\",children:selectedTrip.route_name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:selectedTrip.trip_number})]}),selectedTrip.trips_scheduled?/*#__PURE__*/_jsx(\"span\",{className:\"px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800\",children:\"ROUTE OVERVIEW\"}):/*#__PURE__*/_jsx(\"span\",{className:\"px-3 py-1 rounded-full text-sm font-medium \".concat(getStatusColor(selectedTrip.status)),children:selectedTrip.status.replace('_',' ').toUpperCase()})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-700 border-b pb-2\",children:selectedTrip.trips_scheduled?'Route Information':'Trip Information'}),selectedTrip.trips_scheduled?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Route\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium\",children:[selectedTrip.origin_name,\" \\u2192 \",selectedTrip.destination_name]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Scheduled Trips\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium\",children:[selectedTrip.trips_scheduled,\" trips\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Total Passengers\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium\",children:[selectedTrip.total_passengers||0,\" passengers\"]})]})]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Departure\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:formatDate(selectedTrip.departure_datetime)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:formatTime(selectedTrip.departure_datetime)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Arrival (Est.)\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:formatDate(selectedTrip.estimated_arrival_datetime)}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm\",children:formatTime(selectedTrip.estimated_arrival_datetime)})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Route\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium\",children:[selectedTrip.origin_name,\" \\u2192 \",selectedTrip.destination_name]}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[selectedTrip.origin_city,\" to \",selectedTrip.destination_city]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Vehicle\"}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:selectedTrip.vehicle_model}),/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-600\",children:[selectedTrip.vehicle_number,\" | \",selectedTrip.license_plate,\" | \",selectedTrip.vehicle_type]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-700 border-b pb-2\",children:\"Occupancy & Pricing\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:selectedTrip.trips_scheduled?'Average Occupancy':'Seats'}),/*#__PURE__*/_jsx(\"p\",{className:\"font-medium\",children:selectedTrip.trips_scheduled?\"\".concat(selectedTrip.avg_occupancy||0,\"%\"):\"\".concat(selectedTrip.occupied_seats,\" / \").concat(selectedTrip.total_seats,\" occupied\")})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-20 bg-gray-200 rounded-full h-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-2 rounded-full transition-all\",style:{width:\"\".concat(Math.min(selectedTrip.occupancy_percentage||selectedTrip.avg_occupancy||0,100),\"%\"),backgroundColor:(selectedTrip.occupancy_percentage||selectedTrip.avg_occupancy||0)>80?'#EF4444':(selectedTrip.occupancy_percentage||selectedTrip.avg_occupancy||0)>60?'#F59E0B':'#10B981'}})}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-sm font-medium\",children:[selectedTrip.occupancy_percentage||selectedTrip.avg_occupancy||0,\"%\"]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:selectedTrip.trips_scheduled?'Total Revenue':'Base Price'}),/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium\",children:[\"RM \",selectedTrip.trips_scheduled?selectedTrip.total_revenue||0:selectedTrip.base_price]})]}),!selectedTrip.trips_scheduled&&selectedTrip.seat_pricing&&selectedTrip.seat_pricing.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Seat Type Pricing\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-1 mt-1\",children:selectedTrip.seat_pricing.map((pricing,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{children:pricing.seat_type_id.charAt(0).toUpperCase()+pricing.seat_type_id.slice(1)}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[pricing.price_multiplier,\"x\"]})]},index))})]}),!selectedTrip.trips_scheduled&&selectedTrip.pricing_rules&&selectedTrip.pricing_rules.length>0&&/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-500\",children:\"Pricing Rules\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-1 mt-1\",children:selectedTrip.pricing_rules.map((rule,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-sm\",children:[/*#__PURE__*/_jsx(\"span\",{children:rule.rule_name.replace(/_/g,' ').replace(/\\b\\w/g,l=>l.toUpperCase())}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[rule.rule_type==='discount'?'-':'+',rule.rule_value,\"%\"]})]},index))})]})]})]}),!selectedTrip.trips_scheduled&&selectedTrip.stops&&selectedTrip.stops.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-700 border-b pb-2 mb-4\",children:\"Route Stops\"}),/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:selectedTrip.stops.map((stop,index)=>{const isOrigin=index===0;const isDestination=index===selectedTrip.stops.length-1;return/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"relative\",children:[!isDestination&&/*#__PURE__*/_jsx(\"div\",{className:\"h-full w-0.5 bg-blue-500 absolute left-2 top-3\"}),isOrigin||isDestination?/*#__PURE__*/_jsx(\"div\",{className:\"h-4 w-4 rounded-full bg-blue-500 mt-1\"}):/*#__PURE__*/_jsx(\"div\",{className:\"h-4 w-4 rounded-full border-2 border-blue-500 bg-white mt-1\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"ml-4 flex-1\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"p\",{className:\"font-medium\",children:[stop.location_name,isOrigin&&' (Origin)',isDestination&&' (Destination)']}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:stop.location_city})]}),!isOrigin&&/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm text-gray-500\",children:[\"+\",Math.floor(stop.arrival_offset_minutes/60),\" hrs\",stop.arrival_offset_minutes%60>0?\" \".concat(stop.arrival_offset_minutes%60,\" mins\"):'']}),stop.price_from_origin>0&&/*#__PURE__*/_jsxs(\"p\",{className:\"text-sm font-medium\",children:[\"RM \",stop.price_from_origin]})]})]})})]},stop.id);})})]}),selectedTrip.trips_scheduled&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-700 border-b pb-2 mb-4\",children:\"Performance Data\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gray-50 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 mb-1\",children:\"Average Occupancy\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-xl font-semibold\",children:[selectedTrip.avg_occupancy||0,\"%\"]}),/*#__PURE__*/_jsx(\"div\",{className:\"w-full bg-gray-200 rounded-full h-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-2 rounded-full transition-all\",style:{width:\"\".concat(Math.min(selectedTrip.avg_occupancy||0,100),\"%\"),backgroundColor:(selectedTrip.avg_occupancy||0)>80?'#10B981':(selectedTrip.avg_occupancy||0)>60?'#F59E0B':'#EF4444'}})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gray-50 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 mb-1\",children:\"Total Revenue\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xl font-semibold text-green-600\",children:[\"RM \",selectedTrip.total_revenue||0]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gray-50 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 mb-1\",children:\"Total Passengers\"}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xl font-semibold\",children:selectedTrip.total_passengers||0})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 bg-gray-50 rounded-lg\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-500 mb-1\",children:\"Average Price Per Trip\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xl font-semibold\",children:[\"RM \",selectedTrip.trips_scheduled?(selectedTrip.total_revenue/selectedTrip.trips_scheduled).toFixed(2):0]})]})]})]}),selectedTrip.trips_scheduled&&selectedTrip.trips&&selectedTrip.trips.length>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-medium text-gray-700 border-b pb-2 mb-4\",children:\"Scheduled Trips\"}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-hidden border border-gray-200 rounded-lg\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full divide-y divide-gray-200\",children:[/*#__PURE__*/_jsx(\"thead\",{className:\"bg-gray-50\",children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Trip Number\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Departure\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Vehicle\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Occupancy\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Status\"}),/*#__PURE__*/_jsx(\"th\",{scope:\"col\",className:\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\",children:\"Actions\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{className:\"bg-white divide-y divide-gray-200\",children:selectedTrip.trips.map(trip=>{var _trip$status2;const occupiedSeats=trip.occupied_seats||trip.total_seats-trip.available_seats||0;const occupancyPercentage=trip.occupancy_percentage||(trip.total_seats?Math.round(occupiedSeats/trip.total_seats*100):0);return/*#__PURE__*/_jsxs(\"tr\",{className:\"hover:bg-gray-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900\",children:trip.trip_number}),/*#__PURE__*/_jsxs(\"td\",{className:\"px-4 py-3 whitespace-nowrap text-sm text-gray-500\",children:[/*#__PURE__*/_jsx(\"div\",{children:formatDate(trip.departure_datetime)}),/*#__PURE__*/_jsx(\"div\",{className:\"text-xs\",children:formatTime(trip.departure_datetime)})]}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 whitespace-nowrap text-sm text-gray-500\",children:trip.vehicle_number||trip.license_plate||'N/A'}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 whitespace-nowrap\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-16 bg-gray-200 rounded-full h-2 mr-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-2 rounded-full transition-all\",style:{width:\"\".concat(Math.min(occupancyPercentage,100),\"%\"),backgroundColor:occupancyPercentage>80?'#EF4444':occupancyPercentage>60?'#F59E0B':'#10B981'}})}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-xs font-medium\",children:[occupancyPercentage,\"%\"]})]})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 whitespace-nowrap\",children:/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full \".concat(getStatusColor(trip.status)),children:((_trip$status2=trip.status)===null||_trip$status2===void 0?void 0:_trip$status2.replace('_',' ').toUpperCase())||'N/A'})}),/*#__PURE__*/_jsx(\"td\",{className:\"px-4 py-3 whitespace-nowrap text-sm text-gray-500\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleTripClick(trip.id),className:\"text-blue-600 hover:text-blue-800\",children:\"View\"})})]},trip.id);})})]})})]}),selectedTrip.trips_scheduled&&selectedTrip.trips&&selectedTrip.trips.length===0&&/*#__PURE__*/_jsx(\"div\",{className:\"mb-6 p-8 bg-gray-50 rounded-lg text-center\",children:/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500\",children:\"No trips found for this route\"})}),/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-end space-x-3 pt-4 border-t\",children:/*#__PURE__*/_jsx(\"button\",{className:\"btn-secondary\",onClick:()=>setShowTripDetailsModal(false),children:\"Close\"})})]})})]});};// System Settings Component has been removed\n// Customer Service Component for Walk-in Ticket Sales\nconst CustomerService=()=>{const{locations,systemDate}=useApp();const[currentStep,setCurrentStep]=useState(1);// 1: Search, 2: Select Trip, 3: Customer Info, 4: Payment\nconst[searchResults,setSearchResults]=useState([]);const[selectedTrip,setSelectedTrip]=useState(null);const[customerInfo,setCustomerInfo]=useState({fullName:'',phone:'',email:'',icNumber:'',passengerCount:1});const[isProcessing,setIsProcessing]=useState(false);const[error,setError]=useState(null);// 添加热门行程\nconst[popularTrip,setPopularTrip]=useState({id:'1',route:{name:'KL - Johor Bahru Express'},origin:'Kuala Lumpur',destination:'Johor Bahru',departureTime:'08:00 AM',price:'RM 45.00'});const[searchForm,setSearchForm]=useState({origin:'',destination:'',date:systemDate,isRoundTrip:false,returnDate:format(addDays(new Date(systemDate),1),'yyyy-MM-dd')});// 添加处理热门行程选择的函数\nconst handlePopularTripSelect=trip=>{// 根据热门行程设置表单值\nconst fromLoc=locations.find(loc=>loc.city===trip.origin);const toLoc=locations.find(loc=>loc.city===trip.destination);if(fromLoc)setSearchForm(prev=>_objectSpread(_objectSpread({},prev),{},{origin:fromLoc.id}));if(toLoc)setSearchForm(prev=>_objectSpread(_objectSpread({},prev),{},{destination:toLoc.id}));// 自动搜索\nhandleSearch();};const handleSearch=async()=>{setIsProcessing(true);try{const searchParams={origin:searchForm.origin,destination:searchForm.destination,departureDate:searchForm.date,passengers:customerInfo.passengerCount};const response=await searchTrips(searchParams);if(response.success){setSearchResults(response.data);setCurrentStep(2);}else{setError('Failed to search trips. Please try again.');}}catch(err){console.error('Search error:',err);setError(handleApiError(err));}finally{setIsProcessing(false);}};const handleTripSelect=trip=>{setSelectedTrip(trip);setCurrentStep(3);};const handleCustomerSubmit=()=>{if(customerInfo.fullName&&customerInfo.phone){setCurrentStep(4);}};const handlePaymentComplete=()=>{// Process booking\nconst bookingRef=\"TBS\".concat(format(new Date(systemDate),'yyyyMMddHHmm'));alert(\"Booking confirmed! Reference: \".concat(bookingRef));// Reset form\nsetCurrentStep(1);setSearchResults([]);setSelectedTrip(null);setCustomerInfo({fullName:'',phone:'',email:'',icNumber:'',passengerCount:1});};const resetSearch=()=>{setCurrentStep(1);setSearchResults([]);setSelectedTrip(null);};return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[error&&/*#__PURE__*/_jsx(\"div\",{className:\"bg-red-50 border border-red-200 rounded-lg p-4\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-shrink-0\",children:/*#__PURE__*/_jsx(\"svg\",{className:\"h-5 w-5 text-red-400\",viewBox:\"0 0 20 20\",fill:\"currentColor\",children:/*#__PURE__*/_jsx(\"path\",{fillRule:\"evenodd\",d:\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\",clipRule:\"evenodd\"})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"ml-3\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-red-700\",children:error}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setError(null),className:\"mt-2 text-red-800 underline hover:text-red-900 text-sm\",children:\"Dismiss\"})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900\",children:\"Customer Service Portal\"}),/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-600\",children:\"Help walk-in customers purchase tickets quickly and efficiently\"})]}),currentStep>1&&/*#__PURE__*/_jsx(\"button\",{onClick:resetSearch,className:\"btn-secondary\",children:\"New Search\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\",children:/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-between\",children:['Search Trips','Select Trip','Customer Info','Payment'].map((step,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium \".concat(currentStep>index+1?'bg-green-500 text-white':currentStep===index+1?'bg-primary-500 text-white':'bg-gray-200 text-gray-600'),children:currentStep>index+1?'✓':index+1}),/*#__PURE__*/_jsx(\"span\",{className:\"ml-2 text-sm font-medium \".concat(currentStep>=index+1?'text-gray-900':'text-gray-500'),children:step}),index<3&&/*#__PURE__*/_jsx(\"div\",{className:\"w-8 h-0.5 mx-4 \".concat(currentStep>index+1?'bg-green-500':'bg-gray-200')})]},index))})}),currentStep===1&&/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-6\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"md:col-span-2\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-4\",children:\"Search Available Trips\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"From\"}),/*#__PURE__*/_jsxs(\"select\",{value:searchForm.origin,onChange:e=>setSearchForm(prev=>_objectSpread(_objectSpread({},prev),{},{origin:e.target.value})),className:\"input w-full\",required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select departure location\"}),locations.map(location=>/*#__PURE__*/_jsxs(\"option\",{value:location.id,children:[location.name,\", \",location.city]},location.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"To\"}),/*#__PURE__*/_jsxs(\"select\",{value:searchForm.destination,onChange:e=>setSearchForm(prev=>_objectSpread(_objectSpread({},prev),{},{destination:e.target.value})),className:\"input w-full\",required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"Select arrival location\"}),locations.map(location=>/*#__PURE__*/_jsxs(\"option\",{value:location.id,children:[location.name,\", \",location.city]},location.id))]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"Date\"}),/*#__PURE__*/_jsx(\"input\",{type:\"date\",value:searchForm.date,onChange:e=>setSearchForm(prev=>_objectSpread(_objectSpread({},prev),{},{date:e.target.value})),className:\"input w-full\",min:format(new Date(),'yyyy-MM-dd')})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"Passengers\"}),/*#__PURE__*/_jsx(\"select\",{value:customerInfo.passengerCount,onChange:e=>setCustomerInfo(prev=>_objectSpread(_objectSpread({},prev),{},{passengerCount:parseInt(e.target.value)})),className:\"input w-full\",children:[1,2,3,4,5,6,7,8].map(num=>/*#__PURE__*/_jsxs(\"option\",{value:num,children:[num,\" \",num===1?'passenger':'passengers']},num))})]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSearch,disabled:isProcessing||!searchForm.origin||!searchForm.destination,className:\"btn-primary w-full flex items-center justify-center\",children:isProcessing?/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:\"spinner-sm mr-2\"}),\"Searching...\"]}):/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Search,{className:\"w-4 h-4 mr-2\"}),\"Search Trips\"]})})]})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-4\",children:\"Popular Trip\"}),/*#__PURE__*/_jsx(PopularTrip,{trip:popularTrip,onSelect:handlePopularTripSelect})]})})]}),currentStep===2&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\",children:[/*#__PURE__*/_jsxs(\"h3\",{className:\"text-lg font-semibold mb-4\",children:[\"Available Trips (\",searchResults.length,\" found)\"]}),searchResults.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-center py-8 text-gray-500\",children:[/*#__PURE__*/_jsx(\"p\",{children:\"No trips found for the selected route and date.\"}),/*#__PURE__*/_jsx(\"button\",{onClick:resetSearch,className:\"btn-primary mt-4\",children:\"Try Another Search\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:searchResults.map(trip=>{var _locations$find3,_locations$find4;return/*#__PURE__*/_jsx(\"div\",{className:\"border border-gray-200 rounded-lg p-4 hover:border-primary-300 cursor-pointer\",onClick:()=>handleTripSelect(trip),children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex-1\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold text-lg\",children:trip.route.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600\",children:[(_locations$find3=locations.find(l=>l.id===trip.route.originId))===null||_locations$find3===void 0?void 0:_locations$find3.city,\" \\u2192\",(_locations$find4=locations.find(l=>l.id===trip.route.destinationId))===null||_locations$find4===void 0?void 0:_locations$find4.city]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold\",children:trip.departureDatetime.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Departure\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-semibold\",children:trip.arrivalDatetime.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}),/*#__PURE__*/_jsx(\"div\",{className:\"text-sm text-gray-600\",children:\"Arrival\"})]})]})}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-2xl font-bold text-primary-600\",children:[\"RM \",trip.route.basePrice]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600\",children:[trip.availableSeats,\" seats available\"]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-xs px-2 py-1 rounded-full \".concat(calculateOccupancy(trip)>80?'bg-red-100 text-red-600':calculateOccupancy(trip)>60?'bg-yellow-100 text-yellow-600':'bg-green-100 text-green-600'),children:[calculateOccupancy(trip),\"% occupied\"]})]})]})},trip.id);})})]}),currentStep===3&&selectedTrip&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-4\",children:\"Customer Information\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 rounded-lg p-4 mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold mb-2\",children:\"Selected Trip\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"font-medium\",children:selectedTrip.route.name}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600\",children:[selectedTrip.departureDatetime.toLocaleDateString(),\" at \",selectedTrip.departureDatetime.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-right\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"text-lg font-bold text-primary-600\",children:[\"RM \",selectedTrip.route.basePrice*customerInfo.passengerCount]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-600\",children:[customerInfo.passengerCount,\" passenger\",customerInfo.passengerCount>1?'s':'']})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"Full Name *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:customerInfo.fullName,onChange:e=>setCustomerInfo(prev=>_objectSpread(_objectSpread({},prev),{},{fullName:e.target.value})),className:\"input w-full\",placeholder:\"Enter customer's full name\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"Phone Number *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"tel\",value:customerInfo.phone,onChange:e=>setCustomerInfo(prev=>_objectSpread(_objectSpread({},prev),{},{phone:e.target.value})),className:\"input w-full\",placeholder:\"+60123456789\",required:true})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"Email Address\"}),/*#__PURE__*/_jsx(\"input\",{type:\"email\",value:customerInfo.email,onChange:e=>setCustomerInfo(prev=>_objectSpread(_objectSpread({},prev),{},{email:e.target.value})),className:\"input w-full\",placeholder:\"customer@email.com\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"label\",children:\"IC Number\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:customerInfo.icNumber,onChange:e=>setCustomerInfo(prev=>_objectSpread(_objectSpread({},prev),{},{icNumber:e.target.value})),className:\"input w-full\",placeholder:\"123456-78-9012\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setCurrentStep(2),className:\"btn-secondary\",children:\"Back to Trip Selection\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handleCustomerSubmit,disabled:!customerInfo.fullName||!customerInfo.phone,className:\"btn-primary\",children:\"Continue to Payment\"})]})]}),currentStep===4&&selectedTrip&&/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-4\",children:\"Payment & Confirmation\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"bg-gray-50 rounded-lg p-6 mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold mb-4\",children:\"Booking Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Route:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:selectedTrip.route.name})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Date & Time:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[selectedTrip.departureDatetime.toLocaleDateString(),\" at \",selectedTrip.departureDatetime.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Passenger:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:customerInfo.fullName})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Phone:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:customerInfo.phone})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Passengers:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium\",children:customerInfo.passengerCount})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between text-lg font-bold\",children:[/*#__PURE__*/_jsx(\"span\",{children:\"Total Amount:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"text-primary-600\",children:[\"RM \",selectedTrip.route.basePrice*customerInfo.passengerCount]})]})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-6\",children:[/*#__PURE__*/_jsx(\"h4\",{className:\"font-semibold mb-3\",children:\"Payment Method\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-3 gap-4\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"border-2 border-primary-500 bg-primary-50 text-primary-700 rounded-lg p-4 text-center\",children:\"\\uD83D\\uDCB3 Card Payment\"}),/*#__PURE__*/_jsx(\"button\",{className:\"border-2 border-gray-200 hover:border-gray-300 rounded-lg p-4 text-center\",children:\"\\uD83D\\uDCB0 Cash Payment\"}),/*#__PURE__*/_jsx(\"button\",{className:\"border-2 border-gray-200 hover:border-gray-300 rounded-lg p-4 text-center\",children:\"\\uD83D\\uDCF1 E-Wallet\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setCurrentStep(3),className:\"btn-secondary\",children:\"Back to Customer Info\"}),/*#__PURE__*/_jsx(\"button\",{onClick:handlePaymentComplete,className:\"btn-primary\",children:\"Confirm Payment & Issue Ticket\"})]})]})]});};// Route Management Component\nconst RouteManagement=_ref5=>{let{routes=[],onRefresh}=_ref5;const[showCreateModal,setShowCreateModal]=useState(false);const[locations,setLocations]=useState([]);const[loading,setLoading]=useState(false);const[createForm,setCreateForm]=useState({name:'',base_price:0,stops:[]});// Load locations for route creation\nuseEffect(()=>{const loadLocations=async()=>{try{const response=await getLocationsForRoutes();if(response.success){setLocations(response.data);}}catch(error){console.error('Error loading locations:',error);}};loadLocations();},[]);const handleAddStop=()=>{setCreateForm(prev=>_objectSpread(_objectSpread({},prev),{},{stops:[...prev.stops,{location_id:'',is_origin:prev.stops.length===0,// 第一个站点默认为起点\nis_destination:false,arrival_offset_minutes:prev.stops.length===0?0:30,// 起点的到达时间偏移为0\ndeparture_offset_minutes:5,price_from_origin:0}]}));};const handleRemoveStop=index=>{setCreateForm(prev=>{const newStops=prev.stops.filter((_,i)=>i!==index);// 如果删除了起点，将第一个站点设为新的起点\nif(prev.stops[index].is_origin&&newStops.length>0){newStops[0].is_origin=true;newStops[0].arrival_offset_minutes=0;}// 如果删除了终点，将最后一个站点设为新的终点\nif(prev.stops[index].is_destination&&newStops.length>0){newStops[newStops.length-1].is_destination=true;}return _objectSpread(_objectSpread({},prev),{},{stops:newStops});});};const handleStopChange=(index,field,value)=>{setCreateForm(prev=>{const newStops=[...prev.stops];// 特殊处理起点和终点的设置\nif(field==='is_origin'&&value===true){// 将其他站点的is_origin设为false\nnewStops.forEach((stop,i)=>{if(i!==index)stop.is_origin=false;});// 起点的到达时间偏移设为0\nnewStops[index].arrival_offset_minutes=0;}else if(field==='is_destination'&&value===true){// 将其他站点的is_destination设为false\nnewStops.forEach((stop,i)=>{if(i!==index)stop.is_destination=false;});}newStops[index]=_objectSpread(_objectSpread({},newStops[index]),{},{[field]:value});return _objectSpread(_objectSpread({},prev),{},{stops:newStops});});};const handleCreateRoute=async()=>{// 验证表单\nif(createForm.name.trim()===''){alert('请输入路线名称');return;}if(createForm.stops.length<2){alert('路线至少需要两个站点');return;}// 确保有起点和终点\nconst hasOrigin=createForm.stops.some(stop=>stop.is_origin);const hasDestination=createForm.stops.some(stop=>stop.is_destination);if(!hasOrigin){alert('请设置一个起点站');return;}if(!hasDestination){alert('请设置一个终点站');return;}// 确保所有站点都有选择位置\nconst allLocationsSelected=createForm.stops.every(stop=>stop.location_id);if(!allLocationsSelected){alert('请为所有站点选择位置');return;}// 准备提交的数据\nconst routeData={name:createForm.name,base_price:createForm.base_price,stops:createForm.stops.map(stop=>_objectSpread(_objectSpread({},stop),{},{arrival_offset_minutes:parseInt(stop.arrival_offset_minutes),departure_offset_minutes:parseInt(stop.departure_offset_minutes),price_from_origin:parseFloat(stop.price_from_origin)}))};// 获取起点和终点ID，用于兼容旧的API\nconst originStop=routeData.stops.find(stop=>stop.is_origin);const destinationStop=routeData.stops.find(stop=>stop.is_destination);if(originStop&&destinationStop){routeData.origin_id=originStop.location_id;routeData.destination_id=destinationStop.location_id;}setLoading(true);try{const response=await createRoute(routeData);if(response.success){setShowCreateModal(false);setCreateForm({name:'',base_price:0,stops:[]});onRefresh();alert('路线创建成功！');}else{alert('创建路线失败: '+(response.message||'未知错误'));}}catch(error){console.error('创建路线时出错:',error);alert('创建路线时出错');}finally{setLoading(false);}};// 自动生成路线名称\nconst generateRouteName=()=>{const originStop=createForm.stops.find(stop=>stop.is_origin);const destinationStop=createForm.stops.find(stop=>stop.is_destination);if(!originStop||!destinationStop)return;const originLocation=locations.find(loc=>loc.id===originStop.location_id);const destinationLocation=locations.find(loc=>loc.id===destinationStop.location_id);if(originLocation&&destinationLocation){const routeName=\"\".concat(originLocation.city,\" - \").concat(destinationLocation.city,\" Express\");setCreateForm(prev=>_objectSpread(_objectSpread({},prev),{},{name:routeName}));}};// Format duration from minutes to hours and minutes\nconst formatDuration=minutes=>{if(!minutes)return'N/A';const hours=Math.floor(minutes/60);const mins=minutes%60;return\"\".concat(hours,\"h \").concat(mins,\"m\");};return/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-6\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-2xl font-bold text-gray-900\",children:\"Route Management\"}),/*#__PURE__*/_jsxs(\"button\",{className:\"btn-primary flex items-center\",onClick:()=>setShowCreateModal(true),children:[/*#__PURE__*/_jsx(Plus,{className:\"w-4 h-4 mr-2\"}),\"Create New Route\"]})]}),/*#__PURE__*/_jsx(\"div\",{className:\"grid grid-cols-1 lg:grid-cols-2 gap-6\",children:routes.map(route=>/*#__PURE__*/_jsxs(\"div\",{className:\"card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-4\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-3\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\",children:/*#__PURE__*/_jsx(Map,{className:\"w-5 h-5 text-blue-600\"})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"h3\",{className:\"font-semibold text-gray-900\",children:route.name}),/*#__PURE__*/_jsx(\"p\",{className:\"text-sm text-gray-600\",children:route.route_code})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500\",children:[\"RM \",route.base_price]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2 text-sm text-gray-600\",children:[/*#__PURE__*/_jsx(MapPin,{className:\"w-4 h-4\"}),/*#__PURE__*/_jsxs(\"span\",{children:[route.origin_name,\" \\u2192 \",route.destination_name]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 grid grid-cols-3 gap-2 text-xs\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Distance:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium ml-1\",children:[route.distance_km||'N/A',\" km\"]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Duration:\"}),/*#__PURE__*/_jsx(\"span\",{className:\"font-medium ml-1\",children:formatDuration(route.estimated_duration_minutes)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Price:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium ml-1\",children:[\"RM \",route.base_price]})]})]}),route.total_trips>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-3 flex items-center justify-between text-xs\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Trip Count:\"}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[route.total_trips,\" trips\"]})]}),route.avg_occupancy>0&&/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between text-xs\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"text-gray-500\",children:\"Avg. Occupation:\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"w-16 bg-gray-200 rounded-full h-2\",children:/*#__PURE__*/_jsx(\"div\",{className:\"h-2 rounded-full transition-all\",style:{width:\"\".concat(Math.min(route.avg_occupancy||0,100),\"%\"),backgroundColor:(route.avg_occupancy||0)>80?'#EF4444':(route.avg_occupancy||0)>60?'#F59E0B':'#10B981'}})}),/*#__PURE__*/_jsxs(\"span\",{className:\"font-medium\",children:[typeof route.avg_occupancy==='number'?route.avg_occupancy.toFixed(0):'0',\"%\"]})]})]})]},route.id))}),showCreateModal&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\",children:/*#__PURE__*/_jsxs(\"div\",{className:\"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto\",children:[/*#__PURE__*/_jsx(\"h3\",{className:\"text-lg font-semibold mb-4\",children:\"\\u521B\\u5EFA\\u65B0\\u8DEF\\u7EBF\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"space-y-4\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"\\u8DEF\\u7EBF\\u540D\\u79F0\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-2\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:createForm.name,onChange:e=>setCreateForm(prev=>_objectSpread(_objectSpread({},prev),{},{name:e.target.value})),className:\"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\",placeholder:\"\\u4F8B\\u5982\\uFF1A\\u5409\\u9686\\u5761 - \\u69DF\\u57CE\\u5FEB\\u8F66\",required:true}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:generateRouteName,className:\"px-3 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200\",title:\"\\u6839\\u636E\\u8D77\\u70B9\\u548C\\u7EC8\\u70B9\\u81EA\\u52A8\\u751F\\u6210\\u8DEF\\u7EBF\\u540D\\u79F0\",children:\"\\u81EA\\u52A8\\u751F\\u6210\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700 mb-1\",children:\"\\u57FA\\u672C\\u7968\\u4EF7 (RM)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.50\",min:\"0\",value:createForm.base_price,onChange:e=>setCreateForm(prev=>_objectSpread(_objectSpread({},prev),{},{base_price:parseFloat(e.target.value)})),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\",placeholder:\"\\u4F8B\\u5982\\uFF1A45.00\",required:true}),/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:\"\\u8FD9\\u662F\\u4ECE\\u8D77\\u70B9\\u5230\\u7EC8\\u70B9\\u7684\\u5168\\u7A0B\\u7968\\u4EF7\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center justify-between mb-2\",children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-sm font-medium text-gray-700\",children:\"\\u8DEF\\u7EBF\\u7AD9\\u70B9\"}),/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"text-sm text-blue-600 hover:text-blue-800 flex items-center\",onClick:handleAddStop,children:[/*#__PURE__*/_jsx(Plus,{className:\"w-4 h-4 mr-1\"}),\"\\u6DFB\\u52A0\\u7AD9\\u70B9\"]})]}),createForm.stops.length===0?/*#__PURE__*/_jsxs(\"div\",{className:\"text-sm text-gray-500 text-center py-8 border border-dashed border-gray-300 rounded-md\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"mb-2\",children:\"\\u8FD8\\u6CA1\\u6709\\u6DFB\\u52A0\\u4EFB\\u4F55\\u7AD9\\u70B9\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"btn-primary text-sm px-4 py-2\",onClick:handleAddStop,children:\"\\u6DFB\\u52A0\\u7B2C\\u4E00\\u4E2A\\u7AD9\\u70B9\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"space-y-4\",children:createForm.stops.map((stop,index)=>/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 border rounded-md \".concat(stop.is_origin?'bg-blue-50 border-blue-200':stop.is_destination?'bg-green-50 border-green-200':'bg-gray-50 border-gray-200'),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex justify-between items-center mb-3\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center space-x-2\",children:[/*#__PURE__*/_jsxs(\"h4\",{className:\"text-sm font-medium text-gray-700\",children:[\"\\u7AD9\\u70B9 #\",index+1]}),stop.is_origin&&/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full\",children:\"\\u8D77\\u70B9\"}),stop.is_destination&&/*#__PURE__*/_jsx(\"span\",{className:\"px-2 py-0.5 bg-green-100 text-green-800 text-xs rounded-full\",children:\"\\u7EC8\\u70B9\"})]}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"text-sm text-red-600 hover:text-red-800\",onClick:()=>handleRemoveStop(index),children:/*#__PURE__*/_jsx(X,{className:\"w-4 h-4\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs text-gray-700 mb-1\",children:\"\\u4F4D\\u7F6E\"}),/*#__PURE__*/_jsxs(\"select\",{value:stop.location_id,onChange:e=>handleStopChange(index,'location_id',e.target.value),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm\",required:true,children:[/*#__PURE__*/_jsx(\"option\",{value:\"\",children:\"\\u9009\\u62E9\\u4F4D\\u7F6E\"}),locations.filter(loc=>!createForm.stops.some((s,i)=>i!==index&&s.location_id===loc.id)).map(location=>/*#__PURE__*/_jsxs(\"option\",{value:location.id,children:[location.name,\", \",location.city]},location.id))]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs text-gray-700 mb-1\",children:\"\\u4ECE\\u8D77\\u70B9\\u7684\\u7968\\u4EF7 (RM)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",step:\"0.50\",min:\"0\",value:stop.price_from_origin,onChange:e=>handleStopChange(index,'price_from_origin',parseFloat(e.target.value)),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"grid grid-cols-2 gap-3 mb-3\",children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs text-gray-700 mb-1\",children:\"\\u5230\\u8FBE\\u65F6\\u95F4\\u504F\\u79FB\\uFF08\\u5206\\u949F\\uFF09\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"0\",value:stop.arrival_offset_minutes,onChange:e=>handleStopChange(index,'arrival_offset_minutes',parseInt(e.target.value)),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm\",disabled:stop.is_origin// 起点的到达时间偏移固定为0\n}),stop.is_origin&&/*#__PURE__*/_jsx(\"p\",{className:\"text-xs text-gray-500 mt-1\",children:\"\\u8D77\\u70B9\\u7AD9\\u7684\\u5230\\u8FBE\\u65F6\\u95F4\\u504F\\u79FB\\u56FA\\u5B9A\\u4E3A0\"})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"label\",{className:\"block text-xs text-gray-700 mb-1\",children:\"\\u51FA\\u53D1\\u65F6\\u95F4\\u504F\\u79FB\\uFF08\\u5206\\u949F\\uFF09\"}),/*#__PURE__*/_jsx(\"input\",{type:\"number\",min:\"0\",value:stop.departure_offset_minutes,onChange:e=>handleStopChange(index,'departure_offset_minutes',parseInt(e.target.value)),className:\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm\"})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-4 mt-2\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:\"is_origin_\".concat(index),checked:stop.is_origin,onChange:e=>handleStopChange(index,'is_origin',e.target.checked),className:\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"is_origin_\".concat(index),className:\"ml-2 block text-sm text-gray-700\",children:\"\\u8BBE\\u4E3A\\u8D77\\u70B9\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"checkbox\",id:\"is_destination_\".concat(index),checked:stop.is_destination,onChange:e=>handleStopChange(index,'is_destination',e.target.checked),className:\"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded\"}),/*#__PURE__*/_jsx(\"label\",{htmlFor:\"is_destination_\".concat(index),className:\"ml-2 block text-sm text-gray-700\",children:\"\\u8BBE\\u4E3A\\u7EC8\\u70B9\"})]})]})]},index))}),createForm.stops.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 text-right\",children:/*#__PURE__*/_jsxs(\"button\",{type:\"button\",className:\"text-sm text-blue-600 hover:text-blue-800 flex items-center ml-auto\",onClick:handleAddStop,children:[/*#__PURE__*/_jsx(Plus,{className:\"w-4 h-4 mr-1\"}),\"\\u6DFB\\u52A0\\u66F4\\u591A\\u7AD9\\u70B9\"]})})]})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-3 mt-6\",children:[/*#__PURE__*/_jsx(\"button\",{className:\"btn-primary flex-1\",onClick:handleCreateRoute,disabled:loading||createForm.stops.length<2,children:loading?'创建中...':'创建路线'}),/*#__PURE__*/_jsx(\"button\",{className:\"btn-secondary flex-1\",onClick:()=>setShowCreateModal(false),disabled:loading,children:\"\\u53D6\\u6D88\"})]})]})})]});};export default AdminDashboard;","map":{"version":3,"names":["React","useState","useEffect","useRef","useNavigate","AdminLayout","useApp","AdminCustomerServicePortal","format","addDays","Calendar","Clock","MapPin","Bus","Users","Package","TrendingUp","DollarSign","BarChart2","BarChart3","Search","Plus","Edit","Trash","Trash2","Check","X","ChevronRight","ChevronDown","AlertTriangle","AlertCircle","Info","User","Phone","Mail","CreditCard","Printer","Save","Download","ArrowRight","FileText","MessageSquare","Send","Activity","Route","Settings","Map","getDashboardStats","getAnalyticsData","getVehicles","addVehicle","updateVehicle","getRoutes","getLocationsForRoutes","getTodaysSchedule","getRouteStops","createSchedule","getTripDetails","getPopularTrips","searchTrips","createBooking","formatCurrency","formatDate","formatTime","calculateOccupancy","getOccupancyColorClass","handleApiError","getRouteAnalytics","getSchedules","createRoute","RouteMap","PopularTrips","PopularTrip","RouteDetails","RouteSelector","LocationSelector","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","AdminDashboard","_ref","activeTab","setActiveTab","locations","systemDate","loading","setLoading","error","setError","stats","setStats","activeRoutes","activeTrips","fleetSize","scheduledTrips","routes","setRoutes","vehicles","setVehicles","todaysSchedule","setTodaysSchedule","selectedRoute","setSelectedRoute","showRouteDetails","setShowRouteDetails","detailRoute","setDetailRoute","popularTrips","setPopularTrips","id","route","name","origin","destination","departureTime","date","handlePopularTripSelect","trip","loadDashboardData","statsResponse","routesResponse","vehiclesResponse","scheduleResponse","Promise","all","success","data","err","console","handleRouteClick","handleViewRoute","clearSelection","className","children","viewBox","fill","fillRule","d","clipRule","onClick","map","_locations$find","_locations$find2","concat","e","stopPropagation","title","find","l","originId","city","destinationId","distanceKm","Math","floor","durationHours","round","basePrice","routeTrips","filter","routeId","avgOccupation","length","reduce","sum","style","width","min","backgroundColor","toFixed","selectedTrips","VehicleManagement","onRefresh","ScheduleManagement","Analytics","RouteManagement","zIndex","onClose","_ref2","showAddVehicle","setShowAddVehicle","editingVehicle","setEditingVehicle","showServiceModal","setShowServiceModal","handleAddVehicle","handleEditVehicle","vehicle","_objectSpread","editCapacity","vehicle_capacity","capacity","editMileage","current_mileage","editLastService","last_service_date","handleServiceVehicle","newStatus","status","response","fetch","method","headers","body","JSON","stringify","ok","message","setTimeout","alert","handleSaveEdit","updateData","license_plate","plateNumber","vehicle_number","model","toLocaleString","Date","toLocaleDateString","lastService","type","value","onChange","prev","parseInt","target","max","disabled","_ref3","selectedDate","setSelectedDate","filteredSchedule","setFilteredSchedule","showCreateModal","setShowCreateModal","createForm","setCreateForm","route_id","vehicle_id","departure_date","departure_time","base_price","seat_types","multiplier","enabled","pricing_rules","routeStops","setRouteStops","loadingStops","setLoadingStops","dateRange","setDateRange","startDate","endDate","loadingSchedule","setLoadingSchedule","viewMode","setViewMode","creatingTrip","setCreatingTrip","showTripDetailsModal","setShowTripDetailsModal","selectedTrip","setSelectedTrip","loadingTripDetails","setLoadingTripDetails","loadScheduleForDate","json","sortedSchedule","sort","a","b","dateA","departure_datetime","dateB","toDateString","getTime","loadRouteStops","datetime","toLocaleTimeString","hour","minute","getStatusColor","handleSeatTypeChange","updatedSeatTypes","parseFloat","handlePricingRuleToggle","updatedRules","rule","handlePricingRuleValueChange","handleCreateTrip","estimatedArrivalDatetime","lastStop","arrivalOffsetMinutes","arrival_offset_minutes","departureDatetime","seatTypePricing","seat_type_id","price_multiplier","pricingRules","rule_name","rule_type","rule_value","toISOString","estimated_arrival_datetime","seat_type_pricing","resetCreateForm","getTripsByDate","groupedTrips","forEach","push","setWeekView","currentDate","startOfWeek","setDate","getDate","getDay","endOfWeek","split","setMonthView","startOfMonth","getFullYear","getMonth","endOfMonth","setDayView","getDateRangeText","month","year","handleTripClick","tripId","occupiedSeats","occupied_seats","total_seats","available_seats","occupancyPercentage","occupancy_percentage","route_name","origin_name","destination_name","Object","entries","_ref4","trips","weekday","day","replace","toUpperCase","size","then","catch","vehicle_type_name","step","placeholder","seatType","checked","htmlFor","trips_scheduled","trip_number","total_passengers","origin_city","destination_city","vehicle_model","vehicle_type","avg_occupancy","total_revenue","seat_pricing","pricing","index","charAt","slice","stops","stop","isOrigin","isDestination","location_name","location_city","price_from_origin","scope","_trip$status","_analyticsData$totalR","_analyticsData$totalP","analyticsData","setAnalyticsData","routePerformance","setRoutePerformance","toLowerCase","hour12","loadAnalyticsData","routeResponse","log","routeDetails","random","toString","substr","today","startDateStr","endDateStr","window","location","reload","totalRevenue","averageOccupancy","totalPassengers","_trip$status2","CustomerService","currentStep","setCurrentStep","searchResults","setSearchResults","customerInfo","setCustomerInfo","fullName","phone","email","icNumber","passengerCount","isProcessing","setIsProcessing","popularTrip","setPopularTrip","price","searchForm","setSearchForm","isRoundTrip","returnDate","fromLoc","loc","toLoc","handleSearch","searchParams","departureDate","passengers","handleTripSelect","handleCustomerSubmit","handlePaymentComplete","bookingRef","resetSearch","required","num","onSelect","_locations$find3","_locations$find4","arrivalDatetime","availableSeats","_ref5","setLocations","loadLocations","handleAddStop","location_id","is_origin","is_destination","departure_offset_minutes","handleRemoveStop","newStops","_","i","handleStopChange","field","handleCreateRoute","trim","hasOrigin","some","hasDestination","allLocationsSelected","every","routeData","originStop","destinationStop","origin_id","destination_id","generateRouteName","originLocation","destinationLocation","routeName","formatDuration","minutes","hours","mins","route_code","distance_km","estimated_duration_minutes","total_trips","s"],"sources":["/Users/gohshunda/TWT-Transport-Booking/src/pages/admin/AdminDashboard.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport AdminLayout from '../../layouts/AdminLayout';\nimport { useApp } from '../../context/AppContext';\nimport AdminCustomerServicePortal from './AdminCustomerServicePortal';\nimport { format, addDays } from 'date-fns';\nimport { \n  Calendar, \n  Clock, \n  MapPin, \n  Bus, \n  Users, \n  Package, \n  TrendingUp,\n  DollarSign,\n  BarChart2,\n  BarChart3,\n  Search,\n  Plus,\n  Edit,\n  Trash,\n  Trash2,\n  Check,\n  X,\n  ChevronRight,\n  ChevronDown,\n  AlertTriangle,\n  AlertCircle,\n  Info,\n  User,\n  Phone,\n  Mail,\n  CreditCard,\n  Printer,\n  Save,\n  Download,\n  ArrowRight,\n  FileText,\n  MessageSquare,\n  Send,\n  Activity,\n  Route,\n  Settings,\n  Map\n} from 'lucide-react';\nimport { \n  getDashboardStats, \n  getAnalyticsData, \n  getVehicles,\n  addVehicle,\n  updateVehicle,\n  getRoutes,\n  getLocationsForRoutes,\n  getTodaysSchedule,\n  getRouteStops,\n  createSchedule,\n  getTripDetails,\n  getPopularTrips,\n  searchTrips,\n  createBooking,\n  formatCurrency,\n  formatDate,\n  formatTime,\n  calculateOccupancy,\n  getOccupancyColorClass,\n  handleApiError,\n  getRouteAnalytics,\n  getSchedules,\n  createRoute\n} from '../../services/adminApi';\nimport RouteMap from '../../components/admin/RouteMap';\nimport PopularTrips from '../../components/admin/PopularTrips';\nimport PopularTrip from '../../components/admin/PopularTrip';\nimport RouteDetails from '../../components/admin/RouteDetails';\nimport RouteSelector from '../../components/admin/RouteSelector';\nimport LocationSelector from '../../components/admin/LocationSelector';\n\nconst AdminDashboard = ({ activeTab = 'customer-service', setActiveTab }) => {\n  const { locations, systemDate } = useApp();\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  \n  const [stats, setStats] = useState({\n    activeRoutes: 0,\n    activeTrips: 0,\n    fleetSize: 0,\n    scheduledTrips: 0\n  });\n  \n\n  \n  const [routes, setRoutes] = useState([]);\n  const [vehicles, setVehicles] = useState([]);\n  const [todaysSchedule, setTodaysSchedule] = useState([]);\n  const [selectedRoute, setSelectedRoute] = useState(null);\n  const [showRouteDetails, setShowRouteDetails] = useState(false);\n  const [detailRoute, setDetailRoute] = useState(null);\n\n  const [popularTrips, setPopularTrips] = useState([\n    {\n      id: '1',\n      route: { id: '1', name: 'KL - Johor Bahru Express' },\n      origin: 'Kuala Lumpur',\n      destination: 'Johor Bahru',\n      departureTime: '08:00 AM',\n      date: '2023-06-25'\n    },\n    {\n      id: '2',\n      route: { id: '2', name: 'KL - Penang Highway' },\n      origin: 'Kuala Lumpur',\n      destination: 'Penang',\n      departureTime: '09:30 AM',\n      date: '2023-06-25'\n    },\n    {\n      id: '3',\n      route: { id: '3', name: 'KL - Malacca Direct' },\n      origin: 'Kuala Lumpur',\n      destination: 'Malacca',\n      departureTime: '10:15 AM',\n      date: '2023-06-25'\n    }\n  ]);\n\n  const handlePopularTripSelect = (trip) => {\n    // 显示行程详情\n    setDetailRoute(trip.route);\n    setShowRouteDetails(true);\n  };\n\n  useEffect(() => {\n    loadDashboardData();\n  }, []);\n\n  const loadDashboardData = async () => {\n    setLoading(true);\n    try {\n      // Load all dashboard data in parallel\n      const [\n        statsResponse,\n        routesResponse,\n        vehiclesResponse,\n        scheduleResponse\n      ] = await Promise.all([\n        getDashboardStats(),\n        getRoutes(),\n        getVehicles(),\n        getTodaysSchedule()\n      ]);\n\n      if (statsResponse.success) {\n        setStats(statsResponse.data);\n      }\n\n      if (routesResponse.success) {\n        setRoutes(routesResponse.data);\n      }\n\n      if (vehiclesResponse.success) {\n        setVehicles(vehiclesResponse.data);\n      }\n\n      if (scheduleResponse.success) {\n        setTodaysSchedule(scheduleResponse.data);\n      }\n\n      setError(null);\n    } catch (err) {\n      console.error('Error loading dashboard data:', err);\n      setError(handleApiError(err));\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleRouteClick = (route) => {\n    setSelectedRoute(route);\n  };\n\n  const handleViewRoute = (route) => {\n    setDetailRoute(route);\n    setShowRouteDetails(true);\n  };\n\n  const clearSelection = () => {\n    setSelectedRoute(null);\n  };\n\n  if (loading) {\n    return (\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"flex items-center justify-center h-64\">\n          <div className=\"w-8 h-8 border-4 border-primary-600 border-t-transparent rounded-full animate-spin\"></div>\n          <span className=\"ml-2 text-gray-600\">Loading dashboard data...</span>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n          <div className=\"flex\">\n            <div className=\"flex-shrink-0\">\n              <svg className=\"h-5 w-5 text-red-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\n              </svg>\n            </div>\n            <div className=\"ml-3\">\n              <h3 className=\"text-sm font-medium text-red-800\">Error loading dashboard</h3>\n              <div className=\"mt-2 text-sm text-red-700\">\n                <p>{error}</p>\n                <button \n                  onClick={loadDashboardData}\n                  className=\"mt-2 text-red-800 underline hover:text-red-900\"\n                >\n                  Try again\n                </button>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n      {/* Tab Content */}\n      {activeTab === 'customer-service' && (\n        <AdminCustomerServicePortal />\n      )}\n\n      {activeTab === 'overview' && (\n        <>\n          {/* Action Buttons */}\n          <div className=\"flex justify-end mb-6\">\n            <div className=\"flex space-x-3\">\n              <button \n                onClick={() => setActiveTab('analytics')}\n                className=\"btn-secondary flex items-center\"\n              >\n                <BarChart3 className=\"w-4 h-4 mr-2\" />\n                Analytics\n              </button>\n              <button \n                onClick={() => setActiveTab('schedule')}\n                className=\"btn-primary flex items-center\"\n              >\n                <Plus className=\"w-4 h-4 mr-2\" />\n                Add Route\n              </button>\n            </div>\n          </div>\n\n          {/* Stats Cards */}\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n            <div className=\"card\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-gray-600\">Active Routes</p>\n                  <p className=\"text-3xl font-bold text-primary-600\">{stats.activeRoutes}</p>\n                </div>\n                <div className=\"w-12 h-12 bg-primary-100 rounded-full flex items-center justify-center\">\n                  <Route className=\"w-6 h-6 text-primary-600\" />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"card\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-gray-600\">Active Trips</p>\n                  <p className=\"text-3xl font-bold text-success-600\">{stats.activeTrips}</p>\n                </div>\n                <div className=\"w-12 h-12 bg-success-100 rounded-full flex items-center justify-center\">\n                  <Bus className=\"w-6 h-6 text-success-600\" />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"card\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-gray-600\">Fleet Size</p>\n                  <p className=\"text-3xl font-bold text-warning-600\">{stats.fleetSize}</p>\n                </div>\n                <div className=\"w-12 h-12 bg-warning-100 rounded-full flex items-center justify-center\">\n                  <Settings className=\"w-6 h-6 text-warning-600\" />\n                </div>\n              </div>\n            </div>\n\n            <div className=\"card\">\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-gray-600\">Scheduled Trips</p>\n                  <p className=\"text-3xl font-bold text-purple-600\">{stats.scheduledTrips}</p>\n                </div>\n                <div className=\"w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center\">\n                  <Calendar className=\"w-6 h-6 text-purple-600\" />\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* Management Cards */}\n          <div className=\"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8\">\n            <div className=\"card hover:shadow-lg transition-shadow cursor-pointer\" onClick={() => setActiveTab('vehicles')}>\n              <div className=\"flex items-center justify-between mb-4\">\n                <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\n                  <Bus className=\"w-6 h-6 text-blue-600\" />\n                </div>\n                <ArrowRight className=\"w-5 h-5 text-gray-400\" />\n              </div>\n              <h3 className=\"font-semibold text-lg text-gray-900 mb-2\">Manage Vehicles</h3>\n              <p className=\"text-gray-600 text-sm\">Add, edit, or maintain vehicles</p>\n            </div>\n\n            <div className=\"card hover:shadow-lg transition-shadow cursor-pointer\" onClick={() => setActiveTab('schedule')}>\n              <div className=\"flex items-center justify-between mb-4\">\n                <div className=\"w-12 h-12 bg-green-100 rounded-full flex items-center justify-center\">\n                  <MapPin className=\"w-6 h-6 text-green-600\" />\n                </div>\n                <ArrowRight className=\"w-5 h-5 text-gray-400\" />\n              </div>\n              <h3 className=\"font-semibold text-lg text-gray-900 mb-2\">Route Planning</h3>\n              <p className=\"text-gray-600 text-sm\">Create and optimize routes</p>\n            </div>\n\n            <div className=\"card hover:shadow-lg transition-shadow cursor-pointer\" onClick={() => setActiveTab('schedule')}>\n              <div className=\"flex items-center justify-between mb-4\">\n                <div className=\"w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center\">\n                  <Calendar className=\"w-6 h-6 text-yellow-600\" />\n                </div>\n                <ArrowRight className=\"w-5 h-5 text-gray-400\" />\n              </div>\n              <h3 className=\"font-semibold text-lg text-gray-900 mb-2\">Schedule Trips</h3>\n              <p className=\"text-gray-600 text-sm\">Plan daily operations</p>\n            </div>\n\n            <div className=\"card hover:shadow-lg transition-shadow cursor-pointer\" onClick={() => setActiveTab('settings')}>\n              <div className=\"flex items-center justify-between mb-4\">\n                  <div className=\"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center\">\n                    <Activity className=\"w-6 h-6 text-blue-600\" />\n                </div>\n                <ArrowRight className=\"w-5 h-5 text-gray-400\" />\n              </div>\n                <h3 className=\"font-semibold text-lg text-gray-900 mb-2\">Recent Activity</h3>\n                <p className=\"text-gray-600 text-sm\">View recent system activities</p>\n            </div>\n          </div>\n\n          {/* Active Routes and Map */}\n          <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8\">\n            {/* Active Routes */}\n            <div className=\"card\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-lg font-semibold\">Active Routes</h3>\n                <button onClick={clearSelection} className=\"btn-secondary text-sm\">\n                  Clear Selection\n                </button>\n              </div>\n              \n              <div className=\"space-y-3 max-h-96 overflow-y-auto\">\n                {routes.map((route) => (\n                  <div \n                    key={route.id}\n                    className={`p-4 border rounded-lg cursor-pointer transition-colors ${\n                      selectedRoute?.id === route.id ? 'border-primary-500 bg-primary-50' : 'border-gray-200 hover:border-gray-300'\n                    }`}\n                    onClick={() => handleRouteClick(route)}\n                  >\n                    <div className=\"flex items-center justify-between\">\n                      <div className=\"flex-1\">\n                        <div className=\"flex items-center justify-between mb-2\">\n                          <h4 className=\"font-medium text-gray-900\">{route.name}</h4>\n                          <div className=\"flex space-x-2\">\n                            <button \n                              onClick={(e) => {\n                                e.stopPropagation();\n                                handleViewRoute(route);\n                              }}\n                              className=\"text-primary-600 hover:text-primary-700\"\n                              title=\"View Details\"\n                            >\n                              <BarChart3 className=\"w-4 h-4\" />\n                            </button>\n                            <button className=\"text-gray-400 hover:text-gray-600\" title=\"Edit\">\n                              <Edit className=\"w-4 h-4\" />\n                            </button>\n                            <button className=\"text-red-400 hover:text-red-600\" title=\"Delete\">\n                              <Trash2 className=\"w-4 h-4\" />\n                            </button>\n                          </div>\n                        </div>\n                        <div className=\"text-sm text-gray-600 space-y-1\">\n                          <div className=\"flex items-center\">\n                            <MapPin className=\"w-4 h-4 mr-2\" />\n                            {locations.find(l => l.id === route.originId)?.city} → {locations.find(l => l.id === route.destinationId)?.city}\n                          </div>\n                          <div className=\"flex items-center justify-between\">\n                            <span>Distance: {route.distanceKm} km</span>\n                            <span>Duration: {Math.floor(route.durationHours)}h {Math.round((route.durationHours % 1) * 60)}m</span>\n                            <span className=\"text-primary-600 font-medium\">Price: RM {route.basePrice}</span>\n                          </div>\n                          \n                          {/* Trip Occupation for this route */}\n                          <div className=\"mt-2\">\n                            {(() => {\n                              const routeTrips = todaysSchedule.filter(trip => trip.routeId === route.id);\n                              const avgOccupation = routeTrips.length > 0 \n                                ? routeTrips.reduce((sum, trip) => sum + calculateOccupancy(trip), 0) / routeTrips.length\n                                : 0;\n                              \n                              return avgOccupation > 0 && (\n                                <div className=\"flex items-center justify-between text-xs\">\n                                  <span className=\"text-gray-500\">Avg. Occupation:</span>\n                                  <div className=\"flex items-center space-x-2\">\n                                    <div className=\"w-16 bg-gray-200 rounded-full h-2\">\n                                      <div \n                                        className=\"h-2 rounded-full transition-all\"\n                                        style={{ \n                                          width: `${Math.min(avgOccupation, 100)}%`,\n                                          backgroundColor: avgOccupation > 80 ? '#EF4444' : avgOccupation > 60 ? '#F59E0B' : '#10B981'\n                                        }}\n                                      ></div>\n                                    </div>\n                                    <span className={`font-medium ${avgOccupation > 80 ? 'text-red-600' : avgOccupation > 60 ? 'text-yellow-600' : 'text-green-600'}`}>\n                                      {typeof avgOccupation === 'number' ? avgOccupation.toFixed(0) : '0'}%\n                                    </span>\n                                  </div>\n                                </div>\n                              );\n                            })()}\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            </div>\n\n            {/* Route Visualization */}\n            <div className=\"card\">\n              <div className=\"flex items-center justify-between mb-4\">\n                <h3 className=\"text-lg font-semibold\">Route Visualization</h3>\n                <button className=\"btn-secondary text-sm\">\n                  Clear Selection\n                </button>\n              </div>\n              \n              <div className=\"h-96 bg-gray-100 rounded-lg\">\n                <RouteMap \n                  routes={selectedRoute ? [selectedRoute] : routes}\n                  locations={locations}\n                  selectedTrips={todaysSchedule}\n                />\n              </div>\n            </div>\n          </div>\n        </>\n      )}\n\n      {activeTab === 'vehicles' && (\n        <VehicleManagement vehicles={vehicles} onRefresh={loadDashboardData} />\n      )}\n\n      {activeTab === 'schedule' && (\n        <ScheduleManagement \n          todaysSchedule={todaysSchedule} \n          routes={routes} \n          vehicles={vehicles} \n          onRefresh={loadDashboardData}\n        />\n      )}\n\n      {activeTab === 'analytics' && (\n        <Analytics />\n      )}\n\n      {activeTab === 'routes' && (\n         <RouteManagement routes={routes} onRefresh={loadDashboardData} />\n      )}\n\n      {/* Route Details Modal */}\n      {showRouteDetails && (\n        <div style={{ zIndex: 9999 }}>\n          <RouteDetails\n            route={detailRoute}\n            locations={locations}\n            onClose={() => {\n              setShowRouteDetails(false);\n              setDetailRoute(null);\n            }}\n          />\n        </div>\n      )}\n    </div>\n  );\n};\n\n// Vehicle Management Component\nconst VehicleManagement = ({ vehicles = [], onRefresh }) => {\n  const [showAddVehicle, setShowAddVehicle] = useState(false);\n  const [editingVehicle, setEditingVehicle] = useState(null);\n  const [showServiceModal, setShowServiceModal] = useState(null);\n\n  const handleAddVehicle = () => {\n    setShowAddVehicle(true);\n  };\n\n  const handleEditVehicle = (vehicle) => {\n    setEditingVehicle({\n      ...vehicle,\n      editCapacity: vehicle.vehicle_capacity || vehicle.capacity || 0,\n      editMileage: vehicle.current_mileage || 0,\n      editLastService: vehicle.last_service_date || ''\n    });\n  };\n\n  const handleServiceVehicle = async (vehicle) => {\n    try {\n      // Toggle between active and maintenance status\n      const newStatus = vehicle.status === 'active' ? 'maintenance' : 'active';\n      \n      const response = await fetch(`http://localhost:5001/api/admin/vehicles/${vehicle.id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({ status: newStatus }),\n      });\n\n      if (response.ok) {\n        setShowServiceModal({\n          ...vehicle,\n          newStatus,\n          message: newStatus === 'maintenance' \n            ? 'Vehicle has been marked for maintenance' \n            : 'Vehicle has been returned to active service'\n        });\n        // Refresh data after a short delay\n        setTimeout(() => {\n          onRefresh();\n        }, 1500);\n      } else {\n        alert('Failed to update vehicle status');\n      }\n    } catch (error) {\n      console.error('Error updating vehicle status:', error);\n      alert('Error updating vehicle status');\n    }\n  };\n\n  const handleSaveEdit = async () => {\n    try {\n      const updateData = {\n        current_mileage: editingVehicle.editMileage,\n        last_service_date: editingVehicle.editLastService || null\n      };\n\n      // Update capacity through vehicle_types if needed\n      if (editingVehicle.editCapacity !== editingVehicle.vehicle_capacity) {\n        // For now, we'll skip capacity update as it's tied to vehicle_type\n        // In a real scenario, you'd either update vehicle_type or create new type\n      }\n\n      const response = await fetch(`http://localhost:5001/api/admin/vehicles/${editingVehicle.id}`, {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify(updateData),\n      });\n\n      if (response.ok) {\n        setEditingVehicle(null);\n        onRefresh();\n        alert('Vehicle updated successfully!');\n      } else {\n        alert('Failed to update vehicle');\n      }\n    } catch (error) {\n      console.error('Error updating vehicle:', error);\n      alert('Error updating vehicle');\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-2xl font-bold text-gray-900\">Vehicle Management</h2>\n        <button \n          className=\"btn-primary flex items-center\"\n          onClick={handleAddVehicle}\n        >\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Add Vehicle\n        </button>\n      </div>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {vehicles.map((vehicle) => (\n          <div key={vehicle.id} className=\"card\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\n                  <Bus className=\"w-5 h-5 text-blue-600\" />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold text-gray-900\">{vehicle.license_plate || vehicle.plateNumber || vehicle.vehicle_number}</h3>\n                  <p className=\"text-sm text-gray-600\">{vehicle.model || 'N/A'}</p>\n                </div>\n              </div>\n              <span className={`px-2 py-1 rounded-full text-xs font-medium ${\n                vehicle.status === 'active' ? 'bg-green-100 text-green-800' :\n                vehicle.status === 'maintenance' ? 'bg-yellow-100 text-yellow-800' :\n                'bg-red-100 text-red-800'\n              }`}>\n                {vehicle.status}\n              </span>\n            </div>\n            \n            <div className=\"space-y-2 text-sm\">\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">Capacity:</span>\n                <span className=\"font-medium\">{vehicle.vehicle_capacity || vehicle.capacity || 'N/A'} seats</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">Mileage:</span>\n                <span className=\"font-medium\">{vehicle.current_mileage ? vehicle.current_mileage.toLocaleString() : 'N/A'} km</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span className=\"text-gray-600\">Last Service:</span>\n                <span className=\"font-medium\">\n                  {vehicle.last_service_date \n                    ? new Date(vehicle.last_service_date).toLocaleDateString('en-GB')\n                    : vehicle.lastService || 'N/A'}\n                </span>\n              </div>\n            </div>\n\n            <div className=\"mt-4 flex space-x-2\">\n              <button \n                className=\"btn-secondary text-xs flex-1\"\n                onClick={() => handleEditVehicle(vehicle)}\n              >\n                Edit\n              </button>\n              <button \n                className=\"btn-secondary text-xs flex-1\"\n                onClick={() => handleServiceVehicle(vehicle)}\n              >\n                Service\n              </button>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Add Vehicle Modal */}\n      {showAddVehicle && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg p-6 w-full max-w-md\">\n            <h3 className=\"text-lg font-semibold mb-4\">Add New Vehicle</h3>\n            <p className=\"text-gray-600 mb-4\">Add vehicle functionality coming soon...</p>\n            <button \n              className=\"btn-secondary w-full\"\n              onClick={() => setShowAddVehicle(false)}\n            >\n              Close\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Edit Vehicle Modal */}\n      {editingVehicle && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg p-6 w-full max-w-md\">\n            <h3 className=\"text-lg font-semibold mb-4\">Edit Vehicle: {editingVehicle.license_plate}</h3>\n            \n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Capacity (seats)\n                </label>\n                <input\n                  type=\"number\"\n                  value={editingVehicle.editCapacity}\n                  onChange={(e) => setEditingVehicle(prev => ({\n                    ...prev,\n                    editCapacity: parseInt(e.target.value)\n                  }))}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  min=\"1\"\n                  max=\"100\"\n                  disabled\n                />\n                <p className=\"text-xs text-gray-500 mt-1\">Capacity is determined by vehicle type</p>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Current Mileage (km)\n                </label>\n                <input\n                  type=\"number\"\n                  value={editingVehicle.editMileage}\n                  onChange={(e) => setEditingVehicle(prev => ({\n                    ...prev,\n                    editMileage: parseInt(e.target.value)\n                  }))}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  min=\"0\"\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  Last Service Date\n                </label>\n                <input\n                  type=\"date\"\n                  value={editingVehicle.editLastService}\n                  onChange={(e) => setEditingVehicle(prev => ({\n                    ...prev,\n                    editLastService: e.target.value\n                  }))}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                />\n              </div>\n            </div>\n\n            <div className=\"flex space-x-3 mt-6\">\n              <button \n                className=\"btn-primary flex-1\"\n                onClick={handleSaveEdit}\n              >\n                Save Changes\n              </button>\n              <button \n                className=\"btn-secondary flex-1\"\n                onClick={() => setEditingVehicle(null)}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Service Modal */}\n      {showServiceModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg p-6 w-full max-w-md\">\n            <h3 className=\"text-lg font-semibold mb-4\">Service Status: {showServiceModal.license_plate}</h3>\n            \n            <div className=\"text-center mb-6\">\n              <div className={`inline-flex items-center px-4 py-2 rounded-full text-sm font-medium ${\n                showServiceModal.newStatus === 'maintenance' \n                  ? 'bg-yellow-100 text-yellow-800' \n                  : 'bg-green-100 text-green-800'\n              }`}>\n                Status: {showServiceModal.newStatus === 'maintenance' ? 'Under Maintenance' : 'Active Service'}\n              </div>\n              \n              <p className=\"text-gray-600 mt-4\">{showServiceModal.message}</p>\n              \n              {showServiceModal.newStatus === 'maintenance' && (\n                <p className=\"text-sm text-yellow-600 mt-2\">\n                  Vehicle is now out of service. Click Service button again to return to active status.\n                </p>\n              )}\n            </div>\n\n            <button \n              className=\"btn-secondary w-full\"\n              onClick={() => setShowServiceModal(null)}\n            >\n              Close\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\n// Schedule Management Component\nconst ScheduleManagement = ({ todaysSchedule = [], routes = [], vehicles = [], onRefresh }) => {\n  const { systemDate } = useApp();\n  const [selectedDate, setSelectedDate] = useState(systemDate);\n  const [filteredSchedule, setFilteredSchedule] = useState([]);\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [createForm, setCreateForm] = useState({\n    route_id: '',\n    vehicle_id: '',\n    departure_date: systemDate,\n    departure_time: '08:00',\n    base_price: 0,\n    seat_types: [\n      { id: 'regular', name: 'Regular Seats', multiplier: 1.0, enabled: true },\n      { id: 'premium', name: 'Premium Seats', multiplier: 1.5, enabled: true },\n      { id: 'vip', name: 'VIP Seats', multiplier: 2.0, enabled: true }\n    ],\n    pricing_rules: [\n      { id: 'weekend', name: 'Weekend Pricing', type: 'surcharge', value: 15, enabled: false },\n      { id: 'holiday', name: 'Holiday Pricing', type: 'surcharge', value: 25, enabled: false },\n      { id: 'early_booking', name: 'Early Booking Discount', type: 'discount', value: 10, enabled: false }\n    ]\n  });\n  \n  // State for route stops\n  const [routeStops, setRouteStops] = useState([]);\n  const [loadingStops, setLoadingStops] = useState(false);\n\n  const [dateRange, setDateRange] = useState({\n    startDate: selectedDate,\n    endDate: selectedDate\n  });\n  const [loadingSchedule, setLoadingSchedule] = useState(false);\n  const [viewMode, setViewMode] = useState('day'); // 'day', 'week', 'month'\n\n  // State for loading and form submission\n  const [loading, setLoading] = useState(false);\n  const [creatingTrip, setCreatingTrip] = useState(false);\n\n  // Add state for trip details modal\n  const [showTripDetailsModal, setShowTripDetailsModal] = useState(false);\n  const [selectedTrip, setSelectedTrip] = useState(null);\n  const [loadingTripDetails, setLoadingTripDetails] = useState(false);\n\n  // Filter schedule by selected date or date range\n  // Load schedule data based on selected date and view mode\n  useEffect(() => {\n    const loadScheduleForDate = async () => {\n      setLoadingSchedule(true);\n      try {\n        // Use date range if in week or month view mode\n        const startDate = viewMode === 'day' ? selectedDate : dateRange.startDate;\n        const endDate = viewMode === 'day' ? selectedDate : dateRange.endDate;\n        \n        const response = await fetch(`http://localhost:5001/api/admin/schedules?startDate=${startDate}&endDate=${endDate}`);\n        if (response.ok) {\n          const data = await response.json();\n          if (data.success) {\n            // Sort by date then by departure time\n            const sortedSchedule = data.data.sort((a, b) => {\n              const dateA = new Date(a.departure_datetime);\n              const dateB = new Date(b.departure_datetime);\n              \n              if (dateA.toDateString() === dateB.toDateString()) {\n                return dateA.getTime() - dateB.getTime(); // Sort by time if same day\n              }\n              return dateA.getTime() - dateB.getTime(); // Sort by date\n            });\n            \n            setFilteredSchedule(sortedSchedule);\n          }\n        }\n      } catch (error) {\n        console.error('Error loading schedule for date:', error);\n        setFilteredSchedule([]);\n      } finally {\n        setLoadingSchedule(false);\n      }\n    };\n\n    loadScheduleForDate();\n  }, [selectedDate, dateRange, viewMode]);\n  \n  // Load route stops when a route is selected\n  useEffect(() => {\n    if (createForm.route_id) {\n      loadRouteStops();\n    }\n  }, [createForm.route_id]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  const loadRouteStops = async () => {\n    if (!createForm.route_id) {\n      setRouteStops([]);\n      return;\n    }\n\n    try {\n      setLoadingStops(true);\n      const response = await getRouteStops(createForm.route_id);\n      if (response.success) {\n        setRouteStops(response.data);\n      } else {\n        setRouteStops([]);\n      }\n    } catch (error) {\n      console.error('Error loading route stops:', error);\n      setRouteStops([]);\n    } finally {\n      setLoadingStops(false);\n    }\n  };\n  const formatTime = (datetime) => {\n    try {\n      return new Date(datetime).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});\n    } catch (error) {\n      return 'Invalid time';\n    }\n  };\n\n  const formatDate = (datetime) => {\n    try {\n      return new Date(datetime).toLocaleDateString('en-GB');\n    } catch (error) {\n      return 'Invalid date';\n    }\n  };\n\n  const getStatusColor = (status) => {\n    switch (status) {\n      case 'scheduled': return 'bg-blue-100 text-blue-800';\n      case 'boarding': return 'bg-yellow-100 text-yellow-800';\n      case 'in_transit': return 'bg-green-100 text-green-800';\n      case 'arrived': return 'bg-gray-100 text-gray-800';\n      case 'cancelled': return 'bg-red-100 text-red-800';\n      case 'delayed': return 'bg-orange-100 text-orange-800';\n      default: return 'bg-gray-100 text-gray-800';\n    }\n  };\n\n  // Handle seat type multiplier change\n  const handleSeatTypeChange = (id, value) => {\n    setCreateForm(prev => {\n      const updatedSeatTypes = prev.seat_types.map(type => \n        type.id === id ? { ...type, multiplier: parseFloat(value) } : type\n      );\n      return { ...prev, seat_types: updatedSeatTypes };\n    });\n  };\n  \n  // Handle pricing rule toggle\n  const handlePricingRuleToggle = (id, enabled) => {\n    setCreateForm(prev => {\n      const updatedRules = prev.pricing_rules.map(rule => \n        rule.id === id ? { ...rule, enabled } : rule\n      );\n      return { ...prev, pricing_rules: updatedRules };\n    });\n  };\n  \n  // Handle pricing rule value change\n  const handlePricingRuleValueChange = (id, value) => {\n    setCreateForm(prev => {\n      const updatedRules = prev.pricing_rules.map(rule => \n        rule.id === id ? { ...rule, value: parseInt(value, 10) } : rule\n      );\n      return { ...prev, pricing_rules: updatedRules };\n    });\n  };\n  \n  // Create trip schedule with enhanced options\n  const handleCreateTrip = async () => {\n    // Validate form\n    if (!createForm.route_id || !createForm.vehicle_id || !createForm.departure_date || !createForm.departure_time || !createForm.base_price) {\n      alert('Please fill in all required fields');\n      return;\n    }\n\n    try {\n      setCreatingTrip(true);\n\n      // Get route stops to calculate estimated arrival time\n      let estimatedArrivalDatetime;\n      \n      if (routeStops.length > 0) {\n        // If we have route stops, use the last stop's arrival offset\n        const lastStop = routeStops[routeStops.length - 1];\n        const arrivalOffsetMinutes = lastStop.arrival_offset_minutes || 0;\n        \n        // Calculate estimated arrival time\n        const departureDatetime = new Date(`${createForm.departure_date}T${createForm.departure_time}`);\n        estimatedArrivalDatetime = new Date(departureDatetime.getTime() + arrivalOffsetMinutes * 60000);\n      } else {\n        // Fallback: Add 4 hours if no route stops data\n        const departureDatetime = new Date(`${createForm.departure_date}T${createForm.departure_time}`);\n        estimatedArrivalDatetime = new Date(departureDatetime.getTime() + 4 * 60 * 60000);\n      }\n\n      // Format dates for API\n      const departureDatetime = new Date(`${createForm.departure_date}T${createForm.departure_time}`);\n      \n      // Prepare seat type pricing data\n      const seatTypePricing = createForm.seat_types\n        .filter(type => type.enabled)\n        .map(type => ({\n          seat_type_id: type.id,\n          name: type.name,\n          price_multiplier: parseFloat(type.multiplier)\n        }));\n\n      // Prepare pricing rules data\n      const pricingRules = createForm.pricing_rules\n        .filter(rule => rule.enabled)\n        .map(rule => ({\n          rule_name: rule.name,\n          rule_type: rule.type,\n          rule_value: parseInt(rule.value, 10)\n        }));\n\n      // Create schedule\n      const response = await createSchedule({\n        route_id: createForm.route_id,\n        vehicle_id: createForm.vehicle_id,\n        departure_datetime: departureDatetime.toISOString(),\n        estimated_arrival_datetime: estimatedArrivalDatetime.toISOString(),\n        base_price: parseFloat(createForm.base_price),\n        seat_type_pricing: seatTypePricing,\n        pricing_rules: pricingRules\n      });\n\n      if (response.success) {\n        setShowCreateModal(false);\n        resetCreateForm();\n        onRefresh();\n        alert('Trip scheduled successfully!');\n      } else {\n        alert('Failed to schedule trip: ' + (response.message || 'Unknown error'));\n      }\n    } catch (error) {\n      console.error('Error creating trip:', error);\n      alert('Error scheduling trip: ' + (error.message || 'Unknown error'));\n    } finally {\n      setCreatingTrip(false);\n    }\n  };\n\n  // Function to group trips by date\n  const getTripsByDate = () => {\n    const groupedTrips = {};\n    \n    filteredSchedule.forEach(trip => {\n      const date = new Date(trip.departure_datetime).toDateString();\n      if (!groupedTrips[date]) {\n        groupedTrips[date] = [];\n      }\n      groupedTrips[date].push(trip);\n    });\n    \n    return groupedTrips;\n  };\n  \n  // Set week view dates\n  const setWeekView = () => {\n    const currentDate = new Date(selectedDate);\n    const startOfWeek = new Date(currentDate);\n    startOfWeek.setDate(currentDate.getDate() - currentDate.getDay());\n    \n    const endOfWeek = new Date(startOfWeek);\n    endOfWeek.setDate(startOfWeek.getDate() + 6);\n    \n    setDateRange({\n      startDate: startOfWeek.toISOString().split('T')[0],\n      endDate: endOfWeek.toISOString().split('T')[0]\n    });\n    setViewMode('week');\n  };\n  \n  // Set month view dates\n  const setMonthView = () => {\n    const currentDate = new Date(selectedDate);\n    const startOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);\n    const endOfMonth = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);\n    \n    setDateRange({\n      startDate: startOfMonth.toISOString().split('T')[0],\n      endDate: endOfMonth.toISOString().split('T')[0]\n    });\n    setViewMode('month');\n  };\n  \n  // Switch back to day view\n  const setDayView = () => {\n    setViewMode('day');\n  };\n  \n  // Get formatted date range text based on view mode\n  const getDateRangeText = () => {\n    if (viewMode === 'day') {\n      return `Schedule for ${formatDate(selectedDate)}`;\n    } \n    else if (viewMode === 'week') {\n      return `Week of ${formatDate(dateRange.startDate)} - ${formatDate(dateRange.endDate)}`;\n    }\n    else {\n      return `Month of ${new Date(dateRange.startDate).toLocaleString('en-US', {month: 'long', year: 'numeric'})}`;\n    }\n  };\n\n  // Reset create form to initial state\n  const resetCreateForm = () => {\n    setCreateForm({\n      route_id: '',\n      vehicle_id: '',\n      departure_date: systemDate,\n      departure_time: '08:00',\n      base_price: 0,\n      seat_types: [\n        { id: 'regular', name: 'Regular Seats', multiplier: 1.0, enabled: true },\n        { id: 'premium', name: 'Premium Seats', multiplier: 1.5, enabled: true },\n        { id: 'vip', name: 'VIP Seats', multiplier: 2.0, enabled: true }\n      ],\n      pricing_rules: [\n        { id: 'weekend', name: 'Weekend Pricing', type: 'surcharge', value: 15, enabled: false },\n        { id: 'holiday', name: 'Holiday Pricing', type: 'surcharge', value: 25, enabled: false },\n        { id: 'early_booking', name: 'Early Booking Discount', type: 'discount', value: 10, enabled: false }\n      ]\n    });\n    setRouteStops([]);\n  };\n\n  // Handle trip click\n  const handleTripClick = async (tripId) => {\n    setLoadingTripDetails(true);\n    try {\n      const response = await getTripDetails(tripId);\n      if (response.success) {\n        setSelectedTrip(response.data);\n        setShowTripDetailsModal(true);\n      } else {\n        alert('Failed to load trip details');\n      }\n    } catch (error) {\n      console.error('Error loading trip details:', error);\n      alert('Error loading trip details');\n    } finally {\n      setLoadingTripDetails(false);\n    }\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex flex-wrap justify-between items-center gap-4\">\n        <h2 className=\"text-2xl font-bold text-gray-900\">Schedule Management</h2>\n        <div className=\"flex flex-wrap items-center gap-3\">\n          {/* View mode selector */}\n          <div className=\"inline-flex rounded-md shadow-sm\">\n            <button\n              className={`px-4 py-2 text-sm font-medium ${viewMode === 'day' ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-50'} border border-gray-300 rounded-l-md focus:z-10`}\n              onClick={setDayView}\n            >\n              Day\n            </button>\n            <button\n              className={`px-4 py-2 text-sm font-medium ${viewMode === 'week' ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-50'} border-t border-b border-r border-gray-300 focus:z-10`}\n              onClick={setWeekView}\n            >\n              Week\n            </button>\n            <button\n              className={`px-4 py-2 text-sm font-medium ${viewMode === 'month' ? 'bg-blue-600 text-white' : 'bg-white text-gray-700 hover:bg-gray-50'} border-t border-b border-r border-gray-300 rounded-r-md focus:z-10`}\n              onClick={setMonthView}\n            >\n              Month\n            </button>\n          </div>\n          \n          {/* Date selector */}\n          <input\n            type=\"date\"\n            value={selectedDate}\n            onChange={(e) => setSelectedDate(e.target.value)}\n            className=\"px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n            min={systemDate}\n            max=\"2025-07-31\"\n          />\n          \n          <button \n            className=\"btn-primary flex items-center\"\n            onClick={() => setShowCreateModal(true)}\n          >\n          <Calendar className=\"w-4 h-4 mr-2\" />\n          Create Schedule\n        </button>\n        </div>\n      </div>\n\n      {loadingSchedule ? (\n        <div className=\"card py-16\">\n          <div className=\"flex flex-col items-center justify-center\">\n            <div className=\"w-12 h-12 border-4 border-t-4 border-primary-600 border-t-transparent rounded-full animate-spin\"></div>\n            <p className=\"mt-4 text-gray-600\">Loading schedule data...</p>\n          </div>\n        </div>\n      ) : (\n      <div className=\"card\">\n          <h3 className=\"text-lg font-semibold mb-4\">\n            {getDateRangeText()}\n            <span className=\"ml-2 text-sm font-normal text-gray-600\">\n              ({filteredSchedule.length} trips)\n            </span>\n          </h3>\n          \n          {filteredSchedule.length === 0 ? (\n            <div className=\"text-center py-8 text-gray-500\">\n              <Calendar className=\"w-12 h-12 mx-auto mb-3 text-gray-300\" />\n              <p>No trips scheduled for this period</p>\n            </div>\n          ) : viewMode === 'day' ? (\n            // Day view - simple list\n        <div className=\"space-y-3\">\n              {filteredSchedule.map((trip) => {\n                const occupiedSeats = trip.occupied_seats || (trip.total_seats - trip.available_seats);\n                const occupancyPercentage = trip.occupancy_percentage || \n                  Math.round((occupiedSeats / trip.total_seats) * 100);\n                \n            return (\n                  <div \n                    key={trip.id} \n                    className=\"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer\"\n                    onClick={() => handleTripClick(trip.id)}\n                  >\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex-1\">\n                        <div className=\"flex items-center justify-between mb-2\">\n                          <h4 className=\"font-medium text-gray-900\">{trip.route_name}</h4>\n                          <div className=\"flex space-x-2\">\n                            <button \n                              onClick={(e) => {\n                                e.stopPropagation();\n                                handleTripClick(trip.id);\n                              }}\n                              className=\"text-primary-600 hover:text-primary-700\"\n                              title=\"View Details\"\n                            >\n                              <BarChart3 className=\"w-4 h-4\" />\n                            </button>\n                            <button \n                              onClick={(e) => e.stopPropagation()}\n                              className=\"text-gray-400 hover:text-gray-600\" \n                              title=\"Edit\"\n                            >\n                              <Edit className=\"w-4 h-4\" />\n                            </button>\n                            <button \n                              onClick={(e) => e.stopPropagation()}\n                              className=\"text-red-400 hover:text-red-600\" \n                              title=\"Delete\"\n                            >\n                              <Trash2 className=\"w-4 h-4\" />\n                            </button>\n                          </div>\n                        </div>\n                        <div className=\"text-sm text-gray-600 space-y-1\">\n                          <div className=\"flex items-center\">\n                            <MapPin className=\"w-4 h-4 mr-2\" />\n                            {trip.origin_name} → {trip.destination_name}\n                          </div>\n                          <div className=\"flex items-center justify-between\">\n                            <span>Departure: {formatTime(trip.departure_datetime)}</span>\n                            <span>Arrival: {formatTime(trip.estimated_arrival_datetime)}</span>\n                          </div>\n                          <div className=\"flex items-center justify-between\">\n                            <span>Vehicle: {trip.vehicle_number || trip.license_plate}</span>\n                            <span className=\"text-primary-600 font-medium\">Price: RM {trip.base_price}</span>\n                          </div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n                );\n              })}\n            </div>\n          ) : (\n            // Week/Month view - grouped by date\n            <div className=\"space-y-6\">\n              {Object.entries(getTripsByDate()).length === 0 ? (\n                <div className=\"py-10 text-center text-gray-500\">\n                  No trips scheduled for this period\n                </div>\n              ) : (\n                Object.entries(getTripsByDate()).map(([date, trips]) => (\n                  <div key={date} className=\"py-4\">\n                    <div className=\"px-4 py-2 bg-gray-50 font-medium\">\n                      {new Date(date).toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric', year: 'numeric' })}\n                    </div>\n                    \n                    <div className=\"divide-y divide-gray-100\">\n                      {trips.map(trip => (\n                        <div \n                          key={trip.id} \n                          className=\"p-4 hover:bg-gray-50 cursor-pointer transition-colors\"\n                          onClick={() => handleTripClick(trip.id)}\n                        >\n                          <div className=\"flex items-center justify-between\">\n                    <div className=\"flex items-center space-x-4\">\n                              <div className=\"text-lg font-medium w-20 text-gray-900\">\n                                {formatTime(trip.departure_datetime)}\n                      </div>\n                              <div>\n                                <div className=\"font-medium text-gray-900\">{trip.route_name}</div>\n                      <div className=\"text-sm text-gray-600\">\n                                  {trip.origin_name} → {trip.destination_name}\n                      </div>\n                    </div>\n                  </div>\n                            \n                            <div className=\"flex items-center space-x-6\">\n                              <div className=\"text-sm text-gray-600\">\n                                {trip.vehicle_number || trip.license_plate}\n                      </div>\n                              \n                              <div>\n                                <span className={`px-2 py-1 rounded-full text-xs font-medium ${getStatusColor(trip.status)}`}>\n                                  {trip.status.replace('_', ' ').toUpperCase()}\n                                </span>\n                    </div>\n                            </div>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                ))\n              )}\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Create Schedule Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto\">\n            <div className=\"flex justify-between items-center mb-4\">\n              <h3 className=\"text-lg font-semibold\">Create New Trip Schedule</h3>\n              <button \n                onClick={() => setShowCreateModal(false)}\n                className=\"text-gray-400 hover:text-gray-600\"\n              >\n                <X size={20} />\n              </button>\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n              {/* Left Column - Basic Trip Information */}\n              <div className=\"space-y-4\">\n                <h4 className=\"font-medium text-gray-700\">Basic Trip Information</h4>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Route\n                  </label>\n                  <RouteSelector \n                    value={createForm.route_id}\n                    onChange={(value) => {\n                      setCreateForm(prev => ({ ...prev, route_id: value }));\n                      if (value) {\n                        // When route changes, load route stops\n                        getRouteStops(value).then(response => {\n                          if (response.success) {\n                            setRouteStops(response.data || []);\n                          } else {\n                            setRouteStops([]);\n                          }\n                        }).catch(err => {\n                          console.error('Error loading route stops:', err);\n                          setRouteStops([]);\n                        });\n                      } else {\n                        setRouteStops([]);\n                      }\n                    }}\n                  />\n                </div>\n\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Vehicle\n                  </label>\n                  <select\n                    value={createForm.vehicle_id}\n                    onChange={(e) => setCreateForm(prev => ({ ...prev, vehicle_id: e.target.value }))}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  >\n                    <option value=\"\">Select a vehicle</option>\n                    {vehicles.map(vehicle => (\n                      <option key={vehicle.id} value={vehicle.id}>\n                        {vehicle.vehicle_number} - {vehicle.license_plate} ({vehicle.vehicle_type_name})\n                      </option>\n                    ))}\n                  </select>\n                </div>\n\n                <div className=\"grid grid-cols-2 gap-3\">\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Departure Date\n                    </label>\n                    <input\n                      type=\"date\"\n                      value={createForm.departure_date}\n                      onChange={(e) => setCreateForm(prev => ({ ...prev, departure_date: e.target.value }))}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                      min={systemDate}\n                    />\n                  </div>\n\n                  <div>\n                    <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                      Departure Time\n                    </label>\n                    <input\n                      type=\"time\"\n                      value={createForm.departure_time}\n                      onChange={(e) => setCreateForm(prev => ({ ...prev, departure_time: e.target.value }))}\n                      className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    />\n                  </div>\n                </div>\n              </div>\n              \n              {/* Right Column - Pricing and Seats */}\n              <div className=\"space-y-4\">\n                <h4 className=\"font-medium text-gray-700\">Pricing Configuration</h4>\n                \n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                    Base Price (RM)\n                  </label>\n                  <input\n                    type=\"number\"\n                    step=\"0.50\"\n                    min=\"0\"\n                    value={createForm.base_price}\n                    onChange={(e) => setCreateForm(prev => ({ ...prev, base_price: e.target.value }))}\n                    className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    placeholder=\"e.g. 45.00\"\n                  />\n                </div>\n\n                {/* Seat Type Pricing */}\n                <div className=\"bg-gray-50 p-3 rounded-lg border border-gray-200\">\n                  <h5 className=\"text-sm font-medium text-gray-700 mb-2\">Seat Type Pricing</h5>\n                  <div className=\"space-y-3 mt-3\">\n                    {createForm.seat_types.map(seatType => (\n                      <div key={seatType.id} className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center\">\n                          <input \n                            type=\"checkbox\" \n                            id={`${seatType.id}-seats`} \n                            className=\"mr-2\" \n                            checked={seatType.enabled} \n                            onChange={(e) => {\n                              const updatedSeatTypes = createForm.seat_types.map(type => \n                                type.id === seatType.id ? { ...type, enabled: e.target.checked } : type\n                              );\n                              setCreateForm(prev => ({ ...prev, seat_types: updatedSeatTypes }));\n                            }}\n                          />\n                          <label htmlFor={`${seatType.id}-seats`} className=\"text-sm\">{seatType.name}</label>\n                        </div>\n                        <div className=\"text-sm flex items-center\">\n                          <span className=\"text-gray-500 mr-2\">Multiplier:</span>\n                          {seatType.id === 'regular' ? (\n                            <span className=\"font-medium\">1.0x</span>\n                          ) : (\n                            <input \n                              type=\"number\" \n                              step=\"0.1\" \n                              min=\"1\" \n                              className=\"w-16 px-2 py-1 border border-gray-300 rounded-md\" \n                              value={seatType.multiplier} \n                              onChange={(e) => handleSeatTypeChange(seatType.id, e.target.value)}\n                            />\n                          )}\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n\n                {/* Dynamic Pricing Rules */}\n                <div className=\"bg-gray-50 p-3 rounded-lg border border-gray-200\">\n                  <h5 className=\"text-sm font-medium text-gray-700 mb-2\">Dynamic Pricing Rules</h5>\n                  <div className=\"space-y-3 mt-3\">\n                    {createForm.pricing_rules.map(rule => (\n                      <div key={rule.id} className=\"flex items-center justify-between\">\n                        <div className=\"flex items-center\">\n                          <input \n                            type=\"checkbox\" \n                            id={rule.id} \n                            className=\"mr-2\" \n                            checked={rule.enabled}\n                            onChange={(e) => handlePricingRuleToggle(rule.id, e.target.checked)}\n                          />\n                          <label htmlFor={rule.id} className=\"text-sm\">{rule.name}</label>\n                        </div>\n                        <div className=\"text-sm flex items-center\">\n                          <span className=\"text-gray-500 mr-2\">{rule.id === 'early_booking' ? '-' : '+'}</span>\n                          <input \n                            type=\"number\" \n                            step=\"1\" \n                            min=\"0\" \n                            className=\"w-16 px-2 py-1 border border-gray-300 rounded-md\" \n                            value={rule.value} \n                            disabled={!rule.enabled}\n                            onChange={(e) => handlePricingRuleValueChange(rule.id, e.target.value)}\n                          />\n                          <span className=\"text-gray-500 ml-1\">%</span>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n            </div>\n\n            <div className=\"flex space-x-3 mt-6\">\n              <button \n                className=\"btn-primary flex-1\"\n                onClick={handleCreateTrip}\n                disabled={creatingTrip || !createForm.route_id || !createForm.vehicle_id || !createForm.departure_date || !createForm.departure_time || !createForm.base_price}\n              >\n                {creatingTrip ? (\n                  <>\n                    <div className=\"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2\"></div>\n                    Creating...\n                  </>\n                ) : 'Schedule Trip'}\n              </button>\n              <button \n                className=\"btn-secondary flex-1\"\n                onClick={() => setShowCreateModal(false)}\n                disabled={creatingTrip}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Trip Details Modal */}\n      {showTripDetailsModal && selectedTrip && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto\">\n            <div className=\"flex justify-between items-center mb-4\">\n              <h3 className=\"text-lg font-semibold\">\n                {selectedTrip.trips_scheduled ? 'Route Details' : 'Trip Details'}\n              </h3>\n              <button \n                onClick={() => setShowTripDetailsModal(false)}\n                className=\"text-gray-400 hover:text-gray-600\"\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n            </div>\n            \n            {/* Trip Header */}\n            <div className=\"bg-gray-50 p-4 rounded-lg mb-4\">\n              <div className=\"flex justify-between items-center\">\n                <div>\n                  <h4 className=\"font-semibold text-lg\">{selectedTrip.route_name}</h4>\n                  <p className=\"text-gray-600\">{selectedTrip.trip_number}</p>\n                </div>\n                {selectedTrip.trips_scheduled ? (\n                  <span className=\"px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800\">\n                    ROUTE OVERVIEW\n                  </span>\n                ) : (\n                  <span className={`px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(selectedTrip.status)}`}>\n                    {selectedTrip.status.replace('_', ' ').toUpperCase()}\n                  </span>\n                )}\n              </div>\n            </div>\n            \n            {/* Trip Details Grid */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n              {/* Left Column - Trip Information */}\n              <div className=\"space-y-4\">\n                <h4 className=\"font-medium text-gray-700 border-b pb-2\">\n                  {selectedTrip.trips_scheduled ? 'Route Information' : 'Trip Information'}\n                </h4>\n                \n                {selectedTrip.trips_scheduled ? (\n                  <>\n                    <div>\n                      <p className=\"text-sm text-gray-500\">Route</p>\n                      <p className=\"font-medium\">{selectedTrip.origin_name} → {selectedTrip.destination_name}</p>\n                    </div>\n                    \n                    <div>\n                      <p className=\"text-sm text-gray-500\">Scheduled Trips</p>\n                      <p className=\"font-medium\">{selectedTrip.trips_scheduled} trips</p>\n                    </div>\n                    \n                    <div>\n                      <p className=\"text-sm text-gray-500\">Total Passengers</p>\n                      <p className=\"font-medium\">{selectedTrip.total_passengers || 0} passengers</p>\n                    </div>\n                  </>\n                ) : (\n                  <>\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div>\n                        <p className=\"text-sm text-gray-500\">Departure</p>\n                        <p className=\"font-medium\">{formatDate(selectedTrip.departure_datetime)}</p>\n                        <p className=\"text-sm\">{formatTime(selectedTrip.departure_datetime)}</p>\n                      </div>\n                      \n                      <div>\n                        <p className=\"text-sm text-gray-500\">Arrival (Est.)</p>\n                        <p className=\"font-medium\">{formatDate(selectedTrip.estimated_arrival_datetime)}</p>\n                        <p className=\"text-sm\">{formatTime(selectedTrip.estimated_arrival_datetime)}</p>\n                      </div>\n                    </div>\n                    \n                    <div>\n                      <p className=\"text-sm text-gray-500\">Route</p>\n                      <p className=\"font-medium\">{selectedTrip.origin_name} → {selectedTrip.destination_name}</p>\n                      <p className=\"text-sm text-gray-600\">{selectedTrip.origin_city} to {selectedTrip.destination_city}</p>\n                    </div>\n                    \n                    <div>\n                      <p className=\"text-sm text-gray-500\">Vehicle</p>\n                      <p className=\"font-medium\">{selectedTrip.vehicle_model}</p>\n                      <p className=\"text-sm text-gray-600\">\n                        {selectedTrip.vehicle_number} | {selectedTrip.license_plate} | {selectedTrip.vehicle_type}\n                      </p>\n                    </div>\n                  </>\n                )}\n              </div>\n              \n              {/* Right Column - Occupancy & Pricing */}\n              <div className=\"space-y-4\">\n                <h4 className=\"font-medium text-gray-700 border-b pb-2\">Occupancy & Pricing</h4>\n                \n                <div className=\"flex items-center justify-between\">\n                  <div>\n                    <p className=\"text-sm text-gray-500\">\n                      {selectedTrip.trips_scheduled ? 'Average Occupancy' : 'Seats'}\n                    </p>\n                    <p className=\"font-medium\">\n                      {selectedTrip.trips_scheduled ? \n                        `${selectedTrip.avg_occupancy || 0}%` : \n                        `${selectedTrip.occupied_seats} / ${selectedTrip.total_seats} occupied`\n                      }\n                    </p>\n                  </div>\n                  \n                  <div className=\"flex items-center space-x-2\">\n                    <div className=\"w-20 bg-gray-200 rounded-full h-2\">\n                      <div \n                        className=\"h-2 rounded-full transition-all\"\n                        style={{ \n                          width: `${Math.min(selectedTrip.occupancy_percentage || selectedTrip.avg_occupancy || 0, 100)}%`,\n                          backgroundColor: (selectedTrip.occupancy_percentage || selectedTrip.avg_occupancy || 0) > 80 ? '#EF4444' : \n                                          (selectedTrip.occupancy_percentage || selectedTrip.avg_occupancy || 0) > 60 ? '#F59E0B' : '#10B981'\n                        }}\n                      ></div>\n                    </div>\n                    <span className=\"text-sm font-medium\">\n                      {selectedTrip.occupancy_percentage || selectedTrip.avg_occupancy || 0}%\n                    </span>\n                  </div>\n                </div>\n                \n                <div>\n                  <p className=\"text-sm text-gray-500\">\n                    {selectedTrip.trips_scheduled ? 'Total Revenue' : 'Base Price'}\n                  </p>\n                  <p className=\"font-medium\">\n                    RM {selectedTrip.trips_scheduled ? \n                      selectedTrip.total_revenue || 0 : \n                      selectedTrip.base_price}\n                  </p>\n                </div>\n                \n                {!selectedTrip.trips_scheduled && selectedTrip.seat_pricing && selectedTrip.seat_pricing.length > 0 && (\n                  <div>\n                    <p className=\"text-sm text-gray-500\">Seat Type Pricing</p>\n                    <div className=\"space-y-1 mt-1\">\n                      {selectedTrip.seat_pricing.map((pricing, index) => (\n                        <div key={index} className=\"flex justify-between text-sm\">\n                          <span>{pricing.seat_type_id.charAt(0).toUpperCase() + pricing.seat_type_id.slice(1)}</span>\n                          <span className=\"font-medium\">{pricing.price_multiplier}x</span>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n                \n                {!selectedTrip.trips_scheduled && selectedTrip.pricing_rules && selectedTrip.pricing_rules.length > 0 && (\n                  <div>\n                    <p className=\"text-sm text-gray-500\">Pricing Rules</p>\n                    <div className=\"space-y-1 mt-1\">\n                      {selectedTrip.pricing_rules.map((rule, index) => (\n                        <div key={index} className=\"flex justify-between text-sm\">\n                          <span>{rule.rule_name.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}</span>\n                          <span className=\"font-medium\">\n                            {rule.rule_type === 'discount' ? '-' : '+'}{rule.rule_value}%\n                          </span>\n                        </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n            \n            {/* Route Stops */}\n            {!selectedTrip.trips_scheduled && selectedTrip.stops && selectedTrip.stops.length > 0 && (\n              <div className=\"mb-6\">\n                <h4 className=\"font-medium text-gray-700 border-b pb-2 mb-4\">Route Stops</h4>\n                \n                <div className=\"space-y-4\">\n                  {selectedTrip.stops.map((stop, index) => {\n                    const isOrigin = index === 0;\n                    const isDestination = index === selectedTrip.stops.length - 1;\n                    \n                    return (\n                      <div key={stop.id} className=\"flex items-center\">\n                        <div className=\"relative\">\n                          {!isDestination && (\n                            <div className=\"h-full w-0.5 bg-blue-500 absolute left-2 top-3\"></div>\n                          )}\n                          {isOrigin || isDestination ? (\n                            <div className=\"h-4 w-4 rounded-full bg-blue-500 mt-1\"></div>\n                          ) : (\n                            <div className=\"h-4 w-4 rounded-full border-2 border-blue-500 bg-white mt-1\"></div>\n                          )}\n                        </div>\n                        \n                        <div className=\"ml-4 flex-1\">\n                          <div className=\"flex justify-between\">\n                            <div>\n                              <p className=\"font-medium\">\n                                {stop.location_name}\n                                {isOrigin && ' (Origin)'}\n                                {isDestination && ' (Destination)'}\n                              </p>\n                              <p className=\"text-sm text-gray-600\">{stop.location_city}</p>\n                            </div>\n                            \n                            {!isOrigin && (\n                              <div className=\"text-right\">\n                                <p className=\"text-sm text-gray-500\">\n                                  +{Math.floor(stop.arrival_offset_minutes / 60)} hrs \n                                  {stop.arrival_offset_minutes % 60 > 0 ? ` ${stop.arrival_offset_minutes % 60} mins` : ''}\n                                </p>\n                                {stop.price_from_origin > 0 && (\n                                  <p className=\"text-sm font-medium\">RM {stop.price_from_origin}</p>\n                                )}\n                              </div>\n                            )}\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n            )}\n            \n            {/* Performance Data - Only for route details */}\n            {selectedTrip.trips_scheduled && (\n              <div className=\"mb-6\">\n                <h4 className=\"font-medium text-gray-700 border-b pb-2 mb-4\">Performance Data</h4>\n                \n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"p-4 bg-gray-50 rounded-lg\">\n                    <div className=\"text-sm text-gray-500 mb-1\">Average Occupancy</div>\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"text-xl font-semibold\">{selectedTrip.avg_occupancy || 0}%</div>\n                      <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                        <div \n                          className=\"h-2 rounded-full transition-all\"\n                          style={{ \n                            width: `${Math.min(selectedTrip.avg_occupancy || 0, 100)}%`,\n                            backgroundColor: (selectedTrip.avg_occupancy || 0) > 80 ? '#10B981' : \n                                            (selectedTrip.avg_occupancy || 0) > 60 ? '#F59E0B' : '#EF4444'\n                          }}\n                        ></div>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div className=\"p-4 bg-gray-50 rounded-lg\">\n                    <div className=\"text-sm text-gray-500 mb-1\">Total Revenue</div>\n                    <div className=\"text-xl font-semibold text-green-600\">RM {selectedTrip.total_revenue || 0}</div>\n                  </div>\n                  \n                  <div className=\"p-4 bg-gray-50 rounded-lg\">\n                    <div className=\"text-sm text-gray-500 mb-1\">Total Passengers</div>\n                    <div className=\"text-xl font-semibold\">{selectedTrip.total_passengers || 0}</div>\n                  </div>\n                  \n                  <div className=\"p-4 bg-gray-50 rounded-lg\">\n                    <div className=\"text-sm text-gray-500 mb-1\">Average Price Per Trip</div>\n                    <div className=\"text-xl font-semibold\">\n                      RM {selectedTrip.trips_scheduled ? \n                        (selectedTrip.total_revenue / selectedTrip.trips_scheduled).toFixed(2) : 0}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n            \n            {/* Trips List - Only for route details */}\n            {selectedTrip.trips_scheduled && selectedTrip.trips && selectedTrip.trips.length > 0 && (\n              <div className=\"mb-6\">\n                <h4 className=\"font-medium text-gray-700 border-b pb-2 mb-4\">Scheduled Trips</h4>\n                \n                <div className=\"overflow-hidden border border-gray-200 rounded-lg\">\n                  <table className=\"min-w-full divide-y divide-gray-200\">\n                    <thead className=\"bg-gray-50\">\n                      <tr>\n                        <th scope=\"col\" className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                          Trip Number\n                        </th>\n                        <th scope=\"col\" className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                          Departure\n                        </th>\n                        <th scope=\"col\" className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                          Vehicle\n                        </th>\n                        <th scope=\"col\" className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                          Occupancy\n                        </th>\n                        <th scope=\"col\" className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                          Status\n                        </th>\n                        <th scope=\"col\" className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                          Actions\n                        </th>\n                      </tr>\n                    </thead>\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\n                      {selectedTrip.trips.map((trip) => {\n                        const occupiedSeats = trip.occupied_seats || (trip.total_seats - trip.available_seats) || 0;\n                        const occupancyPercentage = trip.occupancy_percentage || \n                          (trip.total_seats ? Math.round((occupiedSeats / trip.total_seats) * 100) : 0);\n                          \n                        return (\n                          <tr key={trip.id} className=\"hover:bg-gray-50\">\n                            <td className=\"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900\">\n                              {trip.trip_number}\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap text-sm text-gray-500\">\n                              <div>{formatDate(trip.departure_datetime)}</div>\n                              <div className=\"text-xs\">{formatTime(trip.departure_datetime)}</div>\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap text-sm text-gray-500\">\n                              {trip.vehicle_number || trip.license_plate || 'N/A'}\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap\">\n                              <div className=\"flex items-center\">\n                                <div className=\"w-16 bg-gray-200 rounded-full h-2 mr-2\">\n                                  <div \n                                    className=\"h-2 rounded-full transition-all\"\n                                    style={{ \n                                      width: `${Math.min(occupancyPercentage, 100)}%`,\n                                      backgroundColor: occupancyPercentage > 80 ? '#EF4444' : \n                                              occupancyPercentage > 60 ? '#F59E0B' : '#10B981'\n                                    }}\n                                  ></div>\n                                </div>\n                                <span className=\"text-xs font-medium\">\n                                  {occupancyPercentage}%\n                                </span>\n                              </div>\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap\">\n                              <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusColor(trip.status)}`}>\n                                {trip.status?.replace('_', ' ').toUpperCase() || 'N/A'}\n                              </span>\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap text-sm text-gray-500\">\n                              <button \n                                onClick={() => handleTripClick(trip.id)}\n                                className=\"text-blue-600 hover:text-blue-800\"\n                              >\n                                View\n                              </button>\n                            </td>\n                          </tr>\n                        );\n                      })}\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n            )}\n            \n            {/* Actions */}\n            <div className=\"flex justify-end space-x-3 pt-4 border-t\">\n              <button\n                className=\"btn-secondary\"\n                onClick={() => setShowTripDetailsModal(false)}\n              >\n                Close\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\n// Analytics Component\nconst Analytics = () => {\n  const [analyticsData, setAnalyticsData] = useState(null);\n  const [routePerformance, setRoutePerformance] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState(null);\n  \n  // Add state for trip details modal\n  const [showTripDetailsModal, setShowTripDetailsModal] = useState(false);\n  const [selectedTrip, setSelectedTrip] = useState(null);\n  const [loadingTripDetails, setLoadingTripDetails] = useState(false);\n  \n  // Helper function to get status color\n  const getStatusColor = (status) => {\n    switch (status?.toLowerCase()) {\n      case 'scheduled':\n        return 'bg-blue-100 text-blue-800';\n      case 'boarding':\n        return 'bg-yellow-100 text-yellow-800';\n      case 'in_transit':\n        return 'bg-green-100 text-green-800';\n      case 'arrived':\n        return 'bg-purple-100 text-purple-800';\n      case 'cancelled':\n        return 'bg-red-100 text-red-800';\n      case 'delayed':\n        return 'bg-orange-100 text-orange-800';\n      default:\n        return 'bg-gray-100 text-gray-800';\n    }\n  };\n  \n  // Helper functions for date formatting\n  const formatTime = (datetime) => {\n    if (!datetime) return '';\n    try {\n      return new Date(datetime).toLocaleTimeString('en-US', {\n        hour: '2-digit',\n        minute: '2-digit',\n        hour12: true\n      });\n    } catch (error) {\n      console.error('Error formatting time:', error);\n      return '';\n    }\n  };\n  \n  const formatDate = (datetime) => {\n    if (!datetime) return '';\n    try {\n      return new Date(datetime).toLocaleDateString('en-US', {\n        year: 'numeric',\n        month: 'short',\n        day: 'numeric'\n      });\n    } catch (error) {\n      console.error('Error formatting date:', error);\n      return '';\n    }\n  };\n\n  useEffect(() => {\n    const loadAnalyticsData = async () => {\n      setLoading(true);\n      try {\n        // 加载总体分析数据\n        const statsResponse = await getAnalyticsData();\n        if (statsResponse.success) {\n          setAnalyticsData(statsResponse.data);\n        } else {\n          setError('Failed to load analytics data');\n        }\n        \n        // 加载路线表现数据\n        const routeResponse = await getRouteAnalytics();\n        if (routeResponse.success) {\n          setRoutePerformance(routeResponse.data);\n        } else {\n          setError('Failed to load route performance data');\n        }\n      } catch (err) {\n        console.error('Error loading analytics:', err);\n        setError(handleApiError(err));\n      } finally {\n        setLoading(false);\n      }\n    };\n    \n    loadAnalyticsData();\n  }, []);\n  \n  // Handle route click to show details\n  const handleRouteClick = async (route) => {\n    console.log(\"Route clicked:\", route);\n    \n    try {\n      // 创建一个包含路线数据的对象，模拟行程详情结构\n      const routeDetails = {\n        id: route.id || Math.random().toString(36).substr(2, 9),\n        route_name: route.route_name || 'Unknown Route',\n        trip_number: `Route-${(route.route_name || 'Unknown').replace(/\\s+/g, '-')}`,\n        status: 'active',\n        origin_name: route.route_name ? route.route_name.split(' - ')[0] : 'Unknown',\n        destination_name: route.route_name ? (route.route_name.split(' - ')[1] || '') : '',\n        origin_city: route.route_name ? route.route_name.split(' - ')[0] : 'Unknown',\n        destination_city: route.route_name ? (route.route_name.split(' - ')[1] || '') : '',\n        base_price: route.total_revenue && route.trips_scheduled ? route.total_revenue / route.trips_scheduled : 0,\n        total_seats: 0,\n        available_seats: 0,\n        occupied_seats: route.total_passengers || 0,\n        occupancy_percentage: route.avg_occupancy || 0,\n        departure_datetime: new Date().toISOString(),\n        estimated_arrival_datetime: new Date(new Date().getTime() + 3600000).toISOString(),\n        vehicle_model: 'Various',\n        vehicle_number: 'Multiple',\n        license_plate: '-',\n        vehicle_type: 'Various',\n        // 添加路线特有的数据\n        trips_scheduled: route.trips_scheduled || 0,\n        total_passengers: route.total_passengers || 0,\n        total_revenue: route.total_revenue || 0,\n        avg_occupancy: route.avg_occupancy || 0,\n        // 空数组，避免undefined错误\n        stops: [],\n        seat_pricing: [],\n        pricing_rules: [],\n        // 添加行程列表，初始为空\n        trips: []\n      };\n      \n      // 获取该路线下的所有行程\n      try {\n        setLoadingTripDetails(true);\n        \n        // 获取当前日期作为默认参数\n        const today = new Date();\n        // 获取30天前的日期作为开始日期\n        const startDate = new Date(today);\n        startDate.setDate(today.getDate() - 30);\n        // 获取30天后的日期作为结束日期\n        const endDate = new Date(today);\n        endDate.setDate(today.getDate() + 30);\n        \n        // 格式化日期为ISO字符串\n        const startDateStr = startDate.toISOString().split('T')[0];\n        const endDateStr = endDate.toISOString().split('T')[0];\n        \n        console.log(`Fetching trips from ${startDateStr} to ${endDateStr}`);\n        const response = await getSchedules(startDateStr, endDateStr);\n        \n        if (response.success) {\n          // 过滤出与当前路线名称匹配的行程\n          const routeTrips = response.data.filter(trip => \n            trip.route_name === route.route_name\n          );\n          \n          // 添加行程列表到路线详情\n          routeDetails.trips = routeTrips;\n          console.log(\"Found trips for route:\", routeTrips.length);\n        } else {\n          console.error(\"Failed to fetch trips:\", response.message);\n        }\n      } catch (error) {\n        console.error(\"Error fetching trips for route:\", error);\n        // 继续执行，即使获取行程失败\n      } finally {\n        setLoadingTripDetails(false);\n      }\n      \n      // 设置选中的行程并显示模态框\n      setSelectedTrip(routeDetails);\n      setShowTripDetailsModal(true);\n    } catch (error) {\n      console.error(\"Error showing route details:\", error);\n      alert('Failed to show route details');\n    }\n  };\n  \n  // Handle trip click\n  const handleTripClick = async (tripId) => {\n    setLoadingTripDetails(true);\n    try {\n      const response = await getTripDetails(tripId);\n      if (response.success) {\n        setSelectedTrip(response.data);\n        setShowTripDetailsModal(true);\n      } else {\n        alert('Failed to load trip details');\n      }\n    } catch (error) {\n      console.error('Error loading trip details:', error);\n      alert('Error loading trip details');\n    } finally {\n      setLoadingTripDetails(false);\n    }\n  };\n  \n  if (loading) {\n    return (\n      <div className=\"flex justify-center py-20\">\n        <div className=\"flex flex-col items-center\">\n          <div className=\"w-12 h-12 border-4 border-primary-600 border-t-transparent rounded-full animate-spin\"></div>\n          <p className=\"mt-4 text-gray-600\">Loading analytics data...</p>\n        </div>\n      </div>\n    );\n  }\n  \n  if (error) {\n    return (\n      <div className=\"card bg-red-50 border-red-200\">\n        <div className=\"flex items-center text-red-600 mb-2\">\n          <AlertCircle className=\"w-5 h-5 mr-2\" />\n          <h3 className=\"font-medium\">Error loading analytics</h3>\n        </div>\n        <p className=\"text-red-600\">{error}</p>\n        <button \n          className=\"mt-4 px-4 py-2 bg-red-100 hover:bg-red-200 text-red-700 rounded-md\"\n          onClick={() => window.location.reload()}\n        >\n          Retry\n        </button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-2xl font-bold text-gray-900\">Analytics & Reports</h2>\n      \n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n        <div className=\"card\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-gray-600\">Total Revenue</p>\n              <p className=\"text-2xl font-bold text-green-600\">\n                RM {analyticsData?.totalRevenue?.toLocaleString() || '0'}\n              </p>\n            </div>\n            <TrendingUp className=\"w-8 h-8 text-green-600\" />\n          </div>\n        </div>\n\n        <div className=\"card\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-gray-600\">Average Occupancy</p>\n              <p className=\"text-2xl font-bold text-blue-600\">\n                {typeof analyticsData?.averageOccupancy === 'number' ? analyticsData.averageOccupancy.toFixed(1) : '0'}%\n              </p>\n            </div>\n            <Users className=\"w-8 h-8 text-blue-600\" />\n          </div>\n        </div>\n\n        <div className=\"card\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <p className=\"text-sm text-gray-600\">Total Passengers</p>\n              <p className=\"text-2xl font-bold text-purple-600\">\n                {analyticsData?.totalPassengers?.toLocaleString() || '0'}\n              </p>\n            </div>\n            <Users className=\"w-8 h-8 text-purple-600\" />\n          </div>\n        </div>\n      </div>\n\n      <div className=\"card\">\n        <h3 className=\"text-lg font-semibold mb-4\">Route Performance</h3>\n        <div className=\"space-y-4\">\n          {routePerformance.length > 0 ? routePerformance.map((route) => (\n            <div \n              key={route.route_name} \n              className=\"p-4 border border-gray-200 rounded-lg hover:bg-gray-50 cursor-pointer transition-colors\"\n              onClick={() => handleRouteClick(route)}\n            >\n                <div className=\"flex items-center justify-between\">\n                  <div>\n                  <h4 className=\"font-medium text-gray-900\">{route.route_name}</h4>\n                  <p className=\"text-sm text-gray-600\">{route.trips_scheduled} trips scheduled</p>\n                  </div>\n                  <div className=\"text-right space-y-1\">\n                  <div className=\"text-sm font-medium text-green-600\">\n                    RM {parseFloat(route.total_revenue || 0).toLocaleString()}\n                  </div>\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"w-20 bg-gray-200 rounded-full h-2\">\n                        <div \n                          className=\"h-2 rounded-full transition-all\"\n                          style={{ \n                          width: `${Math.min(route.avg_occupancy || 0, 100)}%`,\n                          backgroundColor: (route.avg_occupancy || 0) > 80 ? '#EF4444' : (route.avg_occupancy || 0) > 60 ? '#F59E0B' : '#10B981'\n                          }}\n                        ></div>\n                      </div>\n                    <span className=\"text-xs font-medium\">\n                      {typeof route.avg_occupancy === 'number' ? route.avg_occupancy.toFixed(0) : '0'}%\n                    </span>\n                    </div>\n                  </div>\n                </div>\n              </div>\n          )) : (\n            <div className=\"text-center py-8 text-gray-500\">\n              <p>No route performance data available</p>\n        </div>\n          )}\n      </div>\n    </div>\n      \n        <div className=\"card\">\n        <h3 className=\"text-lg font-semibold mb-4\">Monthly Revenue</h3>\n        <div className=\"h-64 bg-gray-50 rounded-lg flex items-center justify-center\">\n          <p className=\"text-gray-500\">Monthly revenue chart will be displayed here</p>\n        </div>\n      </div>\n      \n      {/* Trip Details Modal */}\n      {showTripDetailsModal && selectedTrip && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto\">\n            <div className=\"flex justify-between items-center mb-4\">\n              <h3 className=\"text-lg font-semibold\">\n                {selectedTrip.trips_scheduled ? 'Route Details' : 'Trip Details'}\n              </h3>\n              <button \n                onClick={() => setShowTripDetailsModal(false)}\n                className=\"text-gray-400 hover:text-gray-600\"\n              >\n                <X className=\"w-5 h-5\" />\n              </button>\n            </div>\n            \n            {/* Trip Header */}\n            <div className=\"bg-gray-50 p-4 rounded-lg mb-4\">\n              <div className=\"flex justify-between items-center\">\n                <div>\n                  <h4 className=\"font-semibold text-lg\">{selectedTrip.route_name}</h4>\n                  <p className=\"text-gray-600\">{selectedTrip.trip_number}</p>\n                </div>\n                {selectedTrip.trips_scheduled ? (\n                  <span className=\"px-3 py-1 rounded-full text-sm font-medium bg-blue-100 text-blue-800\">\n                    ROUTE OVERVIEW\n                  </span>\n                ) : (\n                  <span className={`px-3 py-1 rounded-full text-sm font-medium ${getStatusColor(selectedTrip.status)}`}>\n                    {selectedTrip.status.replace('_', ' ').toUpperCase()}\n                  </span>\n                )}\n              </div>\n            </div>\n            \n            {/* Trip Details Grid */}\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6\">\n              {/* Left Column - Trip Information */}\n          <div className=\"space-y-4\">\n                <h4 className=\"font-medium text-gray-700 border-b pb-2\">\n                  {selectedTrip.trips_scheduled ? 'Route Information' : 'Trip Information'}\n                </h4>\n                \n                {selectedTrip.trips_scheduled ? (\n                  <>\n            <div>\n                      <p className=\"text-sm text-gray-500\">Route</p>\n                      <p className=\"font-medium\">{selectedTrip.origin_name} → {selectedTrip.destination_name}</p>\n            </div>\n                    \n            <div>\n                      <p className=\"text-sm text-gray-500\">Scheduled Trips</p>\n                      <p className=\"font-medium\">{selectedTrip.trips_scheduled} trips</p>\n            </div>\n                    \n            <div>\n                      <p className=\"text-sm text-gray-500\">Total Passengers</p>\n                      <p className=\"font-medium\">{selectedTrip.total_passengers || 0} passengers</p>\n            </div>\n                  </>\n                ) : (\n                  <>\n                    <div className=\"grid grid-cols-2 gap-4\">\n                      <div>\n                        <p className=\"text-sm text-gray-500\">Departure</p>\n                        <p className=\"font-medium\">{formatDate(selectedTrip.departure_datetime)}</p>\n                        <p className=\"text-sm\">{formatTime(selectedTrip.departure_datetime)}</p>\n                      </div>\n                      \n                      <div>\n                        <p className=\"text-sm text-gray-500\">Arrival (Est.)</p>\n                        <p className=\"font-medium\">{formatDate(selectedTrip.estimated_arrival_datetime)}</p>\n                        <p className=\"text-sm\">{formatTime(selectedTrip.estimated_arrival_datetime)}</p>\n          </div>\n        </div>\n\n                    <div>\n                      <p className=\"text-sm text-gray-500\">Route</p>\n                      <p className=\"font-medium\">{selectedTrip.origin_name} → {selectedTrip.destination_name}</p>\n                      <p className=\"text-sm text-gray-600\">{selectedTrip.origin_city} to {selectedTrip.destination_city}</p>\n                    </div>\n                    \n                    <div>\n                      <p className=\"text-sm text-gray-500\">Vehicle</p>\n                      <p className=\"font-medium\">{selectedTrip.vehicle_model}</p>\n                      <p className=\"text-sm text-gray-600\">\n                        {selectedTrip.vehicle_number} | {selectedTrip.license_plate} | {selectedTrip.vehicle_type}\n                      </p>\n                    </div>\n                  </>\n                )}\n              </div>\n              \n              {/* Right Column - Occupancy & Pricing */}\n          <div className=\"space-y-4\">\n                <h4 className=\"font-medium text-gray-700 border-b pb-2\">Occupancy & Pricing</h4>\n                \n                <div className=\"flex items-center justify-between\">\n            <div>\n                    <p className=\"text-sm text-gray-500\">\n                      {selectedTrip.trips_scheduled ? 'Average Occupancy' : 'Seats'}\n                    </p>\n                    <p className=\"font-medium\">\n                      {selectedTrip.trips_scheduled ? \n                        `${selectedTrip.avg_occupancy || 0}%` : \n                        `${selectedTrip.occupied_seats} / ${selectedTrip.total_seats} occupied`\n                      }\n                    </p>\n            </div>\n                  \n                  <div className=\"flex items-center space-x-2\">\n                    <div className=\"w-20 bg-gray-200 rounded-full h-2\">\n                      <div \n                        className=\"h-2 rounded-full transition-all\"\n                        style={{ \n                          width: `${Math.min(selectedTrip.occupancy_percentage || selectedTrip.avg_occupancy || 0, 100)}%`,\n                          backgroundColor: (selectedTrip.occupancy_percentage || selectedTrip.avg_occupancy || 0) > 80 ? '#EF4444' : \n                                          (selectedTrip.occupancy_percentage || selectedTrip.avg_occupancy || 0) > 60 ? '#F59E0B' : '#10B981'\n                        }}\n                      ></div>\n                    </div>\n                    <span className=\"text-sm font-medium\">\n                      {selectedTrip.occupancy_percentage || selectedTrip.avg_occupancy || 0}%\n                    </span>\n                  </div>\n                </div>\n                \n            <div>\n                  <p className=\"text-sm text-gray-500\">\n                    {selectedTrip.trips_scheduled ? 'Total Revenue' : 'Base Price'}\n                  </p>\n                  <p className=\"font-medium\">\n                    RM {selectedTrip.trips_scheduled ? \n                      selectedTrip.total_revenue || 0 : \n                      selectedTrip.base_price}\n                  </p>\n            </div>\n                \n                {!selectedTrip.trips_scheduled && selectedTrip.seat_pricing && selectedTrip.seat_pricing.length > 0 && (\n            <div>\n                    <p className=\"text-sm text-gray-500\">Seat Type Pricing</p>\n                    <div className=\"space-y-1 mt-1\">\n                      {selectedTrip.seat_pricing.map((pricing, index) => (\n                        <div key={index} className=\"flex justify-between text-sm\">\n                          <span>{pricing.seat_type_id.charAt(0).toUpperCase() + pricing.seat_type_id.slice(1)}</span>\n                          <span className=\"font-medium\">{pricing.price_multiplier}x</span>\n            </div>\n                      ))}\n          </div>\n        </div>\n                )}\n                \n                {!selectedTrip.trips_scheduled && selectedTrip.pricing_rules && selectedTrip.pricing_rules.length > 0 && (\n                  <div>\n                    <p className=\"text-sm text-gray-500\">Pricing Rules</p>\n                    <div className=\"space-y-1 mt-1\">\n                      {selectedTrip.pricing_rules.map((rule, index) => (\n                        <div key={index} className=\"flex justify-between text-sm\">\n                          <span>{rule.rule_name.replace(/_/g, ' ').replace(/\\b\\w/g, l => l.toUpperCase())}</span>\n                          <span className=\"font-medium\">\n                            {rule.rule_type === 'discount' ? '-' : '+'}{rule.rule_value}%\n                          </span>\n      </div>\n                      ))}\n                    </div>\n                  </div>\n                )}\n              </div>\n            </div>\n            \n            {/* Route Stops */}\n            {!selectedTrip.trips_scheduled && selectedTrip.stops && selectedTrip.stops.length > 0 && (\n              <div className=\"mb-6\">\n                <h4 className=\"font-medium text-gray-700 border-b pb-2 mb-4\">Route Stops</h4>\n                \n                <div className=\"space-y-4\">\n                  {selectedTrip.stops.map((stop, index) => {\n                    const isOrigin = index === 0;\n                    const isDestination = index === selectedTrip.stops.length - 1;\n                    \n                    return (\n                      <div key={stop.id} className=\"flex items-center\">\n                        <div className=\"relative\">\n                          {!isDestination && (\n                            <div className=\"h-full w-0.5 bg-blue-500 absolute left-2 top-3\"></div>\n                          )}\n                          {isOrigin || isDestination ? (\n                            <div className=\"h-4 w-4 rounded-full bg-blue-500 mt-1\"></div>\n                          ) : (\n                            <div className=\"h-4 w-4 rounded-full border-2 border-blue-500 bg-white mt-1\"></div>\n                          )}\n                        </div>\n                        \n                        <div className=\"ml-4 flex-1\">\n                          <div className=\"flex justify-between\">\n                            <div>\n                              <p className=\"font-medium\">\n                                {stop.location_name}\n                                {isOrigin && ' (Origin)'}\n                                {isDestination && ' (Destination)'}\n                              </p>\n                              <p className=\"text-sm text-gray-600\">{stop.location_city}</p>\n                            </div>\n                            \n                            {!isOrigin && (\n                              <div className=\"text-right\">\n                                <p className=\"text-sm text-gray-500\">\n                                  +{Math.floor(stop.arrival_offset_minutes / 60)} hrs \n                                  {stop.arrival_offset_minutes % 60 > 0 ? ` ${stop.arrival_offset_minutes % 60} mins` : ''}\n                                </p>\n                                {stop.price_from_origin > 0 && (\n                                  <p className=\"text-sm font-medium\">RM {stop.price_from_origin}</p>\n                                )}\n                              </div>\n                            )}\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </div>\n            )}\n            \n            {/* Performance Data - Only for route details */}\n            {selectedTrip.trips_scheduled && (\n              <div className=\"mb-6\">\n                <h4 className=\"font-medium text-gray-700 border-b pb-2 mb-4\">Performance Data</h4>\n                \n                <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                  <div className=\"p-4 bg-gray-50 rounded-lg\">\n                    <div className=\"text-sm text-gray-500 mb-1\">Average Occupancy</div>\n                    <div className=\"flex items-center space-x-2\">\n                      <div className=\"text-xl font-semibold\">{selectedTrip.avg_occupancy || 0}%</div>\n                      <div className=\"w-full bg-gray-200 rounded-full h-2\">\n                        <div \n                          className=\"h-2 rounded-full transition-all\"\n                          style={{ \n                            width: `${Math.min(selectedTrip.avg_occupancy || 0, 100)}%`,\n                            backgroundColor: (selectedTrip.avg_occupancy || 0) > 80 ? '#10B981' : \n                                            (selectedTrip.avg_occupancy || 0) > 60 ? '#F59E0B' : '#EF4444'\n                          }}\n                        ></div>\n                      </div>\n                    </div>\n                  </div>\n                  \n                  <div className=\"p-4 bg-gray-50 rounded-lg\">\n                    <div className=\"text-sm text-gray-500 mb-1\">Total Revenue</div>\n                    <div className=\"text-xl font-semibold text-green-600\">RM {selectedTrip.total_revenue || 0}</div>\n                  </div>\n                  \n                  <div className=\"p-4 bg-gray-50 rounded-lg\">\n                    <div className=\"text-sm text-gray-500 mb-1\">Total Passengers</div>\n                    <div className=\"text-xl font-semibold\">{selectedTrip.total_passengers || 0}</div>\n                  </div>\n                  \n                  <div className=\"p-4 bg-gray-50 rounded-lg\">\n                    <div className=\"text-sm text-gray-500 mb-1\">Average Price Per Trip</div>\n                    <div className=\"text-xl font-semibold\">\n                      RM {selectedTrip.trips_scheduled ? \n                        (selectedTrip.total_revenue / selectedTrip.trips_scheduled).toFixed(2) : 0}\n                    </div>\n                  </div>\n                </div>\n              </div>\n            )}\n            \n            {/* Trips List - Only for route details */}\n            {selectedTrip.trips_scheduled && selectedTrip.trips && selectedTrip.trips.length > 0 && (\n              <div className=\"mb-6\">\n                <h4 className=\"font-medium text-gray-700 border-b pb-2 mb-4\">Scheduled Trips</h4>\n                \n                <div className=\"overflow-hidden border border-gray-200 rounded-lg\">\n                  <table className=\"min-w-full divide-y divide-gray-200\">\n                    <thead className=\"bg-gray-50\">\n                      <tr>\n                        <th scope=\"col\" className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                          Trip Number\n                        </th>\n                        <th scope=\"col\" className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                          Departure\n                        </th>\n                        <th scope=\"col\" className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                          Vehicle\n                        </th>\n                        <th scope=\"col\" className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                          Occupancy\n                        </th>\n                        <th scope=\"col\" className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                          Status\n                        </th>\n                        <th scope=\"col\" className=\"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                          Actions\n                        </th>\n                      </tr>\n                    </thead>\n                    <tbody className=\"bg-white divide-y divide-gray-200\">\n                      {selectedTrip.trips.map((trip) => {\n                        const occupiedSeats = trip.occupied_seats || (trip.total_seats - trip.available_seats) || 0;\n                        const occupancyPercentage = trip.occupancy_percentage || \n                          (trip.total_seats ? Math.round((occupiedSeats / trip.total_seats) * 100) : 0);\n                          \n                        return (\n                          <tr key={trip.id} className=\"hover:bg-gray-50\">\n                            <td className=\"px-4 py-3 whitespace-nowrap text-sm font-medium text-gray-900\">\n                              {trip.trip_number}\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap text-sm text-gray-500\">\n                              <div>{formatDate(trip.departure_datetime)}</div>\n                              <div className=\"text-xs\">{formatTime(trip.departure_datetime)}</div>\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap text-sm text-gray-500\">\n                              {trip.vehicle_number || trip.license_plate || 'N/A'}\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap\">\n                              <div className=\"flex items-center\">\n                                <div className=\"w-16 bg-gray-200 rounded-full h-2 mr-2\">\n                                  <div \n                                    className=\"h-2 rounded-full transition-all\"\n                                    style={{ \n                                      width: `${Math.min(occupancyPercentage, 100)}%`,\n                                      backgroundColor: occupancyPercentage > 80 ? '#EF4444' : \n                                                      occupancyPercentage > 60 ? '#F59E0B' : '#10B981'\n                                    }}\n                                  ></div>\n                                </div>\n                                <span className=\"text-xs font-medium\">\n                                  {occupancyPercentage}%\n                                </span>\n                              </div>\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap\">\n                              <span className={`px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full ${getStatusColor(trip.status)}`}>\n                                {trip.status?.replace('_', ' ').toUpperCase() || 'N/A'}\n                              </span>\n                            </td>\n                            <td className=\"px-4 py-3 whitespace-nowrap text-sm text-gray-500\">\n                              <button \n                                onClick={() => handleTripClick(trip.id)}\n                                className=\"text-blue-600 hover:text-blue-800\"\n                              >\n                                View\n                              </button>\n                            </td>\n                          </tr>\n                        );\n                      })}\n                    </tbody>\n                  </table>\n                </div>\n              </div>\n            )}\n            \n            {selectedTrip.trips_scheduled && selectedTrip.trips && selectedTrip.trips.length === 0 && (\n              <div className=\"mb-6 p-8 bg-gray-50 rounded-lg text-center\">\n                <p className=\"text-gray-500\">No trips found for this route</p>\n              </div>\n            )}\n            \n            {/* Actions */}\n            <div className=\"flex justify-end space-x-3 pt-4 border-t\">\n              <button\n                className=\"btn-secondary\"\n                onClick={() => setShowTripDetailsModal(false)}\n              >\n                Close\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\n// System Settings Component has been removed\n\n// Customer Service Component for Walk-in Ticket Sales\nconst CustomerService = () => {\n  const { locations, systemDate } = useApp();\n  const [currentStep, setCurrentStep] = useState(1); // 1: Search, 2: Select Trip, 3: Customer Info, 4: Payment\n  const [searchResults, setSearchResults] = useState([]);\n  const [selectedTrip, setSelectedTrip] = useState(null);\n  const [customerInfo, setCustomerInfo] = useState({\n    fullName: '',\n    phone: '',\n    email: '',\n    icNumber: '',\n    passengerCount: 1\n  });\n  const [isProcessing, setIsProcessing] = useState(false);\n  const [error, setError] = useState(null);\n\n  // 添加热门行程\n  const [popularTrip, setPopularTrip] = useState({\n    id: '1',\n    route: { name: 'KL - Johor Bahru Express' },\n    origin: 'Kuala Lumpur',\n    destination: 'Johor Bahru',\n    departureTime: '08:00 AM',\n    price: 'RM 45.00'\n  });\n\n  const [searchForm, setSearchForm] = useState({\n    origin: '',\n    destination: '',\n    date: systemDate,\n    isRoundTrip: false,\n    returnDate: format(addDays(new Date(systemDate), 1), 'yyyy-MM-dd')\n  });\n\n  // 添加处理热门行程选择的函数\n  const handlePopularTripSelect = (trip) => {\n    // 根据热门行程设置表单值\n    const fromLoc = locations.find(loc => loc.city === trip.origin);\n    const toLoc = locations.find(loc => loc.city === trip.destination);\n    \n    if (fromLoc) setSearchForm(prev => ({ ...prev, origin: fromLoc.id }));\n    if (toLoc) setSearchForm(prev => ({ ...prev, destination: toLoc.id }));\n    \n    // 自动搜索\n    handleSearch();\n  };\n\n  const handleSearch = async () => {\n    setIsProcessing(true);\n    \n    try {\n      const searchParams = {\n        origin: searchForm.origin,\n        destination: searchForm.destination,\n        departureDate: searchForm.date,\n        passengers: customerInfo.passengerCount\n      };\n\n      const response = await searchTrips(searchParams);\n      \n      if (response.success) {\n        setSearchResults(response.data);\n        setCurrentStep(2);\n      } else {\n        setError('Failed to search trips. Please try again.');\n      }\n    } catch (err) {\n      console.error('Search error:', err);\n      setError(handleApiError(err));\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleTripSelect = (trip) => {\n    setSelectedTrip(trip);\n    setCurrentStep(3);\n  };\n\n  const handleCustomerSubmit = () => {\n    if (customerInfo.fullName && customerInfo.phone) {\n      setCurrentStep(4);\n    }\n  };\n\n  const handlePaymentComplete = () => {\n    // Process booking\n    const bookingRef = `TBS${format(new Date(systemDate), 'yyyyMMddHHmm')}`;\n    alert(`Booking confirmed! Reference: ${bookingRef}`);\n    \n    // Reset form\n    setCurrentStep(1);\n    setSearchResults([]);\n    setSelectedTrip(null);\n    setCustomerInfo({ fullName: '', phone: '', email: '', icNumber: '', passengerCount: 1 });\n  };\n\n  const resetSearch = () => {\n    setCurrentStep(1);\n    setSearchResults([]);\n    setSelectedTrip(null);\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Error Message */}\n      {error && (\n        <div className=\"bg-red-50 border border-red-200 rounded-lg p-4\">\n          <div className=\"flex\">\n            <div className=\"flex-shrink-0\">\n              <svg className=\"h-5 w-5 text-red-400\" viewBox=\"0 0 20 20\" fill=\"currentColor\">\n                <path fillRule=\"evenodd\" d=\"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z\" clipRule=\"evenodd\" />\n              </svg>\n            </div>\n            <div className=\"ml-3\">\n              <p className=\"text-sm text-red-700\">{error}</p>\n              <button \n                onClick={() => setError(null)}\n                className=\"mt-2 text-red-800 underline hover:text-red-900 text-sm\"\n              >\n                Dismiss\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n      \n      {/* Header */}\n      <div className=\"flex items-center justify-between\">\n        <div>\n          <h2 className=\"text-2xl font-bold text-gray-900\">Customer Service Portal</h2>\n          <p className=\"text-gray-600\">Help walk-in customers purchase tickets quickly and efficiently</p>\n        </div>\n        {currentStep > 1 && (\n          <button onClick={resetSearch} className=\"btn-secondary\">\n            New Search\n          </button>\n        )}\n      </div>\n\n      {/* Progress Steps */}\n      <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-4\">\n        <div className=\"flex items-center justify-between\">\n          {['Search Trips', 'Select Trip', 'Customer Info', 'Payment'].map((step, index) => (\n            <div key={index} className=\"flex items-center\">\n              <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium ${\n                currentStep > index + 1 ? 'bg-green-500 text-white' :\n                currentStep === index + 1 ? 'bg-primary-500 text-white' :\n                'bg-gray-200 text-gray-600'\n              }`}>\n                {currentStep > index + 1 ? '✓' : index + 1}\n              </div>\n              <span className={`ml-2 text-sm font-medium ${\n                currentStep >= index + 1 ? 'text-gray-900' : 'text-gray-500'\n              }`}>\n                {step}\n              </span>\n              {index < 3 && (\n                <div className={`w-8 h-0.5 mx-4 ${\n                  currentStep > index + 1 ? 'bg-green-500' : 'bg-gray-200'\n                }`}></div>\n              )}\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Step 1: Search Form */}\n      {currentStep === 1 && (\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          <div className=\"md:col-span-2\">\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n              <h3 className=\"text-lg font-semibold mb-4\">Search Available Trips</h3>\n              \n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\n                <div>\n                  <label className=\"label\">From</label>\n                  <select\n                    value={searchForm.origin}\n                    onChange={(e) => setSearchForm(prev => ({ ...prev, origin: e.target.value }))}\n                    className=\"input w-full\"\n                    required\n                  >\n                    <option value=\"\">Select departure location</option>\n                    {locations.map(location => (\n                      <option key={location.id} value={location.id}>\n                        {location.name}, {location.city}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n                \n                <div>\n                  <label className=\"label\">To</label>\n                  <select\n                    value={searchForm.destination}\n                    onChange={(e) => setSearchForm(prev => ({ ...prev, destination: e.target.value }))}\n                    className=\"input w-full\"\n                    required\n                  >\n                    <option value=\"\">Select arrival location</option>\n                    {locations.map(location => (\n                      <option key={location.id} value={location.id}>\n                        {location.name}, {location.city}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n              </div>\n              \n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\n                <div>\n                  <label className=\"label\">Date</label>\n                  <input\n                    type=\"date\"\n                    value={searchForm.date}\n                    onChange={(e) => setSearchForm(prev => ({ ...prev, date: e.target.value }))}\n                    className=\"input w-full\"\n                    min={format(new Date(), 'yyyy-MM-dd')}\n                  />\n                </div>\n                \n                <div>\n                  <label className=\"label\">Passengers</label>\n                  <select\n                    value={customerInfo.passengerCount}\n                    onChange={(e) => setCustomerInfo(prev => ({ ...prev, passengerCount: parseInt(e.target.value) }))}\n                    className=\"input w-full\"\n                  >\n                    {[1, 2, 3, 4, 5, 6, 7, 8].map(num => (\n                      <option key={num} value={num}>\n                        {num} {num === 1 ? 'passenger' : 'passengers'}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n              </div>\n              \n              <button\n                onClick={handleSearch}\n                disabled={isProcessing || !searchForm.origin || !searchForm.destination}\n                className=\"btn-primary w-full flex items-center justify-center\"\n              >\n                {isProcessing ? (\n                  <>\n                    <div className=\"spinner-sm mr-2\"></div>\n                    Searching...\n                  </>\n                ) : (\n                  <>\n                    <Search className=\"w-4 h-4 mr-2\" />\n                    Search Trips\n                  </>\n                )}\n              </button>\n            </div>\n          </div>\n          \n          {/* Popular Trip Card */}\n          <div>\n            <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n              <h3 className=\"text-lg font-semibold mb-4\">Popular Trip</h3>\n              <PopularTrip \n                trip={popularTrip} \n                onSelect={handlePopularTripSelect} \n              />\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Step 2: Trip Selection */}\n      {currentStep === 2 && (\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n          <h3 className=\"text-lg font-semibold mb-4\">Available Trips ({searchResults.length} found)</h3>\n          \n          {searchResults.length === 0 ? (\n            <div className=\"text-center py-8 text-gray-500\">\n              <p>No trips found for the selected route and date.</p>\n              <button onClick={resetSearch} className=\"btn-primary mt-4\">Try Another Search</button>\n            </div>\n          ) : (\n            <div className=\"space-y-4\">\n              {searchResults.map(trip => (\n                <div key={trip.id} className=\"border border-gray-200 rounded-lg p-4 hover:border-primary-300 cursor-pointer\"\n                     onClick={() => handleTripSelect(trip)}>\n                  <div className=\"flex items-center justify-between\">\n                    <div className=\"flex-1\">\n                      <div className=\"flex items-center space-x-4\">\n                        <div>\n                          <div className=\"font-semibold text-lg\">{trip.route.name}</div>\n                          <div className=\"text-sm text-gray-600\">\n                            {locations.find(l => l.id === trip.route.originId)?.city} → \n                            {locations.find(l => l.id === trip.route.destinationId)?.city}\n                          </div>\n                        </div>\n                        <div className=\"text-center\">\n                          <div className=\"font-semibold\">{trip.departureDatetime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>\n                          <div className=\"text-sm text-gray-600\">Departure</div>\n                        </div>\n                        <div className=\"text-center\">\n                          <div className=\"font-semibold\">{trip.arrivalDatetime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>\n                          <div className=\"text-sm text-gray-600\">Arrival</div>\n                        </div>\n                      </div>\n                    </div>\n                    <div className=\"text-right\">\n                      <div className=\"text-2xl font-bold text-primary-600\">RM {trip.route.basePrice}</div>\n                      <div className=\"text-sm text-gray-600\">{trip.availableSeats} seats available</div>\n                      <div className={`text-xs px-2 py-1 rounded-full ${\n                        calculateOccupancy(trip) > 80 ? 'bg-red-100 text-red-600' :\n                        calculateOccupancy(trip) > 60 ? 'bg-yellow-100 text-yellow-600' :\n                        'bg-green-100 text-green-600'\n                      }`}>\n                        {calculateOccupancy(trip)}% occupied\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Step 3: Customer Information */}\n      {currentStep === 3 && selectedTrip && (\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n          <h3 className=\"text-lg font-semibold mb-4\">Customer Information</h3>\n          \n          {/* Selected Trip Summary */}\n          <div className=\"bg-gray-50 rounded-lg p-4 mb-6\">\n            <h4 className=\"font-semibold mb-2\">Selected Trip</h4>\n            <div className=\"flex items-center justify-between\">\n              <div>\n                <div className=\"font-medium\">{selectedTrip.route.name}</div>\n                <div className=\"text-sm text-gray-600\">\n                  {selectedTrip.departureDatetime.toLocaleDateString()} at {selectedTrip.departureDatetime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}\n                </div>\n              </div>\n              <div className=\"text-right\">\n                <div className=\"text-lg font-bold text-primary-600\">RM {selectedTrip.route.basePrice * customerInfo.passengerCount}</div>\n                <div className=\"text-sm text-gray-600\">{customerInfo.passengerCount} passenger{customerInfo.passengerCount > 1 ? 's' : ''}</div>\n              </div>\n            </div>\n          </div>\n          \n          {/* Customer Form */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6\">\n            <div>\n              <label className=\"label\">Full Name *</label>\n              <input\n                type=\"text\"\n                value={customerInfo.fullName}\n                onChange={(e) => setCustomerInfo(prev => ({ ...prev, fullName: e.target.value }))}\n                className=\"input w-full\"\n                placeholder=\"Enter customer's full name\"\n                required\n              />\n            </div>\n            \n            <div>\n              <label className=\"label\">Phone Number *</label>\n              <input\n                type=\"tel\"\n                value={customerInfo.phone}\n                onChange={(e) => setCustomerInfo(prev => ({ ...prev, phone: e.target.value }))}\n                className=\"input w-full\"\n                placeholder=\"+60123456789\"\n                required\n              />\n            </div>\n            \n            <div>\n              <label className=\"label\">Email Address</label>\n              <input\n                type=\"email\"\n                value={customerInfo.email}\n                onChange={(e) => setCustomerInfo(prev => ({ ...prev, email: e.target.value }))}\n                className=\"input w-full\"\n                placeholder=\"customer@email.com\"\n              />\n            </div>\n            \n            <div>\n              <label className=\"label\">IC Number</label>\n              <input\n                type=\"text\"\n                value={customerInfo.icNumber}\n                onChange={(e) => setCustomerInfo(prev => ({ ...prev, icNumber: e.target.value }))}\n                className=\"input w-full\"\n                placeholder=\"123456-78-9012\"\n              />\n            </div>\n          </div>\n          \n          <div className=\"flex space-x-4\">\n            <button onClick={() => setCurrentStep(2)} className=\"btn-secondary\">\n              Back to Trip Selection\n            </button>\n            <button \n              onClick={handleCustomerSubmit}\n              disabled={!customerInfo.fullName || !customerInfo.phone}\n              className=\"btn-primary\"\n            >\n              Continue to Payment\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Step 4: Payment */}\n      {currentStep === 4 && selectedTrip && (\n        <div className=\"bg-white rounded-lg shadow-sm border border-gray-200 p-6\">\n          <h3 className=\"text-lg font-semibold mb-4\">Payment & Confirmation</h3>\n          \n          {/* Booking Summary */}\n          <div className=\"bg-gray-50 rounded-lg p-6 mb-6\">\n            <h4 className=\"font-semibold mb-4\">Booking Summary</h4>\n            \n            <div className=\"space-y-3\">\n              <div className=\"flex justify-between\">\n                <span>Route:</span>\n                <span className=\"font-medium\">{selectedTrip.route.name}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>Date & Time:</span>\n                <span className=\"font-medium\">\n                  {selectedTrip.departureDatetime.toLocaleDateString()} at {selectedTrip.departureDatetime.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}\n                </span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>Passenger:</span>\n                <span className=\"font-medium\">{customerInfo.fullName}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>Phone:</span>\n                <span className=\"font-medium\">{customerInfo.phone}</span>\n              </div>\n              <div className=\"flex justify-between\">\n                <span>Passengers:</span>\n                <span className=\"font-medium\">{customerInfo.passengerCount}</span>\n              </div>\n              <hr />\n              <div className=\"flex justify-between text-lg font-bold\">\n                <span>Total Amount:</span>\n                <span className=\"text-primary-600\">RM {selectedTrip.route.basePrice * customerInfo.passengerCount}</span>\n              </div>\n            </div>\n          </div>\n          \n          {/* Payment Methods */}\n          <div className=\"mb-6\">\n            <h4 className=\"font-semibold mb-3\">Payment Method</h4>\n            <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n              <button className=\"border-2 border-primary-500 bg-primary-50 text-primary-700 rounded-lg p-4 text-center\">\n                💳 Card Payment\n              </button>\n              <button className=\"border-2 border-gray-200 hover:border-gray-300 rounded-lg p-4 text-center\">\n                💰 Cash Payment\n              </button>\n              <button className=\"border-2 border-gray-200 hover:border-gray-300 rounded-lg p-4 text-center\">\n                📱 E-Wallet\n              </button>\n            </div>\n          </div>\n          \n          <div className=\"flex space-x-4\">\n            <button onClick={() => setCurrentStep(3)} className=\"btn-secondary\">\n              Back to Customer Info\n            </button>\n            <button onClick={handlePaymentComplete} className=\"btn-primary\">\n              Confirm Payment & Issue Ticket\n            </button>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\n// Route Management Component\nconst RouteManagement = ({ routes = [], onRefresh }) => {\n  const [showCreateModal, setShowCreateModal] = useState(false);\n  const [locations, setLocations] = useState([]);\n  const [loading, setLoading] = useState(false);\n  const [createForm, setCreateForm] = useState({\n    name: '',\n    base_price: 0,\n    stops: []\n  });\n\n  // Load locations for route creation\n  useEffect(() => {\n    const loadLocations = async () => {\n      try {\n        const response = await getLocationsForRoutes();\n        if (response.success) {\n          setLocations(response.data);\n        }\n      } catch (error) {\n        console.error('Error loading locations:', error);\n      }\n    };\n\n    loadLocations();\n  }, []);\n\n  const handleAddStop = () => {\n    setCreateForm(prev => ({\n      ...prev,\n      stops: [\n        ...prev.stops,\n        {\n          location_id: '',\n          is_origin: prev.stops.length === 0, // 第一个站点默认为起点\n          is_destination: false,\n          arrival_offset_minutes: prev.stops.length === 0 ? 0 : 30, // 起点的到达时间偏移为0\n          departure_offset_minutes: 5,\n          price_from_origin: 0\n        }\n      ]\n    }));\n  };\n\n  const handleRemoveStop = (index) => {\n    setCreateForm(prev => {\n      const newStops = prev.stops.filter((_, i) => i !== index);\n      \n      // 如果删除了起点，将第一个站点设为新的起点\n      if (prev.stops[index].is_origin && newStops.length > 0) {\n        newStops[0].is_origin = true;\n        newStops[0].arrival_offset_minutes = 0;\n      }\n      \n      // 如果删除了终点，将最后一个站点设为新的终点\n      if (prev.stops[index].is_destination && newStops.length > 0) {\n        newStops[newStops.length - 1].is_destination = true;\n      }\n      \n      return { ...prev, stops: newStops };\n    });\n  };\n\n  const handleStopChange = (index, field, value) => {\n    setCreateForm(prev => {\n      const newStops = [...prev.stops];\n      \n      // 特殊处理起点和终点的设置\n      if (field === 'is_origin' && value === true) {\n        // 将其他站点的is_origin设为false\n        newStops.forEach((stop, i) => {\n          if (i !== index) stop.is_origin = false;\n        });\n        // 起点的到达时间偏移设为0\n        newStops[index].arrival_offset_minutes = 0;\n      } else if (field === 'is_destination' && value === true) {\n        // 将其他站点的is_destination设为false\n        newStops.forEach((stop, i) => {\n          if (i !== index) stop.is_destination = false;\n        });\n      }\n      \n      newStops[index] = {\n        ...newStops[index],\n        [field]: value\n      };\n      \n      return { ...prev, stops: newStops };\n    });\n  };\n\n  const handleCreateRoute = async () => {\n    // 验证表单\n    if (createForm.name.trim() === '') {\n      alert('请输入路线名称');\n      return;\n    }\n    \n    if (createForm.stops.length < 2) {\n      alert('路线至少需要两个站点');\n      return;\n    }\n    \n    // 确保有起点和终点\n    const hasOrigin = createForm.stops.some(stop => stop.is_origin);\n    const hasDestination = createForm.stops.some(stop => stop.is_destination);\n    \n    if (!hasOrigin) {\n      alert('请设置一个起点站');\n      return;\n    }\n    \n    if (!hasDestination) {\n      alert('请设置一个终点站');\n      return;\n    }\n    \n    // 确保所有站点都有选择位置\n    const allLocationsSelected = createForm.stops.every(stop => stop.location_id);\n    \n    if (!allLocationsSelected) {\n      alert('请为所有站点选择位置');\n      return;\n    }\n\n    // 准备提交的数据\n    const routeData = {\n      name: createForm.name,\n      base_price: createForm.base_price,\n      stops: createForm.stops.map(stop => ({\n        ...stop,\n        arrival_offset_minutes: parseInt(stop.arrival_offset_minutes),\n        departure_offset_minutes: parseInt(stop.departure_offset_minutes),\n        price_from_origin: parseFloat(stop.price_from_origin)\n      }))\n    };\n    \n    // 获取起点和终点ID，用于兼容旧的API\n    const originStop = routeData.stops.find(stop => stop.is_origin);\n    const destinationStop = routeData.stops.find(stop => stop.is_destination);\n    \n    if (originStop && destinationStop) {\n      routeData.origin_id = originStop.location_id;\n      routeData.destination_id = destinationStop.location_id;\n    }\n    \n    setLoading(true);\n    try {\n      const response = await createRoute(routeData);\n      if (response.success) {\n        setShowCreateModal(false);\n        setCreateForm({\n          name: '',\n          base_price: 0,\n          stops: []\n        });\n        onRefresh();\n        alert('路线创建成功！');\n      } else {\n        alert('创建路线失败: ' + (response.message || '未知错误'));\n      }\n    } catch (error) {\n      console.error('创建路线时出错:', error);\n      alert('创建路线时出错');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // 自动生成路线名称\n  const generateRouteName = () => {\n    const originStop = createForm.stops.find(stop => stop.is_origin);\n    const destinationStop = createForm.stops.find(stop => stop.is_destination);\n    \n    if (!originStop || !destinationStop) return;\n    \n    const originLocation = locations.find(loc => loc.id === originStop.location_id);\n    const destinationLocation = locations.find(loc => loc.id === destinationStop.location_id);\n    \n    if (originLocation && destinationLocation) {\n      const routeName = `${originLocation.city} - ${destinationLocation.city} Express`;\n      setCreateForm(prev => ({\n        ...prev,\n        name: routeName\n      }));\n    }\n  };\n\n  // Format duration from minutes to hours and minutes\n  const formatDuration = (minutes) => {\n    if (!minutes) return 'N/A';\n    const hours = Math.floor(minutes / 60);\n    const mins = minutes % 60;\n    return `${hours}h ${mins}m`;\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h2 className=\"text-2xl font-bold text-gray-900\">Route Management</h2>\n        <button \n          className=\"btn-primary flex items-center\"\n          onClick={() => setShowCreateModal(true)}\n        >\n          <Plus className=\"w-4 h-4 mr-2\" />\n          Create New Route\n        </button>\n      </div>\n\n      {/* Routes List */}\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {routes.map((route) => (\n          <div key={route.id} className=\"card\">\n            <div className=\"flex items-center justify-between mb-4\">\n              <div className=\"flex items-center space-x-3\">\n                <div className=\"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center\">\n                  <Map className=\"w-5 h-5 text-blue-600\" />\n                </div>\n                <div>\n                  <h3 className=\"font-semibold text-gray-900\">{route.name}</h3>\n                  <p className=\"text-sm text-gray-600\">{route.route_code}</p>\n                </div>\n              </div>\n              <div className=\"text-sm text-gray-500\">\n                RM {route.base_price}\n              </div>\n            </div>\n            \n            <div className=\"flex items-center space-x-2 text-sm text-gray-600\">\n              <MapPin className=\"w-4 h-4\" />\n              <span>{route.origin_name} → {route.destination_name}</span>\n            </div>\n            \n            {/* Route Details */}\n            <div className=\"mt-3 grid grid-cols-3 gap-2 text-xs\">\n              <div>\n                <span className=\"text-gray-500\">Distance:</span>\n                <span className=\"font-medium ml-1\">{route.distance_km || 'N/A'} km</span>\n              </div>\n              <div>\n                <span className=\"text-gray-500\">Duration:</span>\n                <span className=\"font-medium ml-1\">{formatDuration(route.estimated_duration_minutes)}</span>\n              </div>\n              <div>\n                <span className=\"text-gray-500\">Price:</span>\n                <span className=\"font-medium ml-1\">RM {route.base_price}</span>\n              </div>\n            </div>\n            \n            {route.total_trips > 0 && (\n              <div className=\"mt-3 flex items-center justify-between text-xs\">\n                <span className=\"text-gray-500\">Trip Count:</span>\n                <span className=\"font-medium\">{route.total_trips} trips</span>\n              </div>\n            )}\n            \n            {route.avg_occupancy > 0 && (\n              <div className=\"flex items-center justify-between text-xs\">\n                <span className=\"text-gray-500\">Avg. Occupation:</span>\n                <div className=\"flex items-center space-x-2\">\n                  <div className=\"w-16 bg-gray-200 rounded-full h-2\">\n                    <div \n                      className=\"h-2 rounded-full transition-all\"\n                      style={{ \n                        width: `${Math.min(route.avg_occupancy || 0, 100)}%`,\n                        backgroundColor: (route.avg_occupancy || 0) > 80 ? '#EF4444' : (route.avg_occupancy || 0) > 60 ? '#F59E0B' : '#10B981'\n                      }}\n                    ></div>\n                  </div>\n                  <span className=\"font-medium\">\n                    {typeof route.avg_occupancy === 'number' ? route.avg_occupancy.toFixed(0) : '0'}%\n                  </span>\n                </div>\n              </div>\n            )}\n          </div>\n        ))}\n      </div>\n\n      {/* Create Route Modal */}\n      {showCreateModal && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50\">\n          <div className=\"bg-white rounded-lg p-6 w-full max-w-4xl max-h-[90vh] overflow-y-auto\">\n            <h3 className=\"text-lg font-semibold mb-4\">创建新路线</h3>\n            \n            <div className=\"space-y-4\">\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  路线名称\n                </label>\n                <div className=\"flex space-x-2\">\n                  <input\n                    type=\"text\"\n                    value={createForm.name}\n                    onChange={(e) => setCreateForm(prev => ({ ...prev, name: e.target.value }))}\n                    className=\"flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                    placeholder=\"例如：吉隆坡 - 槟城快车\"\n                    required\n                  />\n                  <button\n                    type=\"button\"\n                    onClick={generateRouteName}\n                    className=\"px-3 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200\"\n                    title=\"根据起点和终点自动生成路线名称\"\n                  >\n                    自动生成\n                  </button>\n                </div>\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-medium text-gray-700 mb-1\">\n                  基本票价 (RM)\n                </label>\n                <input\n                  type=\"number\"\n                  step=\"0.50\"\n                  min=\"0\"\n                  value={createForm.base_price}\n                  onChange={(e) => setCreateForm(prev => ({ ...prev, base_price: parseFloat(e.target.value) }))}\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\n                  placeholder=\"例如：45.00\"\n                  required\n                />\n                <p className=\"text-xs text-gray-500 mt-1\">这是从起点到终点的全程票价</p>\n              </div>\n\n              {/* 站点管理 */}\n              <div>\n                <div className=\"flex items-center justify-between mb-2\">\n                  <label className=\"block text-sm font-medium text-gray-700\">\n                    路线站点\n                  </label>\n                  <button \n                    type=\"button\" \n                    className=\"text-sm text-blue-600 hover:text-blue-800 flex items-center\"\n                    onClick={handleAddStop}\n                  >\n                    <Plus className=\"w-4 h-4 mr-1\" />\n                    添加站点\n                  </button>\n                </div>\n\n                {createForm.stops.length === 0 ? (\n                  <div className=\"text-sm text-gray-500 text-center py-8 border border-dashed border-gray-300 rounded-md\">\n                    <div className=\"mb-2\">还没有添加任何站点</div>\n                    <button \n                      type=\"button\"\n                      className=\"btn-primary text-sm px-4 py-2\"\n                      onClick={handleAddStop}\n                    >\n                      添加第一个站点\n                    </button>\n                  </div>\n                ) : (\n                  <div className=\"space-y-4\">\n                    {createForm.stops.map((stop, index) => (\n                      <div key={index} className={`p-4 border rounded-md ${\n                        stop.is_origin ? 'bg-blue-50 border-blue-200' : \n                        stop.is_destination ? 'bg-green-50 border-green-200' : \n                        'bg-gray-50 border-gray-200'\n                      }`}>\n                        <div className=\"flex justify-between items-center mb-3\">\n                          <div className=\"flex items-center space-x-2\">\n                            <h4 className=\"text-sm font-medium text-gray-700\">站点 #{index + 1}</h4>\n                            {stop.is_origin && (\n                              <span className=\"px-2 py-0.5 bg-blue-100 text-blue-800 text-xs rounded-full\">起点</span>\n                            )}\n                            {stop.is_destination && (\n                              <span className=\"px-2 py-0.5 bg-green-100 text-green-800 text-xs rounded-full\">终点</span>\n                            )}\n                          </div>\n                          <button \n                            type=\"button\" \n                            className=\"text-sm text-red-600 hover:text-red-800\"\n                            onClick={() => handleRemoveStop(index)}\n                          >\n                            <X className=\"w-4 h-4\" />\n                          </button>\n                        </div>\n                        \n                        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3\">\n                          <div>\n                            <label className=\"block text-xs text-gray-700 mb-1\">\n                              位置\n                            </label>\n                            <select\n                              value={stop.location_id}\n                              onChange={(e) => handleStopChange(index, 'location_id', e.target.value)}\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm\"\n                              required\n                            >\n                              <option value=\"\">选择位置</option>\n                              {locations.filter(loc => \n                                !createForm.stops.some((s, i) => i !== index && s.location_id === loc.id)\n                              ).map(location => (\n                                <option key={location.id} value={location.id}>\n                                  {location.name}, {location.city}\n                                </option>\n                              ))}\n                            </select>\n                          </div>\n                          \n                          <div>\n                            <label className=\"block text-xs text-gray-700 mb-1\">\n                              从起点的票价 (RM)\n                            </label>\n                            <input\n                              type=\"number\"\n                              step=\"0.50\"\n                              min=\"0\"\n                              value={stop.price_from_origin}\n                              onChange={(e) => handleStopChange(index, 'price_from_origin', parseFloat(e.target.value))}\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm\"\n                            />\n                          </div>\n                        </div>\n                        \n                        <div className=\"grid grid-cols-2 gap-3 mb-3\">\n                          <div>\n                            <label className=\"block text-xs text-gray-700 mb-1\">\n                              到达时间偏移（分钟）\n                            </label>\n                            <input\n                              type=\"number\"\n                              min=\"0\"\n                              value={stop.arrival_offset_minutes}\n                              onChange={(e) => handleStopChange(index, 'arrival_offset_minutes', parseInt(e.target.value))}\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm\"\n                              disabled={stop.is_origin} // 起点的到达时间偏移固定为0\n                            />\n                            {stop.is_origin && (\n                              <p className=\"text-xs text-gray-500 mt-1\">起点站的到达时间偏移固定为0</p>\n                            )}\n                          </div>\n                          \n                          <div>\n                            <label className=\"block text-xs text-gray-700 mb-1\">\n                              出发时间偏移（分钟）\n                            </label>\n                            <input\n                              type=\"number\"\n                              min=\"0\"\n                              value={stop.departure_offset_minutes}\n                              onChange={(e) => handleStopChange(index, 'departure_offset_minutes', parseInt(e.target.value))}\n                              className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm\"\n                            />\n                          </div>\n                        </div>\n                        \n                        <div className=\"flex space-x-4 mt-2\">\n                          <div className=\"flex items-center\">\n                            <input\n                              type=\"checkbox\"\n                              id={`is_origin_${index}`}\n                              checked={stop.is_origin}\n                              onChange={(e) => handleStopChange(index, 'is_origin', e.target.checked)}\n                              className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\n                            />\n                            <label htmlFor={`is_origin_${index}`} className=\"ml-2 block text-sm text-gray-700\">\n                              设为起点\n                            </label>\n                          </div>\n                          \n                          <div className=\"flex items-center\">\n                            <input\n                              type=\"checkbox\"\n                              id={`is_destination_${index}`}\n                              checked={stop.is_destination}\n                              onChange={(e) => handleStopChange(index, 'is_destination', e.target.checked)}\n                              className=\"h-4 w-4 text-green-600 focus:ring-green-500 border-gray-300 rounded\"\n                            />\n                            <label htmlFor={`is_destination_${index}`} className=\"ml-2 block text-sm text-gray-700\">\n                              设为终点\n                            </label>\n                          </div>\n                        </div>\n                      </div>\n                    ))}\n                  </div>\n                )}\n                \n                {createForm.stops.length > 0 && (\n                  <div className=\"mt-2 text-right\">\n                    <button \n                      type=\"button\" \n                      className=\"text-sm text-blue-600 hover:text-blue-800 flex items-center ml-auto\"\n                      onClick={handleAddStop}\n                    >\n                      <Plus className=\"w-4 h-4 mr-1\" />\n                      添加更多站点\n                    </button>\n                  </div>\n                )}\n              </div>\n            </div>\n\n            <div className=\"flex space-x-3 mt-6\">\n              <button \n                className=\"btn-primary flex-1\"\n                onClick={handleCreateRoute}\n                disabled={loading || createForm.stops.length < 2}\n              >\n                {loading ? '创建中...' : '创建路线'}\n              </button>\n              <button \n                className=\"btn-secondary flex-1\"\n                onClick={() => setShowCreateModal(false)}\n                disabled={loading}\n              >\n                取消\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default AdminDashboard; "],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}